2025-11-05 11:15:30 [INFO] Testing query generation for: Fantasy with Magic
2025-11-05 11:15:30 [DEBUG]     Query 1: fantasy young adult magic identity
2025-11-05 11:15:30 [INFO] Testing query generation for: Sci-Fi with AI Theme
2025-11-05 11:15:30 [DEBUG]     Query 1: sci-fi artificial intelligence ethics
2025-11-05 11:15:30 [INFO] Testing query generation for: Mystery with Deception
2025-11-05 11:15:30 [DEBUG]     Query 1: mystery deception truth
2025-11-05 11:15:30 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-05 11:15:30 [DEBUG]     Query 1: dystopian freedom rebellion
2025-11-05 11:15:30 [INFO] Query Generation Test: 4/4 passed
2025-11-05 11:15:30 [INFO] Testing book fetching for: Fantasy with Magic
2025-11-05 11:15:32 [INFO]   Successfully fetched 5 books for Fantasy with Magic
2025-11-05 11:15:32 [DEBUG]     Book 1: Children's Fantasy Literature by Michael Levy
2025-11-05 11:15:32 [DEBUG]     Book 2: Female Heroes in Young Adult Fantasy Fiction by Leah Phillips
2025-11-05 11:15:32 [DEBUG]     Book 3: Fire Becomes Her by Rosiee Thor
2025-11-05 11:15:32 [INFO] Testing book fetching for: Sci-Fi with AI Theme
2025-11-05 11:15:33 [INFO]   Successfully fetched 5 books for Sci-Fi with AI Theme
2025-11-05 11:15:33 [DEBUG]     Book 1: Artificial Intelligence Ethics by Fouad Sabry
2025-11-05 11:15:33 [DEBUG]     Book 2: Artificial Intelligence from Science Fiction to Reality by Emanuel Camilleri
2025-11-05 11:15:33 [DEBUG]     Book 3: The Fictional Frontier: Artificial Intelligence in Sci-Fi and Its Real-World Implications by S Williams
2025-11-05 11:15:33 [INFO] Testing book fetching for: Mystery with Deception
2025-11-05 11:15:34 [INFO]   Successfully fetched 5 books for Mystery with Deception
2025-11-05 11:15:34 [DEBUG]     Book 1: Unveiling the Mysteries: In Pursuit of the Hidden Truth by Pasquale De Marco
2025-11-05 11:15:34 [DEBUG]     Book 2: Defying Deception by Jonathan K. Corrado
2025-11-05 11:15:34 [DEBUG]     Book 3: The Answer Mystery Of The Truth by Craig Cox
2025-11-05 11:15:34 [INFO] Testing book fetching for: Dystopian with Rebellion
2025-11-05 11:15:36 [INFO]   Successfully fetched 5 books for Dystopian with Rebellion
2025-11-05 11:15:36 [DEBUG]     Book 1: DYSTOPIAN LITERATURE by NARAYAN CHANGDER
2025-11-05 11:15:36 [DEBUG]     Book 2: DYSTOPIAN by NARAYAN CHANGDER
2025-11-05 11:15:36 [DEBUG]     Book 3: Contemporary Dystopian Fiction for Young Adults by Balaka Basu
2025-11-05 11:15:36 [INFO] Book Fetching Test: 4/4 passed
2025-11-05 11:15:36 [INFO] Testing book relevance for: Fantasy with Magic
2025-11-05 11:15:38 [INFO]   Relevance for Fantasy with Magic: 100.0%
2025-11-05 11:15:38 [INFO] Testing book relevance for: Sci-Fi with AI Theme
2025-11-05 11:15:39 [INFO]   Relevance for Sci-Fi with AI Theme: 100.0%
2025-11-05 11:15:39 [INFO] Testing book relevance for: Mystery with Deception
2025-11-05 11:15:41 [INFO]   Relevance for Mystery with Deception: 60.0%
2025-11-05 11:15:41 [INFO] Testing book relevance for: Dystopian with Rebellion
2025-11-05 11:15:42 [INFO]   Relevance for Dystopian with Rebellion: 100.0%
2025-11-05 11:15:42 [INFO] Book Relevance Test: 4/4 passed
2025-11-05 11:15:42 [INFO] Testing fallback behavior with obscure queries
2025-11-05 11:15:43 [INFO]   Fallback successful: 5 books returned
2025-11-05 11:15:43 [WARNING] Google Books API key not set
2025-11-05 11:15:46 [INFO] Session API connection test passed
2025-11-05 11:15:48 [INFO] Flask server health check passed
2025-11-05 11:15:50 [INFO] Debug book sources test completed
2025-11-05 11:16:24 [INFO] Session created: -OdH-ypP0qromEmMewLt for user: 04E9XYnVi8QD3yHAIXeBHCRp2sN2
2025-11-05 11:16:29 [INFO] Successfully seeded 5 messages
2025-11-05 11:17:06 [INFO] Full recommendation test passed: 0 books returned
2025-11-05 11:17:06 [WARNING] Some tests failed: 1 failures out of 10 tests
2025-11-05 11:20:29 [INFO] ======================================================================
2025-11-05 11:20:29 [INFO] STARTING COMPREHENSIVE BOOK RECOMMENDATION TEST SUITE
2025-11-05 11:20:29 [INFO] ======================================================================
2025-11-05 11:20:29 [WARNING] Google Books API key not set - some tests will be skipped
2025-11-05 11:20:29 [INFO] 
======================================================================
TEST: A1: Query Generation
======================================================================
2025-11-05 11:20:29 [INFO] Testing query generation for: Fantasy with Magic
2025-11-05 11:20:29 [INFO] INFO:   Generated 1 queries:
2025-11-05 11:20:29 [DEBUG]     Query 1: fantasy young adult magic identity
2025-11-05 11:20:29 [INFO] SUCCESS:   Queries include genre 'fantasy'
2025-11-05 11:20:29 [INFO] Testing query generation for: Sci-Fi with AI Theme
2025-11-05 11:20:29 [INFO] INFO:   Generated 1 queries:
2025-11-05 11:20:29 [DEBUG]     Query 1: sci-fi artificial intelligence ethics
2025-11-05 11:20:29 [INFO] SUCCESS:   Queries include genre 'sci-fi'
2025-11-05 11:20:29 [INFO] Testing query generation for: Mystery with Deception
2025-11-05 11:20:29 [INFO] INFO:   Generated 1 queries:
2025-11-05 11:20:29 [DEBUG]     Query 1: mystery deception truth
2025-11-05 11:20:29 [INFO] SUCCESS:   Queries include genre 'mystery'
2025-11-05 11:20:29 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-05 11:20:29 [INFO] INFO:   Generated 1 queries:
2025-11-05 11:20:29 [DEBUG]     Query 1: dystopian freedom rebellion
2025-11-05 11:20:29 [INFO] SUCCESS:   Queries include genre 'dystopian'
2025-11-05 11:20:29 [INFO] Query Generation Test: 4/4 passed
2025-11-05 11:20:29 [INFO] 
======================================================================
TEST: A2: Book Fetching with Generated Queries
======================================================================
2025-11-05 11:20:29 [INFO] Testing book fetching for: Fantasy with Magic
2025-11-05 11:20:29 [INFO] INFO:   Fetching books...
2025-11-05 11:20:31 [INFO] SUCCESS:   Fetched 5 books
2025-11-05 11:20:31 [INFO]   Successfully fetched 5 books for Fantasy with Magic
2025-11-05 11:20:31 [DEBUG]     Book 1: Children's Fantasy Literature by Michael Levy
2025-11-05 11:20:31 [DEBUG]     Book 2: Female Heroes in Young Adult Fantasy Fiction by Leah Phillips
2025-11-05 11:20:31 [DEBUG]     Book 3: Fantasy Global Appeal by Nakoa Rainfall
2025-11-05 11:20:31 [INFO] Testing book fetching for: Sci-Fi with AI Theme
2025-11-05 11:20:31 [INFO] INFO:   Fetching books...
2025-11-05 11:20:33 [INFO] SUCCESS:   Fetched 5 books
2025-11-05 11:20:33 [INFO]   Successfully fetched 5 books for Sci-Fi with AI Theme
2025-11-05 11:20:33 [DEBUG]     Book 1: Artificial Intelligence Ethics by Fouad Sabry
2025-11-05 11:20:33 [DEBUG]     Book 2: Artificial Intelligence from Science Fiction to Reality by Emanuel Camilleri
2025-11-05 11:20:33 [DEBUG]     Book 3: The Fictional Frontier: Artificial Intelligence in Sci-Fi and Its Real-World Implications by S Williams
2025-11-05 11:20:33 [INFO] Testing book fetching for: Mystery with Deception
2025-11-05 11:20:33 [INFO] INFO:   Fetching books...
2025-11-05 11:20:35 [INFO] SUCCESS:   Fetched 5 books
2025-11-05 11:20:35 [INFO]   Successfully fetched 5 books for Mystery with Deception
2025-11-05 11:20:35 [DEBUG]     Book 1: Unveiling the Mysteries: In Pursuit of the Hidden Truth by Pasquale De Marco
2025-11-05 11:20:35 [DEBUG]     Book 2: Defying Deception by Jonathan K. Corrado
2025-11-05 11:20:35 [DEBUG]     Book 3: The Answer Mystery Of The Truth by Craig Cox
2025-11-05 11:20:35 [INFO] Testing book fetching for: Dystopian with Rebellion
2025-11-05 11:20:35 [INFO] INFO:   Fetching books...
2025-11-05 11:20:36 [INFO] SUCCESS:   Fetched 5 books
2025-11-05 11:20:36 [INFO]   Successfully fetched 5 books for Dystopian with Rebellion
2025-11-05 11:20:36 [DEBUG]     Book 1: DYSTOPIAN LITERATURE by NARAYAN CHANGDER
2025-11-05 11:20:36 [DEBUG]     Book 2: DYSTOPIAN by NARAYAN CHANGDER
2025-11-05 11:20:36 [DEBUG]     Book 3: Contemporary Dystopian Fiction for Young Adults by Balaka Basu
2025-11-05 11:20:36 [INFO] Book Fetching Test: 4/4 passed
2025-11-05 11:20:36 [INFO] 
======================================================================
TEST: A3: Book Relevance Validation
======================================================================
2025-11-05 11:20:36 [INFO] INFO:   Expected genre: fantasy
2025-11-05 11:20:36 [INFO] INFO:   Expected keywords: magic, fantasy, wizard, enchant
2025-11-05 11:20:36 [INFO] Testing book relevance for: Fantasy with Magic
2025-11-05 11:20:38 [INFO]   Relevance for Fantasy with Magic: 100.0%
2025-11-05 11:20:38 [INFO] SUCCESS:   Sufficient relevance
2025-11-05 11:20:38 [INFO] INFO:   Expected genre: science fiction
2025-11-05 11:20:38 [INFO] INFO:   Expected keywords: robot, AI, technology, future, android
2025-11-05 11:20:38 [INFO] Testing book relevance for: Sci-Fi with AI Theme
2025-11-05 11:20:39 [INFO]   Relevance for Sci-Fi with AI Theme: 100.0%
2025-11-05 11:20:39 [INFO] SUCCESS:   Sufficient relevance
2025-11-05 11:20:39 [INFO] INFO:   Expected genre: mystery
2025-11-05 11:20:39 [INFO] INFO:   Expected keywords: mystery, detective, solve, clue, investigate
2025-11-05 11:20:39 [INFO] Testing book relevance for: Mystery with Deception
2025-11-05 11:20:40 [INFO]   Relevance for Mystery with Deception: 60.0%
2025-11-05 11:20:40 [INFO] SUCCESS:   Sufficient relevance
2025-11-05 11:20:40 [INFO] INFO:   Expected genre: dystopian
2025-11-05 11:20:40 [INFO] INFO:   Expected keywords: dystopia, rebellion, totalitarian, oppression, resistance
2025-11-05 11:20:40 [INFO] Testing book relevance for: Dystopian with Rebellion
2025-11-05 11:20:41 [INFO]   Relevance for Dystopian with Rebellion: 100.0%
2025-11-05 11:20:41 [INFO] SUCCESS:   Sufficient relevance
2025-11-05 11:20:41 [INFO] Book Relevance Test: 4/4 passed
2025-11-05 11:20:41 [INFO] 
======================================================================
TEST: A4: Query Fallback Behavior
======================================================================
2025-11-05 11:20:41 [INFO] INFO: Testing with intentionally obscure queries...
2025-11-05 11:20:41 [INFO] Testing fallback behavior with obscure queries
2025-11-05 11:20:43 [INFO] SUCCESS:   Fallback returned 5 books despite obscure query
2025-11-05 11:20:43 [INFO]   Fallback successful: 5 books returned
2025-11-05 11:20:43 [INFO] 
======================================================================
TEST: B1: Google Books API Direct Call
======================================================================
2025-11-05 11:20:43 [ERROR] FAIL: Google Books API Key not set in environment
2025-11-05 11:20:43 [WARNING] Google Books API key not set
2025-11-05 11:20:43 [INFO] 
======================================================================
TEST: B2: Session API Connection
======================================================================
2025-11-05 11:20:44 [INFO] SUCCESS: Session API is reachable
2025-11-05 11:20:44 [INFO] INFO:   Test session created: -OdH0yBXPeWP8lNgbHRt
2025-11-05 11:20:44 [INFO] Session API connection test passed
2025-11-05 11:20:44 [INFO] 
======================================================================
TEST: B3: Flask Server Health Check
======================================================================
2025-11-05 11:22:21 [INFO] ======================================================================
2025-11-05 11:22:21 [INFO] STARTING COMPREHENSIVE BOOK RECOMMENDATION TEST SUITE
2025-11-05 11:22:21 [INFO] ======================================================================
2025-11-05 11:22:21 [WARNING] Google Books API key not set - some tests will be skipped
2025-11-05 11:22:21 [INFO] 
======================================================================
TEST: A1: Query Generation
======================================================================
2025-11-05 11:22:21 [INFO] Testing query generation for: Fantasy with Magic
2025-11-05 11:22:21 [INFO] INFO:   Generated 1 queries:
2025-11-05 11:22:21 [DEBUG]     Query 1: fantasy young adult magic identity
2025-11-05 11:22:21 [INFO] SUCCESS:   Queries include genre 'fantasy'
2025-11-05 11:22:21 [INFO] Testing query generation for: Sci-Fi with AI Theme
2025-11-05 11:22:21 [INFO] INFO:   Generated 1 queries:
2025-11-05 11:22:21 [DEBUG]     Query 1: sci-fi artificial intelligence ethics
2025-11-05 11:22:21 [INFO] SUCCESS:   Queries include genre 'sci-fi'
2025-11-05 11:22:21 [INFO] Testing query generation for: Mystery with Deception
2025-11-05 11:22:21 [INFO] INFO:   Generated 1 queries:
2025-11-05 11:22:21 [DEBUG]     Query 1: mystery deception truth
2025-11-05 11:22:21 [INFO] SUCCESS:   Queries include genre 'mystery'
2025-11-05 11:22:21 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-05 11:22:21 [INFO] INFO:   Generated 1 queries:
2025-11-05 11:22:21 [DEBUG]     Query 1: dystopian freedom rebellion
2025-11-05 11:22:21 [INFO] SUCCESS:   Queries include genre 'dystopian'
2025-11-05 11:22:21 [INFO] Query Generation Test: 4/4 passed
2025-11-05 11:22:21 [INFO] 
======================================================================
TEST: A2: Book Fetching with Generated Queries
======================================================================
2025-11-05 11:22:21 [INFO] Testing book fetching for: Fantasy with Magic
2025-11-05 11:22:21 [INFO] INFO:   Fetching books...
2025-11-05 11:22:23 [INFO] SUCCESS:   Fetched 5 books
2025-11-05 11:22:23 [INFO]   Successfully fetched 5 books for Fantasy with Magic
2025-11-05 11:22:23 [DEBUG]     Book 1: Children's Fantasy Literature by Michael Levy
2025-11-05 11:22:23 [DEBUG]     Book 2: Female Heroes in Young Adult Fantasy Fiction by Leah Phillips
2025-11-05 11:22:23 [DEBUG]     Book 3: Fantasy Global Appeal by Nakoa Rainfall
2025-11-05 11:22:23 [INFO] Testing book fetching for: Sci-Fi with AI Theme
2025-11-05 11:22:23 [INFO] INFO:   Fetching books...
2025-11-05 11:22:24 [INFO] SUCCESS:   Fetched 5 books
2025-11-05 11:22:24 [INFO]   Successfully fetched 5 books for Sci-Fi with AI Theme
2025-11-05 11:22:24 [DEBUG]     Book 1: Artificial Intelligence Ethics by Fouad Sabry
2025-11-05 11:22:24 [DEBUG]     Book 2: Artificial Intelligence from Science Fiction to Reality by Emanuel Camilleri
2025-11-05 11:22:24 [DEBUG]     Book 3: The Fictional Frontier: Artificial Intelligence in Sci-Fi and Its Real-World Implications by S Williams
2025-11-05 11:22:24 [INFO] Testing book fetching for: Mystery with Deception
2025-11-05 11:22:24 [INFO] INFO:   Fetching books...
2025-11-05 11:22:26 [INFO] SUCCESS:   Fetched 5 books
2025-11-05 11:22:26 [INFO]   Successfully fetched 5 books for Mystery with Deception
2025-11-05 11:22:26 [DEBUG]     Book 1: Unveiling the Mysteries: In Pursuit of the Hidden Truth by Pasquale De Marco
2025-11-05 11:22:26 [DEBUG]     Book 2: Defying Deception by Jonathan K. Corrado
2025-11-05 11:22:26 [DEBUG]     Book 3: The Answer Mystery Of The Truth by Craig Cox
2025-11-05 11:22:26 [INFO] Testing book fetching for: Dystopian with Rebellion
2025-11-05 11:22:26 [INFO] INFO:   Fetching books...
2025-11-05 11:22:27 [INFO] SUCCESS:   Fetched 5 books
2025-11-05 11:22:27 [INFO]   Successfully fetched 5 books for Dystopian with Rebellion
2025-11-05 11:22:27 [DEBUG]     Book 1: DYSTOPIAN LITERATURE by NARAYAN CHANGDER
2025-11-05 11:22:27 [DEBUG]     Book 2: DYSTOPIAN by NARAYAN CHANGDER
2025-11-05 11:22:27 [DEBUG]     Book 3: Contemporary Dystopian Fiction for Young Adults by Balaka Basu
2025-11-05 11:22:27 [INFO] Book Fetching Test: 4/4 passed
2025-11-05 11:22:27 [INFO] 
======================================================================
TEST: A3: Book Relevance Validation
======================================================================
2025-11-05 11:22:27 [INFO] INFO:   Expected genre: fantasy
2025-11-05 11:22:27 [INFO] INFO:   Expected keywords: magic, fantasy, wizard, enchant
2025-11-05 11:22:27 [INFO] Testing book relevance for: Fantasy with Magic
2025-11-05 11:22:29 [INFO]   Relevance for Fantasy with Magic: 100.0%
2025-11-05 11:22:29 [INFO] SUCCESS:   Sufficient relevance
2025-11-05 11:22:29 [INFO] INFO:   Expected genre: science fiction
2025-11-05 11:22:29 [INFO] INFO:   Expected keywords: robot, AI, technology, future, android
2025-11-05 11:22:29 [INFO] Testing book relevance for: Sci-Fi with AI Theme
2025-11-05 11:22:31 [INFO]   Relevance for Sci-Fi with AI Theme: 100.0%
2025-11-05 11:22:31 [INFO] SUCCESS:   Sufficient relevance
2025-11-05 11:22:31 [INFO] INFO:   Expected genre: mystery
2025-11-05 11:22:31 [INFO] INFO:   Expected keywords: mystery, detective, solve, clue, investigate
2025-11-05 11:22:31 [INFO] Testing book relevance for: Mystery with Deception
2025-11-05 11:22:32 [INFO]   Relevance for Mystery with Deception: 60.0%
2025-11-05 11:22:32 [INFO] SUCCESS:   Sufficient relevance
2025-11-05 11:22:32 [INFO] INFO:   Expected genre: dystopian
2025-11-05 11:22:32 [INFO] INFO:   Expected keywords: dystopia, rebellion, totalitarian, oppression, resistance
2025-11-05 11:22:32 [INFO] Testing book relevance for: Dystopian with Rebellion
2025-11-05 11:22:33 [INFO]   Relevance for Dystopian with Rebellion: 100.0%
2025-11-05 11:22:33 [INFO] SUCCESS:   Sufficient relevance
2025-11-05 11:22:33 [INFO] Book Relevance Test: 4/4 passed
2025-11-05 11:22:33 [INFO] 
======================================================================
TEST: A4: Query Fallback Behavior
======================================================================
2025-11-05 11:22:33 [INFO] INFO: Testing with intentionally obscure queries...
2025-11-05 11:22:33 [INFO] Testing fallback behavior with obscure queries
2025-11-05 11:22:35 [INFO] SUCCESS:   Fallback returned 5 books despite obscure query
2025-11-05 11:22:35 [INFO]   Fallback successful: 5 books returned
2025-11-05 11:22:35 [INFO] 
======================================================================
TEST: B1: Google Books API Direct Call
======================================================================
2025-11-05 11:22:35 [ERROR] FAIL: Google Books API Key not set in environment
2025-11-05 11:22:35 [WARNING] Google Books API key not set
2025-11-05 11:22:35 [INFO] 
======================================================================
TEST: B2: Session API Connection
======================================================================
2025-11-05 11:22:36 [INFO] SUCCESS: Session API is reachable
2025-11-05 11:22:36 [INFO] INFO:   Test session created: -OdH1Oge9GTk1h0HdEhQ
2025-11-05 11:22:36 [INFO] Session API connection test passed
2025-11-05 11:22:36 [INFO] 
======================================================================
TEST: B3: Flask Server Health Check
======================================================================
2025-11-05 11:22:38 [INFO] SUCCESS: Server status: ok
2025-11-05 11:22:38 [INFO] SUCCESS:   brainstorming: running
2025-11-05 11:22:38 [INFO] SUCCESS:   character_extraction: running
2025-11-05 11:22:38 [INFO] SUCCESS:   deepthinking: running
2025-11-05 11:22:38 [INFO] SUCCESS:   image_generation: running
2025-11-05 11:22:38 [INFO] SUCCESS:   world_ai: running
2025-11-05 11:22:38 [INFO] Flask server health check passed
2025-11-05 11:22:38 [INFO] 
======================================================================
TEST: B4: Debug Book Sources
======================================================================
2025-11-05 11:22:38 [INFO] INFO: Testing each book source individually...
2025-11-05 11:22:40 [INFO] INFO: 
Configuration:
2025-11-05 11:22:40 [INFO] SUCCESS:   Google Books API key: Set
2025-11-05 11:22:40 [INFO] INFO: 
Source Results:
2025-11-05 11:22:40 [INFO] SUCCESS:   curated: 3 books
2025-11-05 11:22:40 [ERROR] FAIL:   google_books: 'BookSourceManager' object has no attribute '_fetch_google_books'
2025-11-05 11:22:40 [ERROR] FAIL:   open_library: 'BookSourceManager' object has no attribute '_fetch_openlibrary_books'
2025-11-05 11:22:40 [INFO] INFO: 
Summary:
2025-11-05 11:22:40 [INFO] Debug book sources test completed
2025-11-05 11:22:40 [INFO] 
======================================================================
TEST: B5: Session Creation & Message Seeding
======================================================================
2025-11-05 11:24:58 [ERROR] FAIL: Invalid input
2025-11-05 11:24:58 [INFO] 
======================================================================
TEST: B6: Full Recommendation Endpoint
======================================================================
2025-11-05 11:24:59 [WARNING] WARN: Skipped (no user ID or session ID provided)
2025-11-05 11:24:59 [INFO] ======================================================================
2025-11-05 11:24:59 [INFO] TEST SUMMARY
2025-11-05 11:24:59 [INFO] ======================================================================
2025-11-05 11:24:59 [INFO] 
Section A: Query Effectiveness:
2025-11-05 11:24:59 [INFO] PASS: A1: Query Generation
2025-11-05 11:24:59 [INFO] PASS: A2: Book Fetching
2025-11-05 11:24:59 [INFO] PASS: A3: Book Relevance
2025-11-05 11:24:59 [INFO] PASS: A4: Fallback Behavior
2025-11-05 11:24:59 [INFO] 
Section B: API Integration:
2025-11-05 11:24:59 [ERROR] FAIL: B1: Google Books API
2025-11-05 11:24:59 [INFO] PASS: B2: Session API
2025-11-05 11:24:59 [INFO] PASS: B3: Server Health
2025-11-05 11:24:59 [INFO] PASS: B4: Debug Book Sources
2025-11-05 11:24:59 [WARNING] SKIP: B5: Session Creation
2025-11-05 11:24:59 [WARNING] SKIP: B6: Full Recommendation
2025-11-05 11:24:59 [INFO] 
Overall Results: 7 passed, 1 failed, 2 skipped out of 10 tests
2025-11-05 11:24:59 [WARNING] FAILURE: 1 tests failed out of 10
2025-11-05 11:24:59 [INFO] ======================================================================
2025-11-05 11:24:59 [INFO] QUICK TIPS
2025-11-05 11:24:59 [INFO] ======================================================================
2025-11-05 11:24:59 [INFO] Section A (Query Effectiveness):
2025-11-05 11:24:59 [INFO]   • Tests core query generation and book fetching logic
2025-11-05 11:24:59 [INFO]   • Requires Google Books API key to be set
2025-11-05 11:24:59 [INFO]   • Can run independently of Flask server
2025-11-05 11:24:59 [INFO] Section B (API Integration):
2025-11-05 11:24:59 [INFO]   • Tests full end-to-end recommendation flow
2025-11-05 11:24:59 [INFO]   • Requires Flask server running: python app.py
2025-11-05 11:24:59 [INFO]   • Requires Session API (or use deployed version)
2025-11-05 11:24:59 [INFO]   • Use Test B5 to create pre-seeded sessions for B6
2025-11-05 11:24:59 [INFO] For detailed logs:
2025-11-05 11:24:59 [INFO]   • Check logs/recommendation_tests.log
2025-11-05 11:24:59 [INFO]   • Check logs/recommendations.log (Flask server)
2025-11-05 11:24:59 [INFO] Common issues:
2025-11-05 11:24:59 [INFO] ======================================================================
2025-11-05 11:24:59 [INFO] TEST SUITE COMPLETE
2025-11-05 11:24:59 [INFO] ======================================================================
2025-11-05 11:25:07 [INFO] ======================================================================
2025-11-05 11:25:07 [INFO] STARTING COMPREHENSIVE BOOK RECOMMENDATION TEST SUITE
2025-11-05 11:25:07 [INFO] ======================================================================
2025-11-05 11:25:07 [WARNING] Google Books API key not set - some tests will be skipped
2025-11-05 11:25:07 [INFO] 
----------------------------------------------------------------------
2025-11-05 11:25:07 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-05 11:25:07 [INFO] ----------------------------------------------------------------------
2025-11-05 11:25:07 [INFO] 
======================================================================
2025-11-05 11:25:07 [INFO] TEST: A1: Query Generation
2025-11-05 11:25:07 [INFO] ======================================================================
2025-11-05 11:25:07 [INFO] Testing query generation for: Fantasy with Magic
2025-11-05 11:25:07 [INFO] [INFO]   Generated 1 queries:
2025-11-05 11:25:07 [DEBUG]     Query 1: fantasy young adult magic identity
2025-11-05 11:25:07 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-05 11:25:07 [INFO] Testing query generation for: Sci-Fi with AI Theme
2025-11-05 11:25:07 [INFO] [INFO]   Generated 1 queries:
2025-11-05 11:25:07 [DEBUG]     Query 1: sci-fi artificial intelligence ethics
2025-11-05 11:25:07 [INFO] [PASS]   Queries include genre 'sci-fi'
2025-11-05 11:25:07 [INFO] Testing query generation for: Mystery with Deception
2025-11-05 11:25:07 [INFO] [INFO]   Generated 1 queries:
2025-11-05 11:25:07 [DEBUG]     Query 1: mystery deception truth
2025-11-05 11:25:07 [INFO] [PASS]   Queries include genre 'mystery'
2025-11-05 11:25:07 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-05 11:25:07 [INFO] [INFO]   Generated 1 queries:
2025-11-05 11:25:07 [DEBUG]     Query 1: dystopian freedom rebellion
2025-11-05 11:25:07 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-05 11:25:07 [INFO] Query Generation Test: 4/4 passed
2025-11-05 11:25:07 [INFO] 
======================================================================
2025-11-05 11:25:07 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-05 11:25:07 [INFO] ======================================================================
2025-11-05 11:25:07 [INFO] Testing book fetching for: Fantasy with Magic
2025-11-05 11:25:07 [INFO] [INFO]   Fetching books...
2025-11-05 11:25:09 [INFO] [PASS]   Fetched 5 books
2025-11-05 11:25:09 [INFO]   Successfully fetched 5 books for Fantasy with Magic
2025-11-05 11:25:09 [DEBUG]     Book 1: Children's Fantasy Literature by Michael Levy
2025-11-05 11:25:09 [DEBUG]     Book 2: Female Heroes in Young Adult Fantasy Fiction by Leah Phillips
2025-11-05 11:25:09 [DEBUG]     Book 3: Fire Becomes Her by Rosiee Thor
2025-11-05 11:25:09 [INFO] Testing book fetching for: Sci-Fi with AI Theme
2025-11-05 11:25:09 [INFO] [INFO]   Fetching books...
2025-11-05 11:25:11 [INFO] [PASS]   Fetched 5 books
2025-11-05 11:25:11 [INFO]   Successfully fetched 5 books for Sci-Fi with AI Theme
2025-11-05 11:25:11 [DEBUG]     Book 1: Artificial Intelligence Ethics by Fouad Sabry
2025-11-05 11:25:11 [DEBUG]     Book 2: Artificial Intelligence from Science Fiction to Reality by Emanuel Camilleri
2025-11-05 11:25:11 [DEBUG]     Book 3: The Fictional Frontier: Artificial Intelligence in Sci-Fi and Its Real-World Implications by S Williams
2025-11-05 11:25:11 [INFO] Testing book fetching for: Mystery with Deception
2025-11-05 11:25:11 [INFO] [INFO]   Fetching books...
2025-11-05 11:25:12 [INFO] [PASS]   Fetched 5 books
2025-11-05 11:25:12 [INFO]   Successfully fetched 5 books for Mystery with Deception
2025-11-05 11:25:12 [DEBUG]     Book 1: Unveiling the Mysteries: In Pursuit of the Hidden Truth by Pasquale De Marco
2025-11-05 11:25:12 [DEBUG]     Book 2: Defying Deception by Jonathan K. Corrado
2025-11-05 11:25:12 [DEBUG]     Book 3: The Answer Mystery Of The Truth by Craig Cox
2025-11-05 11:25:12 [INFO] Testing book fetching for: Dystopian with Rebellion
2025-11-05 11:25:12 [INFO] [INFO]   Fetching books...
2025-11-05 11:25:13 [INFO] [PASS]   Fetched 5 books
2025-11-05 11:25:13 [INFO]   Successfully fetched 5 books for Dystopian with Rebellion
2025-11-05 11:25:13 [DEBUG]     Book 1: DYSTOPIAN LITERATURE by NARAYAN CHANGDER
2025-11-05 11:25:13 [DEBUG]     Book 2: DYSTOPIAN by NARAYAN CHANGDER
2025-11-05 11:25:13 [DEBUG]     Book 3: Contemporary Dystopian Fiction for Young Adults by Balaka Basu
2025-11-05 11:25:13 [INFO] Book Fetching Test: 4/4 passed
2025-11-05 11:25:13 [INFO] 
======================================================================
2025-11-05 11:25:13 [INFO] TEST: A3: Book Relevance Validation
2025-11-05 11:25:13 [INFO] ======================================================================
2025-11-05 11:25:13 [INFO] [INFO]   Expected genre: fantasy
2025-11-05 11:25:13 [INFO] [INFO]   Expected keywords: magic, fantasy, wizard, enchant
2025-11-05 11:25:13 [INFO] Testing book relevance for: Fantasy with Magic
2025-11-05 11:25:14 [INFO]   Relevance for Fantasy with Magic: 100.0%
2025-11-05 11:25:14 [INFO] [PASS]   Sufficient relevance
2025-11-05 11:25:14 [INFO] [INFO]   Expected genre: science fiction
2025-11-05 11:25:14 [INFO] [INFO]   Expected keywords: robot, AI, technology, future, android
2025-11-05 11:25:14 [INFO] Testing book relevance for: Sci-Fi with AI Theme
2025-11-05 11:25:15 [INFO]   Relevance for Sci-Fi with AI Theme: 100.0%
2025-11-05 11:25:15 [INFO] [PASS]   Sufficient relevance
2025-11-05 11:25:15 [INFO] [INFO]   Expected genre: mystery
2025-11-05 11:25:15 [INFO] [INFO]   Expected keywords: mystery, detective, solve, clue, investigate
2025-11-05 11:25:15 [INFO] Testing book relevance for: Mystery with Deception
2025-11-05 11:25:16 [INFO]   Relevance for Mystery with Deception: 80.0%
2025-11-05 11:25:16 [INFO] [PASS]   Sufficient relevance
2025-11-05 11:25:16 [INFO] [INFO]   Expected genre: dystopian
2025-11-05 11:25:16 [INFO] [INFO]   Expected keywords: dystopia, rebellion, totalitarian, oppression, resistance
2025-11-05 11:25:16 [INFO] Testing book relevance for: Dystopian with Rebellion
2025-11-05 11:25:17 [INFO]   Relevance for Dystopian with Rebellion: 100.0%
2025-11-05 11:25:17 [INFO] [PASS]   Sufficient relevance
2025-11-05 11:25:17 [INFO] Book Relevance Test: 4/4 passed
2025-11-05 11:25:17 [INFO] 
======================================================================
2025-11-05 11:25:17 [INFO] TEST: A4: Query Fallback Behavior
2025-11-05 11:25:17 [INFO] ======================================================================
2025-11-05 11:25:17 [INFO] [INFO] Testing with intentionally obscure queries...
2025-11-05 11:25:17 [INFO] Testing fallback behavior with obscure queries
2025-11-05 11:25:17 [INFO] [PASS]   Fallback returned 5 books despite obscure query
2025-11-05 11:25:17 [INFO]   Fallback successful: 5 books returned
2025-11-05 11:25:17 [INFO] 
----------------------------------------------------------------------
2025-11-05 11:25:17 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-05 11:25:17 [INFO] ----------------------------------------------------------------------
2025-11-05 11:25:17 [INFO] 
======================================================================
2025-11-05 11:25:17 [INFO] TEST: B1: Google Books API Direct Call
2025-11-05 11:25:17 [INFO] ======================================================================
2025-11-05 11:25:17 [ERROR] [FAIL] Google Books API Key not set in environment
2025-11-05 11:25:17 [WARNING] Google Books API key not set
2025-11-05 11:25:17 [INFO] 
======================================================================
2025-11-05 11:25:17 [INFO] TEST: B2: Session API Connection
2025-11-05 11:25:17 [INFO] ======================================================================
2025-11-05 11:25:18 [INFO] [PASS] Session API is reachable
2025-11-05 11:25:18 [INFO] [INFO]   Test session created: -OdH20GeC18tNZ7re1ho
2025-11-05 11:25:18 [INFO] Session API connection test passed
2025-11-05 11:25:18 [INFO] 
======================================================================
2025-11-05 11:25:18 [INFO] TEST: B3: Flask Server Health Check
2025-11-05 11:25:18 [INFO] ======================================================================
2025-11-05 11:25:20 [INFO] [PASS] Server status: ok
2025-11-05 11:25:20 [INFO] [PASS]   brainstorming: running
2025-11-05 11:25:20 [INFO] [PASS]   character_extraction: running
2025-11-05 11:25:20 [INFO] [PASS]   deepthinking: running
2025-11-05 11:25:20 [INFO] [PASS]   image_generation: running
2025-11-05 11:25:20 [INFO] [PASS]   world_ai: running
2025-11-05 11:25:20 [INFO] Flask server health check passed
2025-11-05 11:25:20 [INFO] 
======================================================================
2025-11-05 11:25:20 [INFO] TEST: B4: Debug Book Sources
2025-11-05 11:25:20 [INFO] ======================================================================
2025-11-05 11:25:20 [INFO] [INFO] Testing each book source individually...
2025-11-05 11:25:22 [INFO] [INFO] 
Configuration:
2025-11-05 11:25:22 [INFO] [PASS]   Google Books API key: Set
2025-11-05 11:25:22 [INFO] [INFO] 
Source Results:
2025-11-05 11:25:22 [INFO] [PASS]   curated: 3 books
2025-11-05 11:25:22 [ERROR] [FAIL]   google_books: 'BookSourceManager' object has no attribute '_fetch_google_books'
2025-11-05 11:25:22 [ERROR] [FAIL]   open_library: 'BookSourceManager' object has no attribute '_fetch_openlibrary_books'
2025-11-05 11:25:22 [INFO] [INFO] 
Summary:
2025-11-05 11:25:22 [INFO] Debug book sources test completed
2025-11-05 11:25:22 [INFO] 
======================================================================
2025-11-05 11:25:22 [INFO] TEST: B5: Session Creation & Message Seeding
2025-11-05 11:25:22 [INFO] ======================================================================
2025-11-05 11:25:40 [INFO] [INFO] 
Creating brainstorming session for user: 04E9XYnVi8QD3yHAIXeBHCRp2sN2
2025-11-05 11:25:40 [INFO] [PASS] Session created: -OdH25e4TcchEJCHZC89
2025-11-05 11:25:40 [INFO] Session created: -OdH25e4TcchEJCHZC89 for user: 04E9XYnVi8QD3yHAIXeBHCRp2sN2
2025-11-05 11:25:40 [INFO] [INFO] Seeding 5 messages...
2025-11-05 11:25:44 [INFO] [PASS] All 5 messages seeded successfully
2025-11-05 11:25:44 [INFO] Successfully seeded 5 messages
2025-11-05 11:25:45 [INFO] [INFO] Session verification:
2025-11-05 11:25:45 [INFO] 
======================================================================
2025-11-05 11:25:45 [INFO] TEST: B6: Full Recommendation Endpoint
2025-11-05 11:25:45 [INFO] ======================================================================
2025-11-05 11:25:45 [INFO] [INFO] 
Testing recommendations for:
2025-11-05 11:25:45 [INFO] [INFO] 
Sending request...
2025-11-05 11:26:19 [INFO] [PASS] Returned 0 books in 34.00s
2025-11-05 11:26:19 [INFO] Full recommendation test passed: 0 books returned
2025-11-05 11:26:19 [INFO] ======================================================================
2025-11-05 11:26:19 [INFO] TEST SUMMARY
2025-11-05 11:26:19 [INFO] ======================================================================
2025-11-05 11:26:19 [INFO] 
Section A: Query Effectiveness:
2025-11-05 11:26:19 [INFO] PASS: A1: Query Generation
2025-11-05 11:26:19 [INFO] PASS: A2: Book Fetching
2025-11-05 11:26:19 [INFO] PASS: A3: Book Relevance
2025-11-05 11:26:19 [INFO] PASS: A4: Fallback Behavior
2025-11-05 11:26:19 [INFO] 
Section B: API Integration:
2025-11-05 11:26:19 [ERROR] FAIL: B1: Google Books API
2025-11-05 11:26:19 [INFO] PASS: B2: Session API
2025-11-05 11:26:19 [INFO] PASS: B3: Server Health
2025-11-05 11:26:19 [INFO] PASS: B4: Debug Book Sources
2025-11-05 11:26:19 [INFO] PASS: B5: Session Creation
2025-11-05 11:26:19 [INFO] PASS: B6: Full Recommendation
2025-11-05 11:26:19 [INFO] 
Overall Results: 9 passed, 1 failed, 0 skipped out of 10 tests
2025-11-05 11:26:19 [WARNING] FAILURE: 1 tests failed out of 10
2025-11-05 11:26:19 [INFO] ======================================================================
2025-11-05 11:26:19 [INFO] QUICK TIPS
2025-11-05 11:26:19 [INFO] ======================================================================
2025-11-05 11:26:19 [INFO] Section A (Query Effectiveness):
2025-11-05 11:26:19 [INFO]   • Tests core query generation and book fetching logic
2025-11-05 11:26:19 [INFO]   • Requires Google Books API key to be set
2025-11-05 11:26:19 [INFO]   • Can run independently of Flask server
2025-11-05 11:26:19 [INFO] Section B (API Integration):
2025-11-05 11:26:19 [INFO]   • Tests full end-to-end recommendation flow
2025-11-05 11:26:19 [INFO]   • Requires Flask server running: python app.py
2025-11-05 11:26:19 [INFO]   • Requires Session API (or use deployed version)
2025-11-05 11:26:19 [INFO]   • Use Test B5 to create pre-seeded sessions for B6
2025-11-05 11:26:19 [INFO] For detailed logs:
2025-11-05 11:26:19 [INFO]   • Check logs/recommendation_tests.log
2025-11-05 11:26:19 [INFO]   • Check logs/recommendations.log (Flask server)
2025-11-05 11:26:19 [INFO] Common issues:
2025-11-05 11:26:19 [INFO] ======================================================================
2025-11-05 11:26:19 [INFO] TEST SUITE COMPLETE
2025-11-05 11:26:19 [INFO] ======================================================================
2025-11-05 11:31:48 [INFO] ======================================================================
2025-11-05 11:31:48 [INFO] STARTING COMPREHENSIVE BOOK RECOMMENDATION TEST SUITE
2025-11-05 11:31:48 [INFO] ======================================================================
2025-11-05 11:31:48 [WARNING] Google Books API key not set - some tests will be skipped
2025-11-05 11:31:48 [INFO] 
----------------------------------------------------------------------
2025-11-05 11:31:48 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-05 11:31:48 [INFO] ----------------------------------------------------------------------
2025-11-05 11:31:48 [INFO] 
======================================================================
2025-11-05 11:31:48 [INFO] TEST: A1: Query Generation
2025-11-05 11:31:48 [INFO] ======================================================================
2025-11-05 11:31:48 [INFO] Testing query generation for: Fantasy with Magic
2025-11-05 11:31:48 [INFO] [INFO]   Generated 1 queries:
2025-11-05 11:31:48 [DEBUG]     Query 1: fantasy young adult magic identity
2025-11-05 11:31:48 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-05 11:31:48 [INFO] Testing query generation for: Sci-Fi with AI Theme
2025-11-05 11:31:48 [INFO] [INFO]   Generated 1 queries:
2025-11-05 11:31:48 [DEBUG]     Query 1: sci-fi artificial intelligence ethics
2025-11-05 11:31:48 [INFO] [PASS]   Queries include genre 'sci-fi'
2025-11-05 11:31:48 [INFO] Testing query generation for: Mystery with Deception
2025-11-05 11:31:48 [INFO] [INFO]   Generated 1 queries:
2025-11-05 11:31:49 [DEBUG]     Query 1: mystery deception truth
2025-11-05 11:31:49 [INFO] [PASS]   Queries include genre 'mystery'
2025-11-05 11:31:49 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-05 11:31:49 [INFO] [INFO]   Generated 1 queries:
2025-11-05 11:31:49 [DEBUG]     Query 1: dystopian freedom rebellion
2025-11-05 11:31:49 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-05 11:31:49 [INFO] Query Generation Test: 4/4 passed
2025-11-05 11:31:49 [INFO] 
======================================================================
2025-11-05 11:31:49 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-05 11:31:49 [INFO] ======================================================================
2025-11-05 11:31:49 [INFO] Testing book fetching for: Fantasy with Magic
2025-11-05 11:31:49 [INFO] [INFO]   Fetching books...
2025-11-05 11:31:50 [INFO] [PASS]   Fetched 5 books
2025-11-05 11:31:50 [INFO]   Successfully fetched 5 books for Fantasy with Magic
2025-11-05 11:31:50 [DEBUG]     Book 1: Children's Fantasy Literature by Michael Levy
2025-11-05 11:31:50 [DEBUG]     Book 2: Female Heroes in Young Adult Fantasy Fiction by Leah Phillips
2025-11-05 11:31:50 [DEBUG]     Book 3: Fantasy Global Appeal by Nakoa Rainfall
2025-11-05 11:31:50 [INFO] Testing book fetching for: Sci-Fi with AI Theme
2025-11-05 11:31:50 [INFO] [INFO]   Fetching books...
2025-11-05 11:31:51 [INFO] [PASS]   Fetched 5 books
2025-11-05 11:31:51 [INFO]   Successfully fetched 5 books for Sci-Fi with AI Theme
2025-11-05 11:31:51 [DEBUG]     Book 1: Artificial Intelligence Ethics by Fouad Sabry
2025-11-05 11:31:51 [DEBUG]     Book 2: Artificial Intelligence from Science Fiction to Reality by Emanuel Camilleri
2025-11-05 11:31:51 [DEBUG]     Book 3: The Fictional Frontier: Artificial Intelligence in Sci-Fi and Its Real-World Implications by S Williams
2025-11-05 11:31:51 [INFO] Testing book fetching for: Mystery with Deception
2025-11-05 11:31:51 [INFO] [INFO]   Fetching books...
2025-11-05 11:31:52 [INFO] [PASS]   Fetched 5 books
2025-11-05 11:31:52 [INFO]   Successfully fetched 5 books for Mystery with Deception
2025-11-05 11:31:52 [DEBUG]     Book 1: Unveiling the Mysteries: In Pursuit of the Hidden Truth by Pasquale De Marco
2025-11-05 11:31:52 [DEBUG]     Book 2: Defying Deception by Jonathan K. Corrado
2025-11-05 11:31:52 [DEBUG]     Book 3: The Answer Mystery Of The Truth by Craig Cox
2025-11-05 11:31:52 [INFO] Testing book fetching for: Dystopian with Rebellion
2025-11-05 11:31:52 [INFO] [INFO]   Fetching books...
2025-11-05 11:31:52 [INFO] [PASS]   Fetched 5 books
2025-11-05 11:31:52 [INFO]   Successfully fetched 5 books for Dystopian with Rebellion
2025-11-05 11:31:52 [DEBUG]     Book 1: DYSTOPIAN LITERATURE by NARAYAN CHANGDER
2025-11-05 11:31:52 [DEBUG]     Book 2: DYSTOPIAN by NARAYAN CHANGDER
2025-11-05 11:31:52 [DEBUG]     Book 3: Contemporary Dystopian Fiction for Young Adults by Balaka Basu
2025-11-05 11:31:52 [INFO] Book Fetching Test: 4/4 passed
2025-11-05 11:31:52 [INFO] 
======================================================================
2025-11-05 11:31:52 [INFO] TEST: A3: Book Relevance Validation
2025-11-05 11:31:52 [INFO] ======================================================================
2025-11-05 11:31:52 [INFO] [INFO]   Expected genre: fantasy
2025-11-05 11:31:52 [INFO] [INFO]   Expected keywords: magic, fantasy, wizard, enchant
2025-11-05 11:31:52 [INFO] Testing book relevance for: Fantasy with Magic
2025-11-05 11:31:53 [INFO]   Relevance for Fantasy with Magic: 100.0%
2025-11-05 11:31:53 [INFO] [PASS]   Sufficient relevance
2025-11-05 11:31:53 [INFO] [INFO]   Expected genre: science fiction
2025-11-05 11:31:53 [INFO] [INFO]   Expected keywords: robot, AI, technology, future, android
2025-11-05 11:31:53 [INFO] Testing book relevance for: Sci-Fi with AI Theme
2025-11-05 11:31:54 [INFO]   Relevance for Sci-Fi with AI Theme: 100.0%
2025-11-05 11:31:54 [INFO] [PASS]   Sufficient relevance
2025-11-05 11:31:54 [INFO] [INFO]   Expected genre: mystery
2025-11-05 11:31:54 [INFO] [INFO]   Expected keywords: mystery, detective, solve, clue, investigate
2025-11-05 11:31:54 [INFO] Testing book relevance for: Mystery with Deception
2025-11-05 11:31:54 [INFO]   Relevance for Mystery with Deception: 60.0%
2025-11-05 11:31:54 [INFO] [PASS]   Sufficient relevance
2025-11-05 11:31:54 [INFO] [INFO]   Expected genre: dystopian
2025-11-05 11:31:54 [INFO] [INFO]   Expected keywords: dystopia, rebellion, totalitarian, oppression, resistance
2025-11-05 11:31:54 [INFO] Testing book relevance for: Dystopian with Rebellion
2025-11-05 11:31:55 [INFO]   Relevance for Dystopian with Rebellion: 100.0%
2025-11-05 11:31:55 [INFO] [PASS]   Sufficient relevance
2025-11-05 11:31:55 [INFO] Book Relevance Test: 4/4 passed
2025-11-05 11:31:55 [INFO] 
======================================================================
2025-11-05 11:31:55 [INFO] TEST: A4: Query Fallback Behavior
2025-11-05 11:31:55 [INFO] ======================================================================
2025-11-05 11:31:55 [INFO] [INFO] Testing with intentionally obscure queries...
2025-11-05 11:31:55 [INFO] Testing fallback behavior with obscure queries
2025-11-05 11:31:57 [INFO] [PASS]   Fallback returned 5 books despite obscure query
2025-11-05 11:31:57 [INFO]   Fallback successful: 5 books returned
2025-11-05 11:31:57 [INFO] 
----------------------------------------------------------------------
2025-11-05 11:31:57 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-05 11:31:57 [INFO] ----------------------------------------------------------------------
2025-11-05 11:31:57 [INFO] 
======================================================================
2025-11-05 11:31:57 [INFO] TEST: B1: Google Books API Direct Call
2025-11-05 11:31:57 [INFO] ======================================================================
2025-11-05 11:31:57 [ERROR] [FAIL] Google Books API Key not set in environment
2025-11-05 11:31:57 [WARNING] Google Books API key not set
2025-11-05 11:31:57 [INFO] 
======================================================================
2025-11-05 11:31:57 [INFO] TEST: B2: Session API Connection
2025-11-05 11:31:57 [INFO] ======================================================================
2025-11-05 11:31:58 [INFO] [PASS] Session API is reachable
2025-11-05 11:31:58 [INFO] [INFO]   Test session created: -OdH3XoO_xqO7RBJVt4H
2025-11-05 11:31:58 [INFO] Session API connection test passed
2025-11-05 11:31:58 [INFO] 
======================================================================
2025-11-05 11:31:58 [INFO] TEST: B3: Flask Server Health Check
2025-11-05 11:31:58 [INFO] ======================================================================
2025-11-05 11:32:00 [INFO] [PASS] Server status: ok
2025-11-05 11:32:00 [INFO] [PASS]   brainstorming: running
2025-11-05 11:32:00 [INFO] [PASS]   character_extraction: running
2025-11-05 11:32:00 [INFO] [PASS]   deepthinking: running
2025-11-05 11:32:00 [INFO] [PASS]   image_generation: running
2025-11-05 11:32:00 [INFO] [PASS]   world_ai: running
2025-11-05 11:32:00 [INFO] Flask server health check passed
2025-11-05 11:32:00 [INFO] 
======================================================================
2025-11-05 11:32:00 [INFO] TEST: B4: Debug Book Sources
2025-11-05 11:32:00 [INFO] ======================================================================
2025-11-05 11:32:00 [INFO] [INFO] Testing each book source individually...
2025-11-05 11:32:02 [INFO] [INFO] 
Configuration:
2025-11-05 11:32:02 [INFO] [PASS]   Google Books API key: Set
2025-11-05 11:32:02 [INFO] [INFO] 
Source Results:
2025-11-05 11:32:02 [INFO] [PASS]   curated: 3 books
2025-11-05 11:32:02 [ERROR] [FAIL]   google_books: 'BookSourceManager' object has no attribute '_fetch_google_books'
2025-11-05 11:32:02 [ERROR] [FAIL]   open_library: 'BookSourceManager' object has no attribute '_fetch_openlibrary_books'
2025-11-05 11:32:02 [INFO] [INFO] 
Summary:
2025-11-05 11:32:02 [INFO] Debug book sources test completed
2025-11-05 11:32:02 [INFO] 
======================================================================
2025-11-05 11:32:02 [INFO] TEST: B5: Session Creation & Message Seeding
2025-11-05 11:32:02 [INFO] ======================================================================
2025-11-05 11:34:17 [INFO] [INFO] 
Creating brainstorming session for user: 04E9XYnVi8QD3yHAIXeBHCRp2sN2
2025-11-05 11:34:18 [INFO] [PASS] Session created: -OdH43uUJkdE579yuIsj
2025-11-05 11:34:18 [INFO] Session created: -OdH43uUJkdE579yuIsj for user: 04E9XYnVi8QD3yHAIXeBHCRp2sN2
2025-11-05 11:34:18 [INFO] [INFO] Seeding 5 messages...
2025-11-05 11:34:21 [INFO] [PASS] All 5 messages seeded successfully
2025-11-05 11:34:21 [INFO] Successfully seeded 5 messages
2025-11-05 11:34:22 [INFO] [INFO] Session verification:
2025-11-05 11:34:22 [INFO] 
======================================================================
2025-11-05 11:34:22 [INFO] TEST: B6: Full Recommendation Endpoint
2025-11-05 11:34:22 [INFO] ======================================================================
2025-11-05 11:34:22 [INFO] [INFO] 
Testing recommendations for:
2025-11-05 11:34:22 [INFO] [INFO] 
Sending request...
2025-11-05 11:34:50 [INFO] [PASS] Returned 1 books in 28.35s
2025-11-05 11:34:50 [INFO] Full recommendation test passed: 1 books returned
2025-11-05 11:34:50 [INFO] ======================================================================
2025-11-05 11:34:50 [INFO] TEST SUMMARY
2025-11-05 11:34:50 [INFO] ======================================================================
2025-11-05 11:34:50 [INFO] 
Section A: Query Effectiveness:
2025-11-05 11:34:50 [INFO] [PASS] A1: Query Generation
2025-11-05 11:34:50 [INFO] [PASS] A2: Book Fetching
2025-11-05 11:34:50 [INFO] [PASS] A3: Book Relevance
2025-11-05 11:34:50 [INFO] [PASS] A4: Fallback Behavior
2025-11-05 11:34:50 [INFO] 
Section B: API Integration:
2025-11-05 11:34:50 [ERROR] [FAIL] B1: Google Books API
2025-11-05 11:34:50 [INFO] [PASS] B2: Session API
2025-11-05 11:34:50 [INFO] [PASS] B3: Server Health
2025-11-05 11:34:50 [INFO] [PASS] B4: Debug Book Sources
2025-11-05 11:34:50 [INFO] [PASS] B5: Session Creation
2025-11-05 11:34:50 [INFO] [PASS] B6: Full Recommendation
2025-11-05 11:34:50 [INFO] 
Overall Results: 9 passed, 1 failed, 0 skipped out of 10 tests
2025-11-05 11:34:50 [WARNING] [FAILURE] 1 tests failed out of 10
2025-11-05 11:34:50 [INFO] ======================================================================
2025-11-05 11:34:50 [INFO] QUICK TIPS
2025-11-05 11:34:50 [INFO] ======================================================================
2025-11-05 11:34:50 [INFO] Section A (Query Effectiveness):
2025-11-05 11:34:50 [INFO]   - Tests core query generation and book fetching logic
2025-11-05 11:34:50 [INFO]   - Requires Google Books API key to be set
2025-11-05 11:34:50 [INFO]   - Can run independently of Flask server
2025-11-05 11:34:50 [INFO] Section B (API Integration):
2025-11-05 11:34:50 [INFO]   - Tests full end-to-end recommendation flow
2025-11-05 11:34:50 [INFO]   - Requires Flask server running: python app.py
2025-11-05 11:34:50 [INFO]   - Requires Session API (or use deployed version)
2025-11-05 11:34:50 [INFO]   - Use Test B5 to create pre-seeded sessions for B6
2025-11-05 11:34:50 [INFO] For detailed logs:
2025-11-05 11:34:50 [INFO]   - Check logs/recommendation_tests.log
2025-11-05 11:34:50 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-05 11:34:50 [INFO] Common issues:
2025-11-05 11:34:50 [INFO]   - API key not set -> Set GOOGLE_BOOKS_API_KEY environment variable
2025-11-05 11:34:50 [INFO]   - Server not running -> Start Flask server: python app.py
2025-11-05 11:34:50 [INFO]   - Session API down -> Check SESSION_API_URL in script
2025-11-05 11:34:50 [INFO] ======================================================================
2025-11-05 11:34:50 [INFO] TEST SUITE COMPLETE
2025-11-05 11:34:50 [INFO] ======================================================================
2025-11-05 13:11:31 [INFO] ======================================================================
2025-11-05 13:11:31 [INFO] STARTING COMPREHENSIVE BOOK RECOMMENDATION TEST SUITE
2025-11-05 13:11:31 [INFO] ======================================================================
2025-11-05 13:11:31 [WARNING] Google Books API key not set - some tests will be skipped
2025-11-05 13:11:31 [INFO] 
----------------------------------------------------------------------
2025-11-05 13:11:31 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-05 13:11:31 [INFO] ----------------------------------------------------------------------
2025-11-05 13:11:31 [INFO] 
======================================================================
2025-11-05 13:11:31 [INFO] TEST: A1: Query Generation
2025-11-05 13:11:31 [INFO] ======================================================================
2025-11-05 13:11:31 [INFO] Testing query generation for: Fantasy with Magic
2025-11-05 13:11:31 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:11:31 [DEBUG]     Query 1: fantasy young adult magic identity
2025-11-05 13:11:31 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-05 13:11:31 [INFO] Testing query generation for: Sci-Fi with AI Theme
2025-11-05 13:11:31 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:11:31 [DEBUG]     Query 1: sci-fi artificial intelligence ethics
2025-11-05 13:11:31 [INFO] [PASS]   Queries include genre 'sci-fi'
2025-11-05 13:11:31 [INFO] Testing query generation for: Mystery with Deception
2025-11-05 13:11:31 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:11:31 [DEBUG]     Query 1: mystery deception truth
2025-11-05 13:11:31 [INFO] [PASS]   Queries include genre 'mystery'
2025-11-05 13:11:31 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-05 13:11:31 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:11:31 [DEBUG]     Query 1: dystopian freedom rebellion
2025-11-05 13:11:31 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-05 13:11:31 [INFO] Query Generation Test: 4/4 passed
2025-11-05 13:11:31 [INFO] 
======================================================================
2025-11-05 13:11:31 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-05 13:11:31 [INFO] ======================================================================
2025-11-05 13:11:31 [INFO] Testing book fetching for: Fantasy with Magic
2025-11-05 13:11:31 [INFO] [INFO]   Fetching books...
2025-11-05 13:11:31 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:11:31 [INFO]   Successfully fetched 5 books for Fantasy with Magic
2025-11-05 13:11:31 [DEBUG]     Book 1: Children's Fantasy Literature by Michael Levy
2025-11-05 13:11:31 [DEBUG]     Book 2: Female Heroes in Young Adult Fantasy Fiction by Leah Phillips
2025-11-05 13:11:31 [DEBUG]     Book 3: Fantasy Global Appeal by Nakoa Rainfall
2025-11-05 13:11:31 [INFO] Testing book fetching for: Sci-Fi with AI Theme
2025-11-05 13:11:31 [INFO] [INFO]   Fetching books...
2025-11-05 13:11:32 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:11:32 [INFO]   Successfully fetched 5 books for Sci-Fi with AI Theme
2025-11-05 13:11:32 [DEBUG]     Book 1: Artificial Intelligence Ethics by Fouad Sabry
2025-11-05 13:11:32 [DEBUG]     Book 2: Artificial Intelligence from Science Fiction to Reality by Emanuel Camilleri
2025-11-05 13:11:32 [DEBUG]     Book 3: The Fictional Frontier: Artificial Intelligence in Sci-Fi and Its Real-World Implications by S Williams
2025-11-05 13:11:32 [INFO] Testing book fetching for: Mystery with Deception
2025-11-05 13:11:32 [INFO] [INFO]   Fetching books...
2025-11-05 13:11:33 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:11:33 [INFO]   Successfully fetched 5 books for Mystery with Deception
2025-11-05 13:11:33 [DEBUG]     Book 1: Unveiling the Mysteries: In Pursuit of the Hidden Truth by Pasquale De Marco
2025-11-05 13:11:33 [DEBUG]     Book 2: Defying Deception by Jonathan K. Corrado
2025-11-05 13:11:33 [DEBUG]     Book 3: The Answer Mystery Of The Truth by Craig Cox
2025-11-05 13:11:33 [INFO] Testing book fetching for: Dystopian with Rebellion
2025-11-05 13:11:33 [INFO] [INFO]   Fetching books...
2025-11-05 13:11:35 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:11:35 [INFO]   Successfully fetched 5 books for Dystopian with Rebellion
2025-11-05 13:11:35 [DEBUG]     Book 1: DYSTOPIAN LITERATURE by NARAYAN CHANGDER
2025-11-05 13:11:35 [DEBUG]     Book 2: DYSTOPIAN by NARAYAN CHANGDER
2025-11-05 13:11:35 [DEBUG]     Book 3: Contemporary Dystopian Fiction for Young Adults by Balaka Basu
2025-11-05 13:11:35 [INFO] Book Fetching Test: 4/4 passed
2025-11-05 13:11:35 [INFO] 
======================================================================
2025-11-05 13:11:35 [INFO] TEST: A3: Book Relevance Validation
2025-11-05 13:11:35 [INFO] ======================================================================
2025-11-05 13:11:35 [INFO] [INFO]   Expected genre: fantasy
2025-11-05 13:11:35 [INFO] [INFO]   Expected keywords: magic, fantasy, wizard, enchant
2025-11-05 13:11:35 [INFO] Testing book relevance for: Fantasy with Magic
2025-11-05 13:11:36 [INFO]   Relevance for Fantasy with Magic: 100.0%
2025-11-05 13:11:36 [INFO] [PASS]   Sufficient relevance
2025-11-05 13:11:36 [INFO] [INFO]   Expected genre: science fiction
2025-11-05 13:11:36 [INFO] [INFO]   Expected keywords: robot, AI, technology, future, android
2025-11-05 13:11:36 [INFO] Testing book relevance for: Sci-Fi with AI Theme
2025-11-05 13:11:37 [INFO]   Relevance for Sci-Fi with AI Theme: 100.0%
2025-11-05 13:11:37 [INFO] [PASS]   Sufficient relevance
2025-11-05 13:11:37 [INFO] [INFO]   Expected genre: mystery
2025-11-05 13:11:37 [INFO] [INFO]   Expected keywords: mystery, detective, solve, clue, investigate
2025-11-05 13:11:37 [INFO] Testing book relevance for: Mystery with Deception
2025-11-05 13:11:38 [INFO]   Relevance for Mystery with Deception: 60.0%
2025-11-05 13:11:38 [INFO] [PASS]   Sufficient relevance
2025-11-05 13:11:38 [INFO] [INFO]   Expected genre: dystopian
2025-11-05 13:11:38 [INFO] [INFO]   Expected keywords: dystopia, rebellion, totalitarian, oppression, resistance
2025-11-05 13:11:38 [INFO] Testing book relevance for: Dystopian with Rebellion
2025-11-05 13:11:40 [INFO]   Relevance for Dystopian with Rebellion: 100.0%
2025-11-05 13:11:40 [INFO] [PASS]   Sufficient relevance
2025-11-05 13:11:40 [INFO] Book Relevance Test: 4/4 passed
2025-11-05 13:11:40 [INFO] 
======================================================================
2025-11-05 13:11:40 [INFO] TEST: A4: Query Fallback Behavior
2025-11-05 13:11:40 [INFO] ======================================================================
2025-11-05 13:11:40 [INFO] [INFO] Testing with intentionally obscure queries...
2025-11-05 13:11:40 [INFO] Testing fallback behavior with obscure queries
2025-11-05 13:11:42 [INFO] [PASS]   Fallback returned 5 books despite obscure query
2025-11-05 13:11:42 [INFO]   Fallback successful: 5 books returned
2025-11-05 13:11:42 [INFO] 
----------------------------------------------------------------------
2025-11-05 13:11:42 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-05 13:11:42 [INFO] ----------------------------------------------------------------------
2025-11-05 13:11:42 [INFO] 
======================================================================
2025-11-05 13:11:42 [INFO] TEST: B1: Google Books API Direct Call
2025-11-05 13:11:42 [INFO] ======================================================================
2025-11-05 13:11:42 [ERROR] [FAIL] Google Books API Key not set in environment
2025-11-05 13:11:42 [WARNING] Google Books API key not set
2025-11-05 13:11:42 [INFO] 
======================================================================
2025-11-05 13:11:42 [INFO] TEST: B2: Session API Connection
2025-11-05 13:11:42 [INFO] ======================================================================
2025-11-05 13:11:43 [INFO] [PASS] Session API is reachable
2025-11-05 13:11:43 [INFO] [INFO]   Test session created: -OdHQMvOgbI3GRPYliyH
2025-11-05 13:11:43 [INFO] Session API connection test passed
2025-11-05 13:11:43 [INFO] 
======================================================================
2025-11-05 13:11:43 [INFO] TEST: B3: Flask Server Health Check
2025-11-05 13:11:43 [INFO] ======================================================================
2025-11-05 13:11:45 [INFO] [PASS] Server status: ok
2025-11-05 13:11:45 [INFO] [PASS]   brainstorming: running
2025-11-05 13:11:45 [INFO] [PASS]   character_extraction: running
2025-11-05 13:11:45 [INFO] [PASS]   deepthinking: running
2025-11-05 13:11:45 [INFO] [PASS]   image_generation: running
2025-11-05 13:11:45 [INFO] [PASS]   world_ai: running
2025-11-05 13:11:45 [INFO] Flask server health check passed
2025-11-05 13:11:45 [INFO] 
======================================================================
2025-11-05 13:11:45 [INFO] TEST: B4: Debug Book Sources
2025-11-05 13:11:45 [INFO] ======================================================================
2025-11-05 13:11:45 [INFO] [INFO] Testing each book source individually...
2025-11-05 13:11:47 [INFO] [INFO] 
Configuration:
2025-11-05 13:11:47 [INFO] [PASS]   Google Books API key: Set
2025-11-05 13:11:47 [INFO] [INFO] 
Source Results:
2025-11-05 13:11:47 [INFO] [PASS]   curated: 3 books
2025-11-05 13:11:47 [ERROR] [FAIL]   google_books: 'BookSourceManager' object has no attribute '_fetch_google_books'
2025-11-05 13:11:47 [ERROR] [FAIL]   open_library: 'BookSourceManager' object has no attribute '_fetch_openlibrary_books'
2025-11-05 13:11:47 [INFO] [INFO] 
Summary:
2025-11-05 13:11:47 [INFO] Debug book sources test completed
2025-11-05 13:11:47 [INFO] 
======================================================================
2025-11-05 13:11:47 [INFO] TEST: B5: Session Creation & Message Seeding
2025-11-05 13:11:47 [INFO] ======================================================================
2025-11-05 13:14:29 [INFO] [INFO] 
Creating brainstorming session for user: 04E9XYnVi8QD3yHAIXeBHCRp2sN2
2025-11-05 13:14:30 [INFO] [PASS] Session created: -OdHR-qDJU5rl_1gV1fx
2025-11-05 13:14:30 [INFO] Session created: -OdHR-qDJU5rl_1gV1fx for user: 04E9XYnVi8QD3yHAIXeBHCRp2sN2
2025-11-05 13:14:30 [INFO] [INFO] Seeding 5 messages...
2025-11-05 13:14:34 [INFO] [PASS] All 5 messages seeded successfully
2025-11-05 13:14:34 [INFO] Successfully seeded 5 messages
2025-11-05 13:14:35 [INFO] [INFO] Session verification:
2025-11-05 13:14:35 [INFO] 
======================================================================
2025-11-05 13:14:35 [INFO] TEST: B6: Full Recommendation Endpoint
2025-11-05 13:14:35 [INFO] ======================================================================
2025-11-05 13:14:35 [INFO] [INFO] 
Testing recommendations for:
2025-11-05 13:14:35 [INFO] [INFO] 
Sending request...
2025-11-05 13:14:57 [INFO] [PASS] Returned 1 books in 22.30s
2025-11-05 13:14:57 [INFO] Full recommendation test passed: 1 books returned
2025-11-05 13:14:57 [INFO] ======================================================================
2025-11-05 13:14:57 [INFO] TEST SUMMARY
2025-11-05 13:14:57 [INFO] ======================================================================
2025-11-05 13:14:57 [INFO] 
Section A: Query Effectiveness:
2025-11-05 13:14:57 [INFO] [PASS] A1: Query Generation
2025-11-05 13:14:57 [INFO] [PASS] A2: Book Fetching
2025-11-05 13:14:57 [INFO] [PASS] A3: Book Relevance
2025-11-05 13:14:57 [INFO] [PASS] A4: Fallback Behavior
2025-11-05 13:14:57 [INFO] 
Section B: API Integration:
2025-11-05 13:14:57 [ERROR] [FAIL] B1: Google Books API
2025-11-05 13:14:57 [INFO] [PASS] B2: Session API
2025-11-05 13:14:57 [INFO] [PASS] B3: Server Health
2025-11-05 13:14:57 [INFO] [PASS] B4: Debug Book Sources
2025-11-05 13:14:57 [INFO] [PASS] B5: Session Creation
2025-11-05 13:14:57 [INFO] [PASS] B6: Full Recommendation
2025-11-05 13:14:57 [INFO] 
Overall Results: 9 passed, 1 failed, 0 skipped out of 10 tests
2025-11-05 13:14:57 [WARNING] [FAILURE] 1 tests failed out of 10
2025-11-05 13:14:57 [INFO] ======================================================================
2025-11-05 13:14:57 [INFO] QUICK TIPS
2025-11-05 13:14:57 [INFO] ======================================================================
2025-11-05 13:14:57 [INFO] Section A (Query Effectiveness):
2025-11-05 13:14:57 [INFO]   - Tests core query generation and book fetching logic
2025-11-05 13:14:57 [INFO]   - Requires Google Books API key to be set
2025-11-05 13:14:57 [INFO]   - Can run independently of Flask server
2025-11-05 13:14:57 [INFO] Section B (API Integration):
2025-11-05 13:14:57 [INFO]   - Tests full end-to-end recommendation flow
2025-11-05 13:14:57 [INFO]   - Requires Flask server running: python app.py
2025-11-05 13:14:57 [INFO]   - Requires Session API (or use deployed version)
2025-11-05 13:14:57 [INFO]   - Use Test B5 to create pre-seeded sessions for B6
2025-11-05 13:14:57 [INFO] For detailed logs:
2025-11-05 13:14:57 [INFO]   - Check logs/recommendation_tests.log
2025-11-05 13:14:57 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-05 13:14:57 [INFO] Common issues:
2025-11-05 13:14:57 [INFO]   - API key not set -> Set GOOGLE_BOOKS_API_KEY environment variable
2025-11-05 13:14:57 [INFO]   - Server not running -> Start Flask server: python app.py
2025-11-05 13:14:57 [INFO]   - Session API down -> Check SESSION_API_URL in script
2025-11-05 13:14:57 [INFO] ======================================================================
2025-11-05 13:14:57 [INFO] TEST SUITE COMPLETE
2025-11-05 13:14:57 [INFO] ======================================================================
2025-11-05 13:19:36 [INFO] ======================================================================
2025-11-05 13:19:36 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-05 13:19:36 [INFO] ======================================================================
2025-11-05 13:19:36 [INFO] 
----------------------------------------------------------------------
2025-11-05 13:19:36 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-05 13:19:36 [INFO] ----------------------------------------------------------------------
2025-11-05 13:19:36 [INFO] 
======================================================================
2025-11-05 13:19:36 [INFO] TEST: A1: Query Generation
2025-11-05 13:19:36 [INFO] ======================================================================
2025-11-05 13:19:36 [INFO] Testing query generation for: Fantasy with Magic
2025-11-05 13:19:36 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:19:36 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-05 13:19:36 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-05 13:19:36 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:19:36 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-05 13:19:36 [INFO] Query Generation Test: 2/2 passed
2025-11-05 13:19:36 [INFO] 
======================================================================
2025-11-05 13:19:36 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-05 13:19:36 [INFO] ======================================================================
2025-11-05 13:19:36 [INFO] [INFO]   Fetching books...
2025-11-05 13:19:37 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:19:37 [INFO] [INFO]   Fetching books...
2025-11-05 13:19:38 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:19:38 [INFO] 
----------------------------------------------------------------------
2025-11-05 13:19:38 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-05 13:19:38 [INFO] ----------------------------------------------------------------------
2025-11-05 13:21:05 [INFO] ======================================================================
2025-11-05 13:21:05 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-05 13:21:05 [INFO] ======================================================================
2025-11-05 13:21:05 [INFO] 
----------------------------------------------------------------------
2025-11-05 13:21:05 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-05 13:21:05 [INFO] ----------------------------------------------------------------------
2025-11-05 13:21:05 [INFO] 
======================================================================
2025-11-05 13:21:05 [INFO] TEST: A1: Query Generation
2025-11-05 13:21:05 [INFO] ======================================================================
2025-11-05 13:21:05 [INFO] Testing query generation for: Fantasy with Magic
2025-11-05 13:21:05 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:21:05 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-05 13:21:05 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-05 13:21:05 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:21:05 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-05 13:21:05 [INFO] Query Generation Test: 2/2 passed
2025-11-05 13:21:05 [INFO] 
======================================================================
2025-11-05 13:21:05 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-05 13:21:05 [INFO] ======================================================================
2025-11-05 13:21:05 [INFO] [INFO]   Fetching books...
2025-11-05 13:21:06 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:21:06 [INFO] [INFO]   Fetching books...
2025-11-05 13:21:06 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:21:06 [INFO] 
----------------------------------------------------------------------
2025-11-05 13:21:06 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-05 13:21:06 [INFO] ----------------------------------------------------------------------
2025-11-05 13:21:18 [INFO] ======================================================================
2025-11-05 13:21:18 [INFO] STARTING COMPREHENSIVE BOOK RECOMMENDATION TEST SUITE
2025-11-05 13:21:18 [INFO] ======================================================================
2025-11-05 13:21:18 [WARNING] Google Books API key not set - some tests will be skipped
2025-11-05 13:21:18 [INFO] 
----------------------------------------------------------------------
2025-11-05 13:21:18 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-05 13:21:18 [INFO] ----------------------------------------------------------------------
2025-11-05 13:21:18 [INFO] 
======================================================================
2025-11-05 13:21:18 [INFO] TEST: A1: Query Generation
2025-11-05 13:21:18 [INFO] ======================================================================
2025-11-05 13:21:18 [INFO] Testing query generation for: Fantasy with Magic
2025-11-05 13:21:18 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:21:18 [DEBUG]     Query 1: fantasy young adult magic identity
2025-11-05 13:21:18 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-05 13:21:18 [INFO] Testing query generation for: Sci-Fi with AI Theme
2025-11-05 13:21:18 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:21:18 [DEBUG]     Query 1: sci-fi artificial intelligence ethics
2025-11-05 13:21:18 [INFO] [PASS]   Queries include genre 'sci-fi'
2025-11-05 13:21:18 [INFO] Testing query generation for: Mystery with Deception
2025-11-05 13:21:18 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:21:18 [DEBUG]     Query 1: mystery deception truth
2025-11-05 13:21:18 [INFO] [PASS]   Queries include genre 'mystery'
2025-11-05 13:21:18 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-05 13:21:18 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:21:18 [DEBUG]     Query 1: dystopian freedom rebellion
2025-11-05 13:21:18 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-05 13:21:18 [INFO] Query Generation Test: 4/4 passed
2025-11-05 13:21:18 [INFO] 
======================================================================
2025-11-05 13:21:18 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-05 13:21:18 [INFO] ======================================================================
2025-11-05 13:21:18 [INFO] Testing book fetching for: Fantasy with Magic
2025-11-05 13:21:18 [INFO] [INFO]   Fetching books...
2025-11-05 13:21:18 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:21:18 [INFO]   Successfully fetched 5 books for Fantasy with Magic
2025-11-05 13:21:18 [DEBUG]     Book 1: Children's Fantasy Literature by Michael Levy
2025-11-05 13:21:18 [DEBUG]     Book 2: Female Heroes in Young Adult Fantasy Fiction by Leah Phillips
2025-11-05 13:21:18 [DEBUG]     Book 3: Fantasy Global Appeal by Nakoa Rainfall
2025-11-05 13:21:18 [INFO] Testing book fetching for: Sci-Fi with AI Theme
2025-11-05 13:21:18 [INFO] [INFO]   Fetching books...
2025-11-05 13:21:19 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:21:19 [INFO]   Successfully fetched 5 books for Sci-Fi with AI Theme
2025-11-05 13:21:19 [DEBUG]     Book 1: Artificial Intelligence Ethics by Fouad Sabry
2025-11-05 13:21:19 [DEBUG]     Book 2: Artificial Intelligence from Science Fiction to Reality by Emanuel Camilleri
2025-11-05 13:21:19 [DEBUG]     Book 3: The Fictional Frontier: Artificial Intelligence in Sci-Fi and Its Real-World Implications by S Williams
2025-11-05 13:21:19 [INFO] Testing book fetching for: Mystery with Deception
2025-11-05 13:21:19 [INFO] [INFO]   Fetching books...
2025-11-05 13:21:20 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:21:20 [INFO]   Successfully fetched 5 books for Mystery with Deception
2025-11-05 13:21:20 [DEBUG]     Book 1: Unveiling the Mysteries: In Pursuit of the Hidden Truth by Pasquale De Marco
2025-11-05 13:21:20 [DEBUG]     Book 2: Defying Deception by Jonathan K. Corrado
2025-11-05 13:21:20 [DEBUG]     Book 3: The Answer Mystery Of The Truth by Craig Cox
2025-11-05 13:21:20 [INFO] Testing book fetching for: Dystopian with Rebellion
2025-11-05 13:21:20 [INFO] [INFO]   Fetching books...
2025-11-05 13:21:21 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:21:21 [INFO]   Successfully fetched 5 books for Dystopian with Rebellion
2025-11-05 13:21:21 [DEBUG]     Book 1: DYSTOPIAN by NARAYAN CHANGDER
2025-11-05 13:21:21 [DEBUG]     Book 2: DYSTOPIAN LITERATURE by NARAYAN CHANGDER
2025-11-05 13:21:21 [DEBUG]     Book 3: Contemporary Dystopian Fiction for Young Adults by Balaka Basu
2025-11-05 13:21:21 [INFO] Book Fetching Test: 4/4 passed
2025-11-05 13:21:21 [INFO] 
======================================================================
2025-11-05 13:21:21 [INFO] TEST: A3: Book Relevance Validation
2025-11-05 13:21:21 [INFO] ======================================================================
2025-11-05 13:21:21 [INFO] [INFO]   Expected genre: fantasy
2025-11-05 13:21:21 [INFO] [INFO]   Expected keywords: magic, fantasy, wizard, enchant
2025-11-05 13:21:21 [INFO] Testing book relevance for: Fantasy with Magic
2025-11-05 13:21:22 [INFO]   Relevance for Fantasy with Magic: 100.0%
2025-11-05 13:21:22 [INFO] [PASS]   Sufficient relevance
2025-11-05 13:21:22 [INFO] [INFO]   Expected genre: science fiction
2025-11-05 13:21:22 [INFO] [INFO]   Expected keywords: robot, AI, technology, future, android
2025-11-05 13:21:22 [INFO] Testing book relevance for: Sci-Fi with AI Theme
2025-11-05 13:21:23 [INFO]   Relevance for Sci-Fi with AI Theme: 100.0%
2025-11-05 13:21:23 [INFO] [PASS]   Sufficient relevance
2025-11-05 13:21:23 [INFO] [INFO]   Expected genre: mystery
2025-11-05 13:21:23 [INFO] [INFO]   Expected keywords: mystery, detective, solve, clue, investigate
2025-11-05 13:21:23 [INFO] Testing book relevance for: Mystery with Deception
2025-11-05 13:21:24 [INFO]   Relevance for Mystery with Deception: 60.0%
2025-11-05 13:21:24 [INFO] [PASS]   Sufficient relevance
2025-11-05 13:21:24 [INFO] [INFO]   Expected genre: dystopian
2025-11-05 13:21:24 [INFO] [INFO]   Expected keywords: dystopia, rebellion, totalitarian, oppression, resistance
2025-11-05 13:21:24 [INFO] Testing book relevance for: Dystopian with Rebellion
2025-11-05 13:21:25 [INFO]   Relevance for Dystopian with Rebellion: 100.0%
2025-11-05 13:21:25 [INFO] [PASS]   Sufficient relevance
2025-11-05 13:21:25 [INFO] Book Relevance Test: 4/4 passed
2025-11-05 13:21:25 [INFO] 
======================================================================
2025-11-05 13:21:25 [INFO] TEST: A4: Query Fallback Behavior
2025-11-05 13:21:25 [INFO] ======================================================================
2025-11-05 13:21:25 [INFO] [INFO] Testing with intentionally obscure queries...
2025-11-05 13:21:25 [INFO] Testing fallback behavior with obscure queries
2025-11-05 13:21:25 [INFO] [PASS]   Fallback returned 5 books despite obscure query
2025-11-05 13:21:25 [INFO]   Fallback successful: 5 books returned
2025-11-05 13:21:25 [INFO] 
----------------------------------------------------------------------
2025-11-05 13:21:25 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-05 13:21:25 [INFO] ----------------------------------------------------------------------
2025-11-05 13:21:25 [INFO] 
======================================================================
2025-11-05 13:21:25 [INFO] TEST: B1: Google Books API Direct Call
2025-11-05 13:21:25 [INFO] ======================================================================
2025-11-05 13:21:25 [ERROR] [FAIL] Google Books API Key not set in environment
2025-11-05 13:21:25 [WARNING] Google Books API key not set
2025-11-05 13:21:25 [INFO] 
======================================================================
2025-11-05 13:21:25 [INFO] TEST: B2: Session API Connection
2025-11-05 13:21:25 [INFO] ======================================================================
2025-11-05 13:21:27 [INFO] [PASS] Session API is reachable
2025-11-05 13:21:27 [INFO] [INFO]   Test session created: -OdHSaTHP6OXkT9mgIhe
2025-11-05 13:21:27 [INFO] Session API connection test passed
2025-11-05 13:21:27 [INFO] 
======================================================================
2025-11-05 13:21:27 [INFO] TEST: B3: Flask Server Health Check
2025-11-05 13:21:27 [INFO] ======================================================================
2025-11-05 13:21:29 [INFO] [PASS] Server status: ok
2025-11-05 13:21:29 [INFO] [PASS]   brainstorming: running
2025-11-05 13:21:29 [INFO] [PASS]   character_extraction: running
2025-11-05 13:21:29 [INFO] [PASS]   deepthinking: running
2025-11-05 13:21:29 [INFO] [PASS]   image_generation: running
2025-11-05 13:21:29 [INFO] [PASS]   world_ai: running
2025-11-05 13:21:29 [INFO] Flask server health check passed
2025-11-05 13:21:29 [INFO] 
======================================================================
2025-11-05 13:21:29 [INFO] TEST: B4: Debug Book Sources
2025-11-05 13:21:29 [INFO] ======================================================================
2025-11-05 13:21:29 [INFO] [INFO] Testing each book source individually...
2025-11-05 13:21:31 [INFO] [INFO] 
Configuration:
2025-11-05 13:21:31 [INFO] [PASS]   Google Books API key: Set
2025-11-05 13:21:31 [INFO] [INFO] 
Source Results:
2025-11-05 13:21:31 [INFO] [PASS]   curated: 3 books
2025-11-05 13:21:31 [ERROR] [FAIL]   google_books: 'BookSourceManager' object has no attribute '_fetch_google_books'
2025-11-05 13:21:31 [ERROR] [FAIL]   open_library: 'BookSourceManager' object has no attribute '_fetch_openlibrary_books'
2025-11-05 13:21:31 [INFO] [INFO] 
Summary:
2025-11-05 13:21:31 [INFO] Debug book sources test completed
2025-11-05 13:21:31 [INFO] 
======================================================================
2025-11-05 13:21:31 [INFO] TEST: B5: Session Creation & Message Seeding
2025-11-05 13:21:31 [INFO] ======================================================================
2025-11-05 13:22:39 [INFO] [INFO] 
Creating brainstorming session for user: 04E9XYnVi8QD3yHAIXeBHCRp2sN2
2025-11-05 13:22:40 [INFO] [PASS] Session created: -OdHSsNvh0triIRLfFf-
2025-11-05 13:22:40 [INFO] Session created: -OdHSsNvh0triIRLfFf- for user: 04E9XYnVi8QD3yHAIXeBHCRp2sN2
2025-11-05 13:22:40 [INFO] [INFO] Seeding 5 messages...
2025-11-05 13:22:44 [INFO] [PASS] All 5 messages seeded successfully
2025-11-05 13:22:44 [INFO] Successfully seeded 5 messages
2025-11-05 13:22:44 [INFO] [INFO] Session verification:
2025-11-05 13:22:44 [INFO] 
======================================================================
2025-11-05 13:22:44 [INFO] TEST: B6: Full Recommendation Endpoint
2025-11-05 13:22:44 [INFO] ======================================================================
2025-11-05 13:22:44 [INFO] [INFO] 
Testing recommendations for:
2025-11-05 13:22:44 [INFO] [INFO] 
Sending request...
2025-11-05 13:23:18 [INFO] [PASS] Returned 1 books in 34.22s
2025-11-05 13:23:18 [INFO] Full recommendation test passed: 1 books returned
2025-11-05 13:23:18 [INFO] ======================================================================
2025-11-05 13:23:18 [INFO] TEST SUMMARY
2025-11-05 13:23:18 [INFO] ======================================================================
2025-11-05 13:23:18 [INFO] 
Section A: Query Effectiveness:
2025-11-05 13:23:18 [INFO] [PASS] A1: Query Generation
2025-11-05 13:23:18 [INFO] [PASS] A2: Book Fetching
2025-11-05 13:23:18 [INFO] [PASS] A3: Book Relevance
2025-11-05 13:23:18 [INFO] [PASS] A4: Fallback Behavior
2025-11-05 13:23:18 [INFO] 
Section B: API Integration:
2025-11-05 13:23:18 [ERROR] [FAIL] B1: Google Books API
2025-11-05 13:23:18 [INFO] [PASS] B2: Session API
2025-11-05 13:23:18 [INFO] [PASS] B3: Server Health
2025-11-05 13:23:18 [INFO] [PASS] B4: Debug Book Sources
2025-11-05 13:23:18 [INFO] [PASS] B5: Session Creation
2025-11-05 13:23:18 [INFO] [PASS] B6: Full Recommendation
2025-11-05 13:23:18 [INFO] 
Overall Results: 9 passed, 1 failed, 0 skipped out of 10 tests
2025-11-05 13:23:19 [WARNING] [FAILURE] 1 tests failed out of 10
2025-11-05 13:23:19 [INFO] ======================================================================
2025-11-05 13:23:19 [INFO] QUICK TIPS
2025-11-05 13:23:19 [INFO] ======================================================================
2025-11-05 13:23:19 [INFO] Section A (Query Effectiveness):
2025-11-05 13:23:19 [INFO]   - Tests core query generation and book fetching logic
2025-11-05 13:23:19 [INFO]   - Requires Google Books API key to be set
2025-11-05 13:23:19 [INFO]   - Can run independently of Flask server
2025-11-05 13:23:19 [INFO] Section B (API Integration):
2025-11-05 13:23:19 [INFO]   - Tests full end-to-end recommendation flow
2025-11-05 13:23:19 [INFO]   - Requires Flask server running: python app.py
2025-11-05 13:23:19 [INFO]   - Requires Session API (or use deployed version)
2025-11-05 13:23:19 [INFO]   - Use Test B5 to create pre-seeded sessions for B6
2025-11-05 13:23:19 [INFO] For detailed logs:
2025-11-05 13:23:19 [INFO]   - Check logs/recommendation_tests.log
2025-11-05 13:23:19 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-05 13:23:19 [INFO] Common issues:
2025-11-05 13:23:19 [INFO]   - API key not set -> Set GOOGLE_BOOKS_API_KEY environment variable
2025-11-05 13:23:19 [INFO]   - Server not running -> Start Flask server: python app.py
2025-11-05 13:23:19 [INFO]   - Session API down -> Check SESSION_API_URL in script
2025-11-05 13:23:19 [INFO] ======================================================================
2025-11-05 13:23:19 [INFO] TEST SUITE COMPLETE
2025-11-05 13:23:19 [INFO] ======================================================================
2025-11-05 13:26:01 [INFO] ======================================================================
2025-11-05 13:26:01 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-05 13:26:01 [INFO] ======================================================================
2025-11-05 13:26:01 [INFO] 
----------------------------------------------------------------------
2025-11-05 13:26:01 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-05 13:26:01 [INFO] ----------------------------------------------------------------------
2025-11-05 13:26:01 [INFO] 
======================================================================
2025-11-05 13:26:01 [INFO] TEST: A1: Query Generation
2025-11-05 13:26:01 [INFO] ======================================================================
2025-11-05 13:26:01 [INFO] Testing query generation for: Fantasy with Magic
2025-11-05 13:26:01 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:26:01 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-05 13:26:01 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-05 13:26:01 [INFO] [INFO]   Generated 1 queries:
2025-11-05 13:26:01 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-05 13:26:01 [INFO] Query Generation Test: 2/2 passed
2025-11-05 13:26:01 [INFO] 
======================================================================
2025-11-05 13:26:01 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-05 13:26:01 [INFO] ======================================================================
2025-11-05 13:26:01 [INFO] [INFO]   Fetching books...
2025-11-05 13:26:03 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:26:03 [INFO] [INFO]   Fetching books...
2025-11-05 13:26:03 [INFO] [PASS]   Fetched 5 books
2025-11-05 13:26:03 [INFO] 
----------------------------------------------------------------------
2025-11-05 13:26:03 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-05 13:26:03 [INFO] ----------------------------------------------------------------------
2025-11-05 13:26:03 [INFO] 
======================================================================
2025-11-05 13:26:03 [INFO] TEST: B1: Google Books API Direct Call
2025-11-05 13:26:03 [INFO] ======================================================================
2025-11-05 13:26:03 [ERROR] [FAIL] Google Books API Key not set in environment
2025-11-05 13:26:03 [WARNING] Google Books API key not set
2025-11-05 13:26:03 [INFO] 
======================================================================
2025-11-05 13:26:03 [INFO] TEST: B1: Flask Server Health Check
2025-11-05 13:26:03 [INFO] ======================================================================
2025-11-05 13:26:05 [INFO] [PASS] Server status: ok
2025-11-05 13:26:05 [INFO] 
----------------------------------------------------------------------
2025-11-05 13:26:05 [INFO] SECTION: C: OPEN LIBRARY INTEGRATION TESTS
2025-11-05 13:26:05 [INFO] ----------------------------------------------------------------------
2025-11-05 13:26:05 [INFO] 
======================================================================
2025-11-05 13:26:05 [INFO] TEST: C1: Open Library API Connection
2025-11-05 13:26:05 [INFO] ======================================================================
2025-11-05 13:26:05 [INFO] [INFO] Calling Open Library API...
2025-11-05 13:26:06 [INFO] [PASS] Returned 3 books
2025-11-05 13:26:06 [INFO] Open Library API test passed
2025-11-05 13:26:06 [INFO] 
======================================================================
2025-11-05 13:26:06 [INFO] TEST: C2: Enhanced Open Library Fetching
2025-11-05 13:26:06 [INFO] ======================================================================
2025-11-05 13:26:06 [INFO] [INFO]   Query: 'fantasy young adult magic'
2025-11-05 13:26:07 [INFO] [PASS]   Fetched 10 books
2025-11-05 13:26:07 [INFO] [INFO]   Books with mapped categories: 10/10
2025-11-05 13:26:07 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-05 13:26:07 [INFO] [INFO]   Query: 'dystopian rebellion'
2025-11-05 13:26:07 [INFO] [PASS]   Fetched 10 books
2025-11-05 13:26:07 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-05 13:26:07 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-05 13:26:07 [INFO] [INFO]   Query: 'contemporary realistic fiction'
2025-11-05 13:26:08 [INFO] [PASS]   Fetched 10 books
2025-11-05 13:26:08 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-05 13:26:08 [INFO] [PASS]   Met minimum results (10 >= 2)
2025-11-05 13:26:08 [INFO] Open Library Enhanced Test: 3/3 passed
2025-11-05 13:26:08 [INFO] 
======================================================================
2025-11-05 13:26:08 [INFO] TEST: C3: Open Library Subject Parsing
2025-11-05 13:26:08 [INFO] ======================================================================
2025-11-05 13:26:08 [INFO] [INFO] Analyzing 5 books for subject parsing...
2025-11-05 13:26:08 [INFO] [PASS]   4/5 books have subjects
2025-11-05 13:26:08 [INFO] [INFO]   Average subjects per book: 47.8
2025-11-05 13:26:08 [INFO] [INFO] 
  Sample subjects from 'The Magic Finger':
2025-11-05 13:26:08 [INFO] Open Library subject parsing test passed
2025-11-05 13:26:08 [INFO] 
======================================================================
2025-11-05 13:26:08 [INFO] TEST: C4: Open Library Fallback
2025-11-05 13:26:08 [INFO] ======================================================================
2025-11-05 13:26:08 [INFO] [INFO] Testing with intentionally obscure query...
2025-11-05 13:26:09 [WARNING] [WARN]   Even fallback returned no books (acceptable)
2025-11-05 13:26:09 [INFO] 
----------------------------------------------------------------------
2025-11-05 13:26:09 [INFO] SECTION: D: SUBJECT MAPPING TESTS
2025-11-05 13:26:09 [INFO] ----------------------------------------------------------------------
2025-11-05 13:26:09 [INFO] 
======================================================================
2025-11-05 13:26:09 [INFO] TEST: D1: Subject Mapper Initialization
2025-11-05 13:26:09 [INFO] ======================================================================
2025-11-05 13:26:09 [INFO] [INFO] Dynamic mapping: DISABLED
2025-11-05 13:26:09 [INFO] [INFO] Fallback mappings: 15 categories
2025-11-05 13:26:09 [INFO] [INFO] Cache capacity: 500
2025-11-05 13:26:09 [WARNING] [WARN]   DeepSeek API key not set (using fallback only)
2025-11-05 13:26:09 [INFO] [PASS]   Fallback category 'fantasy' loaded
2025-11-05 13:26:09 [INFO] [PASS]   Fallback category 'sci-fi' loaded
2025-11-05 13:26:09 [INFO] [PASS]   Fallback category 'mystery' loaded
2025-11-05 13:26:09 [INFO] [PASS]   Fallback category 'horror' loaded
2025-11-05 13:26:09 [INFO] [PASS]   Fallback category 'romance' loaded
2025-11-05 13:26:09 [INFO] Subject mapper initialization test passed
2025-11-05 13:26:09 [INFO] 
======================================================================
2025-11-05 13:26:09 [INFO] TEST: D2: Fallback Subject Mapping
2025-11-05 13:26:09 [INFO] ======================================================================
2025-11-05 13:26:09 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-05 13:26:09 [INFO] [INFO]   Mapped to: Coming Of Age, Fantasy
2025-11-05 13:26:09 [INFO] [INFO]   Relevance: 1.00
2025-11-05 13:26:09 [INFO] [INFO]   Method: fallback
2025-11-05 13:26:09 [INFO] [PASS]   Used fallback mapping as expected
2025-11-05 13:26:09 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-05 13:26:09 [INFO] [INFO]   Mapped to: Sci Fi, Coming Of Age, Rebellion
2025-11-05 13:26:09 [INFO] [INFO]   Relevance: 0.80
2025-11-05 13:26:09 [INFO] [INFO]   Method: fallback
2025-11-05 13:26:09 [INFO] [PASS]   Used fallback mapping as expected
2025-11-05 13:26:09 [INFO] [INFO]   Subjects: Mystery, Detective, Crime...
2025-11-05 13:26:09 [INFO] [INFO]   Mapped to: Mystery
2025-11-05 13:26:09 [INFO] [INFO]   Relevance: 1.00
2025-11-05 13:26:09 [INFO] [INFO]   Method: fallback
2025-11-05 13:26:09 [INFO] [PASS]   Used fallback mapping as expected
2025-11-05 13:26:09 [INFO] [INFO]   Subjects: Obscure Topic A, Rare Subject B, Unknown Category C...
2025-11-05 13:26:09 [INFO] [INFO]   Mapped to: Obscure Topic A, Rare Subject B, Unknown Category C
2025-11-05 13:26:09 [INFO] [INFO]   Relevance: 0.00
2025-11-05 13:26:09 [INFO] [INFO]   Method: fallback
2025-11-05 13:26:09 [INFO] [PASS]   Used fallback mapping as expected
2025-11-05 13:26:09 [INFO] Fallback Mapping Test: 4/4 passed
2025-11-05 13:26:09 [INFO] 
======================================================================
2025-11-05 13:26:09 [INFO] TEST: D3: Dynamic Subject Mapping with DeepSeek
2025-11-05 13:26:09 [INFO] ======================================================================
2025-11-05 13:26:09 [WARNING] [WARN] DeepSeek API key not set - skipping dynamic mapping test
2025-11-05 13:26:09 [INFO] 
======================================================================
2025-11-05 13:26:09 [INFO] TEST: D4: Subject Mapping Cache
2025-11-05 13:26:09 [INFO] ======================================================================
2025-11-05 13:26:09 [INFO] [INFO] Testing cache behavior...
2025-11-05 13:26:09 [INFO] [INFO]   First call: fallback (0.0ms)
2025-11-05 13:26:09 [INFO] [INFO]   Second call: cached (0.0ms)
2025-11-05 13:26:09 [INFO] [PASS]   Cache working correctly
2025-11-05 13:26:09 [INFO] [PASS]   Cache returns identical results
2025-11-05 13:26:09 [INFO] 
======================================================================
2025-11-05 13:26:09 [INFO] TEST: D5: Subject Mapping Metrics
2025-11-05 13:26:09 [INFO] ======================================================================
2025-11-05 13:26:09 [INFO] [INFO] Metrics collected:
2025-11-05 13:26:09 [INFO] [PASS]   Metric 'total_calls' present
2025-11-05 13:26:09 [INFO] [PASS]   Metric 'cache_hit_rate' present
2025-11-05 13:26:09 [INFO] [PASS]   Metric 'dynamic_success_rate' present
2025-11-05 13:26:09 [INFO] [PASS]   Metric 'fallback_rate' present
2025-11-05 13:26:09 [INFO] Mapping metrics test passed
2025-11-05 13:26:09 [INFO] ======================================================================
2025-11-05 13:26:09 [INFO] TEST SUMMARY
2025-11-05 13:26:09 [INFO] ======================================================================
2025-11-05 13:26:09 [INFO] 
Section A: Query Effectiveness:
2025-11-05 13:26:09 [INFO] [PASS] A1: Query Generation
2025-11-05 13:26:09 [INFO] [PASS] A2: Book Fetching
2025-11-05 13:26:09 [INFO] 
Section B: API Integration:
2025-11-05 13:26:09 [ERROR] [FAIL] B1: Google Books API
2025-11-05 13:26:09 [INFO] [PASS] B2: Server Health
2025-11-05 13:26:09 [INFO] 
Section C: Open Library Integration:
2025-11-05 13:26:09 [INFO] [PASS] C1: OL API Connection
2025-11-05 13:26:09 [INFO] [PASS] C2: OL Enhanced Fetching
2025-11-05 13:26:09 [INFO] [PASS] C3: OL Subject Parsing
2025-11-05 13:26:09 [INFO] [PASS] C4: OL Fallback
2025-11-05 13:26:09 [INFO] 
Section D: Subject Mapping:
2025-11-05 13:26:09 [INFO] [PASS] D1: Mapper Initialization
2025-11-05 13:26:09 [INFO] [PASS] D2: Fallback Mapping
2025-11-05 13:26:09 [WARNING] [SKIP] D3: Dynamic Mapping
2025-11-05 13:26:09 [INFO] [PASS] D4: Mapping Cache
2025-11-05 13:26:09 [INFO] [PASS] D5: Mapping Metrics
2025-11-05 13:26:09 [INFO] 
Overall Results: 11 passed, 1 failed, 1 skipped out of 13 tests
2025-11-05 13:26:09 [WARNING] [FAILURE] 1 tests failed out of 13
2025-11-05 13:26:09 [INFO] ======================================================================
2025-11-05 13:26:09 [INFO] QUICK TIPS
2025-11-05 13:26:09 [INFO] ======================================================================
2025-11-05 13:26:09 [INFO] Section A (Query Effectiveness):
2025-11-05 13:26:09 [INFO]   - Tests core query generation and book fetching logic
2025-11-05 13:26:09 [INFO]   - Requires Google Books API key to be set
2025-11-05 13:26:09 [INFO]   - Can run independently of Flask server
2025-11-05 13:26:09 [INFO] Section B (API Integration):
2025-11-05 13:26:09 [INFO]   - Tests full end-to-end recommendation flow
2025-11-05 13:26:09 [INFO]   - Requires Flask server running: python app.py
2025-11-05 13:26:09 [INFO] Section C (Open Library Integration):
2025-11-05 13:26:09 [INFO]   - Tests Open Library API connection and fetching
2025-11-05 13:26:09 [INFO]   - Tests subject parsing and mapping integration
2025-11-05 13:26:09 [INFO]   - Tests fallback behavior for obscure queries
2025-11-05 13:26:09 [INFO]   - No API key required (public API)
2025-11-05 13:26:09 [INFO] Section D (Subject Mapping):
2025-11-05 13:26:09 [INFO]   - Tests both dynamic (DeepSeek) and fallback mapping
2025-11-05 13:26:09 [INFO]   - Tests caching and performance metrics
2025-11-05 13:26:09 [INFO]   - Dynamic tests require DEEPSEEK_API_KEY
2025-11-05 13:26:09 [INFO]   - Fallback tests work without API key
2025-11-05 13:26:09 [INFO] Environment Variables:
2025-11-05 13:26:09 [INFO]   - GOOGLE_BOOKS_API_KEY: For Google Books API (optional)
2025-11-05 13:26:09 [INFO]   - DEEPSEEK_API_KEY: For dynamic subject mapping (optional)
2025-11-05 13:26:09 [INFO]   - Without API keys, tests will use fallback methods
2025-11-05 13:26:09 [INFO] For detailed logs:
2025-11-05 13:26:09 [INFO]   - Check logs/recommendation_tests.log
2025-11-05 13:26:09 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-05 13:26:09 [INFO] Common issues:
2025-11-05 13:26:09 [INFO]   - API key not set -> Some tests will be skipped
2025-11-05 13:26:09 [INFO]   - Server not running -> Section B tests will fail
2025-11-05 13:26:09 [INFO]   - Network timeout -> Increase timeout in test config
2025-11-05 13:26:09 [INFO] ======================================================================
2025-11-05 13:26:09 [INFO] TEST SUITE COMPLETE
2025-11-05 13:26:09 [INFO] ======================================================================
2025-11-07 13:20:05 [INFO] ======================================================================
2025-11-07 13:20:05 [INFO] STARTING COMPREHENSIVE BOOK RECOMMENDATION TEST SUITE
2025-11-07 13:20:05 [INFO] ======================================================================
2025-11-07 13:20:05 [WARNING] Google Books API key not set - some tests will be skipped
2025-11-07 13:20:05 [INFO] 
----------------------------------------------------------------------
2025-11-07 13:20:05 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-07 13:20:05 [INFO] ----------------------------------------------------------------------
2025-11-07 13:20:05 [INFO] 
======================================================================
2025-11-07 13:20:05 [INFO] TEST: A1: Query Generation
2025-11-07 13:20:05 [INFO] ======================================================================
2025-11-07 13:20:05 [INFO] Testing query generation for: Fantasy with Magic
2025-11-07 13:20:05 [INFO] [INFO]   Generated 1 queries:
2025-11-07 13:20:05 [DEBUG]     Query 1: fantasy young adult magic identity
2025-11-07 13:20:05 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-07 13:20:05 [INFO] Testing query generation for: Sci-Fi with AI Theme
2025-11-07 13:20:05 [INFO] [INFO]   Generated 1 queries:
2025-11-07 13:20:05 [DEBUG]     Query 1: sci-fi artificial intelligence ethics
2025-11-07 13:20:05 [INFO] [PASS]   Queries include genre 'sci-fi'
2025-11-07 13:20:05 [INFO] Testing query generation for: Mystery with Deception
2025-11-07 13:20:05 [INFO] [INFO]   Generated 1 queries:
2025-11-07 13:20:05 [DEBUG]     Query 1: mystery deception truth
2025-11-07 13:20:05 [INFO] [PASS]   Queries include genre 'mystery'
2025-11-07 13:20:05 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-07 13:20:05 [INFO] [INFO]   Generated 1 queries:
2025-11-07 13:20:05 [DEBUG]     Query 1: dystopian freedom rebellion
2025-11-07 13:20:05 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-07 13:20:05 [INFO] Query Generation Test: 4/4 passed
2025-11-07 13:20:05 [INFO] 
======================================================================
2025-11-07 13:20:05 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-07 13:20:05 [INFO] ======================================================================
2025-11-07 13:20:05 [INFO] Testing book fetching for: Fantasy with Magic
2025-11-07 13:20:05 [INFO] [INFO]   Fetching books...
2025-11-07 13:20:08 [INFO] [PASS]   Fetched 5 books
2025-11-07 13:20:08 [INFO]   Successfully fetched 5 books for Fantasy with Magic
2025-11-07 13:20:08 [DEBUG]     Book 1: Children's Fantasy Literature by Michael Levy
2025-11-07 13:20:08 [DEBUG]     Book 2: Female Heroes in Young Adult Fantasy Fiction by Leah Phillips
2025-11-07 13:20:08 [DEBUG]     Book 3: Fantasy Global Appeal by Nakoa Rainfall
2025-11-07 13:20:08 [INFO] Testing book fetching for: Sci-Fi with AI Theme
2025-11-07 13:20:08 [INFO] [INFO]   Fetching books...
2025-11-07 13:20:10 [INFO] [PASS]   Fetched 5 books
2025-11-07 13:20:10 [INFO]   Successfully fetched 5 books for Sci-Fi with AI Theme
2025-11-07 13:20:10 [DEBUG]     Book 1: Artificial Intelligence Ethics by Fouad Sabry
2025-11-07 13:20:10 [DEBUG]     Book 2: Artificial Intelligence from Science Fiction to Reality by Emanuel Camilleri
2025-11-07 13:20:10 [DEBUG]     Book 3: The Fictional Frontier: Artificial Intelligence in Sci-Fi and Its Real-World Implications by S Williams
2025-11-07 13:20:10 [INFO] Testing book fetching for: Mystery with Deception
2025-11-07 13:20:10 [INFO] [INFO]   Fetching books...
2025-11-07 13:20:11 [INFO] [PASS]   Fetched 5 books
2025-11-07 13:20:11 [INFO]   Successfully fetched 5 books for Mystery with Deception
2025-11-07 13:20:11 [DEBUG]     Book 1: Unveiling the Mysteries: In Pursuit of the Hidden Truth by Pasquale De Marco
2025-11-07 13:20:11 [DEBUG]     Book 2: Defying Deception by Jonathan K. Corrado
2025-11-07 13:20:11 [DEBUG]     Book 3: The Answer Mystery Of The Truth by Craig Cox
2025-11-07 13:20:11 [INFO] Testing book fetching for: Dystopian with Rebellion
2025-11-07 13:20:11 [INFO] [INFO]   Fetching books...
2025-11-07 13:20:12 [INFO] [PASS]   Fetched 5 books
2025-11-07 13:20:12 [INFO]   Successfully fetched 5 books for Dystopian with Rebellion
2025-11-07 13:20:12 [DEBUG]     Book 1: DYSTOPIAN LITERATURE by NARAYAN CHANGDER
2025-11-07 13:20:12 [DEBUG]     Book 2: DYSTOPIAN by NARAYAN CHANGDER
2025-11-07 13:20:12 [DEBUG]     Book 3: Contemporary Dystopian Fiction for Young Adults by Balaka Basu
2025-11-07 13:20:12 [INFO] Book Fetching Test: 4/4 passed
2025-11-07 13:20:12 [INFO] 
======================================================================
2025-11-07 13:20:12 [INFO] TEST: A3: Book Relevance Validation
2025-11-07 13:20:12 [INFO] ======================================================================
2025-11-07 13:20:12 [INFO] [INFO]   Expected genre: fantasy
2025-11-07 13:20:12 [INFO] [INFO]   Expected keywords: magic, fantasy, wizard, enchant
2025-11-07 13:20:12 [INFO] Testing book relevance for: Fantasy with Magic
2025-11-07 13:20:14 [INFO]   Relevance for Fantasy with Magic: 100.0%
2025-11-07 13:20:14 [INFO] [PASS]   Sufficient relevance
2025-11-07 13:20:14 [INFO] [INFO]   Expected genre: science fiction
2025-11-07 13:20:14 [INFO] [INFO]   Expected keywords: robot, AI, technology, future, android
2025-11-07 13:20:14 [INFO] Testing book relevance for: Sci-Fi with AI Theme
2025-11-07 13:20:16 [INFO]   Relevance for Sci-Fi with AI Theme: 100.0%
2025-11-07 13:20:16 [INFO] [PASS]   Sufficient relevance
2025-11-07 13:20:16 [INFO] [INFO]   Expected genre: mystery
2025-11-07 13:20:16 [INFO] [INFO]   Expected keywords: mystery, detective, solve, clue, investigate
2025-11-07 13:20:16 [INFO] Testing book relevance for: Mystery with Deception
2025-11-07 13:20:17 [INFO]   Relevance for Mystery with Deception: 60.0%
2025-11-07 13:20:17 [INFO] [PASS]   Sufficient relevance
2025-11-07 13:20:17 [INFO] [INFO]   Expected genre: dystopian
2025-11-07 13:20:17 [INFO] [INFO]   Expected keywords: dystopia, rebellion, totalitarian, oppression, resistance
2025-11-07 13:20:17 [INFO] Testing book relevance for: Dystopian with Rebellion
2025-11-07 13:20:19 [INFO]   Relevance for Dystopian with Rebellion: 100.0%
2025-11-07 13:20:19 [INFO] [PASS]   Sufficient relevance
2025-11-07 13:20:19 [INFO] Book Relevance Test: 4/4 passed
2025-11-07 13:20:19 [INFO] 
======================================================================
2025-11-07 13:20:19 [INFO] TEST: A4: Query Fallback Behavior
2025-11-07 13:20:19 [INFO] ======================================================================
2025-11-07 13:20:19 [INFO] [INFO] Testing with intentionally obscure queries...
2025-11-07 13:20:19 [INFO] Testing fallback behavior with obscure queries
2025-11-07 13:20:21 [INFO] [PASS]   Fallback returned 5 books despite obscure query
2025-11-07 13:20:21 [INFO]   Fallback successful: 5 books returned
2025-11-07 13:20:21 [INFO] 
----------------------------------------------------------------------
2025-11-07 13:20:21 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-07 13:20:21 [INFO] ----------------------------------------------------------------------
2025-11-07 13:20:21 [INFO] 
======================================================================
2025-11-07 13:20:21 [INFO] TEST: B1: Google Books API Direct Call
2025-11-07 13:20:21 [INFO] ======================================================================
2025-11-07 13:20:21 [ERROR] [FAIL] Google Books API Key not set in environment
2025-11-07 13:20:21 [WARNING] Google Books API key not set
2025-11-07 13:20:21 [INFO] 
======================================================================
2025-11-07 13:20:21 [INFO] TEST: B2: Session API Connection
2025-11-07 13:20:21 [INFO] ======================================================================
2025-11-07 13:20:22 [INFO] [PASS] Session API is reachable
2025-11-07 13:20:23 [INFO] [INFO]   Test session created: -OdRkWgXwPRaIIlPm84G
2025-11-07 13:20:23 [INFO] Session API connection test passed
2025-11-07 13:20:23 [INFO] 
======================================================================
2025-11-07 13:20:23 [INFO] TEST: B3: Flask Server Health Check
2025-11-07 13:20:23 [INFO] ======================================================================
2025-11-07 13:20:25 [INFO] [PASS] Server status: ok
2025-11-07 13:20:25 [INFO] [PASS]   brainstorming: running
2025-11-07 13:20:25 [INFO] [PASS]   character_extraction: running
2025-11-07 13:20:25 [INFO] [PASS]   deepthinking: running
2025-11-07 13:20:25 [INFO] [PASS]   image_generation: running
2025-11-07 13:20:25 [INFO] [PASS]   world_ai: running
2025-11-07 13:20:25 [INFO] Flask server health check passed
2025-11-07 13:20:25 [INFO] 
======================================================================
2025-11-07 13:20:25 [INFO] TEST: B4: Debug Book Sources
2025-11-07 13:20:25 [INFO] ======================================================================
2025-11-07 13:20:25 [INFO] [INFO] Testing each book source individually...
2025-11-07 13:20:41 [INFO] [INFO] 
Configuration:
2025-11-07 13:20:41 [INFO] [PASS]   Google Books API key: Set
2025-11-07 13:20:41 [INFO] [INFO] 
Source Results:
2025-11-07 13:20:41 [INFO] [PASS]   curated: 3 books
2025-11-07 13:20:41 [INFO] [PASS]   google_books: 3 books
2025-11-07 13:20:41 [INFO] [PASS]   open_library: 3 books
2025-11-07 13:20:41 [INFO] [INFO] 
Summary:
2025-11-07 13:20:41 [INFO] Debug book sources test completed
2025-11-07 13:20:41 [INFO] 
======================================================================
2025-11-07 13:20:41 [INFO] TEST: B5: Session Creation & Message Seeding
2025-11-07 13:20:41 [INFO] ======================================================================
2025-11-07 13:21:13 [INFO] [INFO] 
Creating brainstorming session for user: 04E9XYnVi8QD3yHAIXeBHCRp2sN2
2025-11-07 13:21:15 [INFO] [PASS] Session created: -OdRkiKrT6CpDcSmNKPV
2025-11-07 13:21:15 [INFO] Session created: -OdRkiKrT6CpDcSmNKPV for user: 04E9XYnVi8QD3yHAIXeBHCRp2sN2
2025-11-07 13:21:15 [INFO] [INFO] Seeding 5 messages...
2025-11-07 13:21:19 [INFO] [PASS] All 5 messages seeded successfully
2025-11-07 13:21:19 [INFO] Successfully seeded 5 messages
2025-11-07 13:21:20 [INFO] [INFO] Session verification:
2025-11-07 13:21:20 [INFO] 
======================================================================
2025-11-07 13:21:20 [INFO] TEST: B6: Full Recommendation Endpoint
2025-11-07 13:21:20 [INFO] ======================================================================
2025-11-07 13:21:20 [INFO] [INFO] 
Testing recommendations for:
2025-11-07 13:21:20 [INFO] [INFO] 
Sending request...
2025-11-07 13:22:15 [INFO] [PASS] Returned 1 books in 55.30s
2025-11-07 13:22:15 [INFO] Full recommendation test passed: 1 books returned
2025-11-07 13:22:15 [INFO] ======================================================================
2025-11-07 13:22:15 [INFO] TEST SUMMARY
2025-11-07 13:22:15 [INFO] ======================================================================
2025-11-07 13:22:15 [INFO] 
Section A: Query Effectiveness:
2025-11-07 13:22:15 [INFO] PASS: A1: Query Generation
2025-11-07 13:22:15 [INFO] PASS: A2: Book Fetching
2025-11-07 13:22:15 [INFO] PASS: A3: Book Relevance
2025-11-07 13:22:15 [INFO] PASS: A4: Fallback Behavior
2025-11-07 13:22:15 [INFO] 
Section B: API Integration:
2025-11-07 13:22:15 [ERROR] FAIL: B1: Google Books API
2025-11-07 13:22:15 [INFO] PASS: B2: Session API
2025-11-07 13:22:15 [INFO] PASS: B3: Server Health
2025-11-07 13:22:15 [INFO] PASS: B4: Debug Book Sources
2025-11-07 13:22:15 [INFO] PASS: B5: Session Creation
2025-11-07 13:22:15 [INFO] PASS: B6: Full Recommendation
2025-11-07 13:22:15 [INFO] 
Overall Results: 9 passed, 1 failed, 0 skipped out of 10 tests
2025-11-07 13:22:15 [WARNING] FAILURE: 1 tests failed out of 10
2025-11-07 13:22:15 [INFO] ======================================================================
2025-11-07 13:22:15 [INFO] QUICK TIPS
2025-11-07 13:22:15 [INFO] ======================================================================
2025-11-07 13:22:15 [INFO] Section A (Query Effectiveness):
2025-11-07 13:22:15 [INFO]   • Tests core query generation and book fetching logic
2025-11-07 13:22:15 [INFO]   • Requires Google Books API key to be set
2025-11-07 13:22:15 [INFO]   • Can run independently of Flask server
2025-11-07 13:22:15 [INFO] Section B (API Integration):
2025-11-07 13:22:15 [INFO]   • Tests full end-to-end recommendation flow
2025-11-07 13:22:15 [INFO]   • Requires Flask server running: python app.py
2025-11-07 13:22:15 [INFO]   • Requires Session API (or use deployed version)
2025-11-07 13:22:15 [INFO]   • Use Test B5 to create pre-seeded sessions for B6
2025-11-07 13:22:15 [INFO] For detailed logs:
2025-11-07 13:22:15 [INFO]   • Check logs/recommendation_tests.log
2025-11-07 13:22:15 [INFO]   • Check logs/recommendations.log (Flask server)
2025-11-07 13:22:15 [INFO] Common issues:
2025-11-07 13:22:15 [INFO] ======================================================================
2025-11-07 13:22:15 [INFO] TEST SUITE COMPLETE
2025-11-07 13:22:15 [INFO] ======================================================================
2025-11-07 13:24:29 [INFO] ======================================================================
2025-11-07 13:24:29 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-07 13:24:29 [INFO] ======================================================================
2025-11-07 13:24:29 [INFO] 
----------------------------------------------------------------------
2025-11-07 13:24:29 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-07 13:24:29 [INFO] ----------------------------------------------------------------------
2025-11-07 13:24:29 [INFO] 
======================================================================
2025-11-07 13:24:29 [INFO] TEST: A1: Query Generation
2025-11-07 13:24:29 [INFO] ======================================================================
2025-11-07 13:24:29 [INFO] Testing query generation for: Fantasy with Magic
2025-11-07 13:24:29 [INFO] [INFO]   Generated 1 queries:
2025-11-07 13:24:29 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-07 13:24:29 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-07 13:24:29 [INFO] [INFO]   Generated 1 queries:
2025-11-07 13:24:29 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-07 13:24:29 [INFO] Query Generation Test: 2/2 passed
2025-11-07 13:24:29 [INFO] 
======================================================================
2025-11-07 13:24:29 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-07 13:24:29 [INFO] ======================================================================
2025-11-07 13:24:29 [INFO] [INFO]   Fetching books...
2025-11-07 13:24:31 [INFO] [PASS]   Fetched 5 books
2025-11-07 13:24:31 [INFO] [INFO]   Fetching books...
2025-11-07 13:24:32 [INFO] [PASS]   Fetched 5 books
2025-11-07 13:24:32 [INFO] 
----------------------------------------------------------------------
2025-11-07 13:24:32 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-07 13:24:32 [INFO] ----------------------------------------------------------------------
2025-11-07 13:25:46 [INFO] ======================================================================
2025-11-07 13:25:46 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-07 13:25:46 [INFO] ======================================================================
2025-11-07 13:25:46 [INFO] 
----------------------------------------------------------------------
2025-11-07 13:25:46 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-07 13:25:46 [INFO] ----------------------------------------------------------------------
2025-11-07 13:25:46 [INFO] 
======================================================================
2025-11-07 13:25:46 [INFO] TEST: A1: Query Generation
2025-11-07 13:25:46 [INFO] ======================================================================
2025-11-07 13:25:46 [INFO] Testing query generation for: Fantasy with Magic
2025-11-07 13:25:46 [INFO] [INFO]   Generated 1 queries:
2025-11-07 13:25:46 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-07 13:25:46 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-07 13:25:46 [INFO] [INFO]   Generated 1 queries:
2025-11-07 13:25:46 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-07 13:25:46 [INFO] Query Generation Test: 2/2 passed
2025-11-07 13:25:46 [INFO] 
======================================================================
2025-11-07 13:25:46 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-07 13:25:46 [INFO] ======================================================================
2025-11-07 13:25:46 [INFO] [INFO]   Fetching books...
2025-11-07 13:25:47 [INFO] [PASS]   Fetched 5 books
2025-11-07 13:25:47 [INFO] [INFO]   Fetching books...
2025-11-07 13:25:48 [INFO] [PASS]   Fetched 5 books
2025-11-07 13:25:48 [INFO] 
----------------------------------------------------------------------
2025-11-07 13:25:48 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-07 13:25:48 [INFO] ----------------------------------------------------------------------
2025-11-07 13:25:48 [INFO] 
======================================================================
2025-11-07 13:25:48 [INFO] TEST: B1: Flask Server Health Check
2025-11-07 13:25:48 [INFO] ======================================================================
2025-11-07 13:25:50 [INFO] [PASS] Server status: ok
2025-11-07 13:25:50 [INFO] 
----------------------------------------------------------------------
2025-11-07 13:25:50 [INFO] SECTION: C: OPEN LIBRARY INTEGRATION TESTS
2025-11-07 13:25:50 [INFO] ----------------------------------------------------------------------
2025-11-07 13:25:50 [INFO] 
======================================================================
2025-11-07 13:25:50 [INFO] TEST: C1: Open Library API Connection
2025-11-07 13:25:50 [INFO] ======================================================================
2025-11-07 13:25:50 [INFO] [INFO] Calling Open Library API...
2025-11-07 13:25:51 [INFO] [PASS] Returned 3 books
2025-11-07 13:25:51 [INFO] Open Library API test passed
2025-11-07 13:25:51 [INFO] 
======================================================================
2025-11-07 13:25:51 [INFO] TEST: C2: Enhanced Open Library Fetching
2025-11-07 13:25:51 [INFO] ======================================================================
2025-11-07 13:25:51 [INFO] [INFO]   Query: 'fantasy young adult magic'
2025-11-07 13:26:30 [INFO] [PASS]   Fetched 10 books
2025-11-07 13:26:30 [INFO] [INFO]   Books with mapped categories: 10/10
2025-11-07 13:26:30 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-07 13:26:30 [INFO] [INFO]   Query: 'dystopian rebellion'
2025-11-07 13:27:07 [INFO] [PASS]   Fetched 10 books
2025-11-07 13:27:07 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-07 13:27:07 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-07 13:27:07 [INFO] [INFO]   Query: 'contemporary realistic fiction'
2025-11-07 13:27:35 [INFO] [PASS]   Fetched 10 books
2025-11-07 13:27:35 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-07 13:27:35 [INFO] [PASS]   Met minimum results (10 >= 2)
2025-11-07 13:27:35 [INFO] Open Library Enhanced Test: 3/3 passed
2025-11-07 13:27:35 [INFO] 
======================================================================
2025-11-07 13:27:35 [INFO] TEST: C3: Open Library Subject Parsing
2025-11-07 13:27:35 [INFO] ======================================================================
2025-11-07 13:27:37 [INFO] [INFO] Analyzing 5 books for subject parsing...
2025-11-07 13:27:37 [INFO] [PASS]   4/5 books have subjects
2025-11-07 13:27:37 [INFO] [INFO]   Average subjects per book: 47.8
2025-11-07 13:27:37 [INFO] [INFO] 
  Sample subjects from 'The Magic Finger':
2025-11-07 13:27:37 [INFO] Open Library subject parsing test passed
2025-11-07 13:27:37 [INFO] 
======================================================================
2025-11-07 13:27:37 [INFO] TEST: C4: Open Library Fallback
2025-11-07 13:27:37 [INFO] ======================================================================
2025-11-07 13:27:37 [INFO] [INFO] Testing with intentionally obscure query...
2025-11-07 13:27:37 [WARNING] [WARN]   Even fallback returned no books (acceptable)
2025-11-07 13:27:37 [INFO] 
----------------------------------------------------------------------
2025-11-07 13:27:37 [INFO] SECTION: D: SUBJECT MAPPING TESTS
2025-11-07 13:27:37 [INFO] ----------------------------------------------------------------------
2025-11-07 13:27:37 [INFO] 
======================================================================
2025-11-07 13:27:37 [INFO] TEST: D1: Subject Mapper Initialization
2025-11-07 13:27:37 [INFO] ======================================================================
2025-11-07 13:27:37 [INFO] [INFO] Dynamic mapping: ENABLED
2025-11-07 13:27:37 [INFO] [INFO] Fallback mappings: 15 categories
2025-11-07 13:27:37 [INFO] [INFO] Cache capacity: 500
2025-11-07 13:27:37 [INFO] [PASS]   DeepSeek client initialized
2025-11-07 13:27:37 [INFO] [PASS]   Fallback category 'fantasy' loaded
2025-11-07 13:27:37 [INFO] [PASS]   Fallback category 'sci-fi' loaded
2025-11-07 13:27:37 [INFO] [PASS]   Fallback category 'mystery' loaded
2025-11-07 13:27:37 [INFO] [PASS]   Fallback category 'horror' loaded
2025-11-07 13:27:37 [INFO] [PASS]   Fallback category 'romance' loaded
2025-11-07 13:27:37 [INFO] Subject mapper initialization test passed
2025-11-07 13:27:37 [INFO] 
======================================================================
2025-11-07 13:27:37 [INFO] TEST: D2: Fallback Subject Mapping
2025-11-07 13:27:37 [INFO] ======================================================================
2025-11-07 13:27:37 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-07 13:27:37 [INFO] [INFO]   Mapped to: Coming Of Age, Fantasy
2025-11-07 13:27:37 [INFO] [INFO]   Relevance: 1.00
2025-11-07 13:27:37 [INFO] [INFO]   Method: fallback
2025-11-07 13:27:37 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 13:27:37 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-07 13:27:37 [INFO] [INFO]   Mapped to: Rebellion, Sci Fi, Coming Of Age
2025-11-07 13:27:37 [INFO] [INFO]   Relevance: 0.80
2025-11-07 13:27:37 [INFO] [INFO]   Method: fallback
2025-11-07 13:27:37 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 13:27:37 [INFO] [INFO]   Subjects: Mystery, Detective, Crime...
2025-11-07 13:27:37 [INFO] [INFO]   Mapped to: Mystery
2025-11-07 13:27:37 [INFO] [INFO]   Relevance: 1.00
2025-11-07 13:27:37 [INFO] [INFO]   Method: fallback
2025-11-07 13:27:37 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 13:27:37 [INFO] [INFO]   Subjects: Obscure Topic A, Rare Subject B, Unknown Category C...
2025-11-07 13:27:37 [INFO] [INFO]   Mapped to: Rare Subject B, Unknown Category C, Obscure Topic A
2025-11-07 13:27:37 [INFO] [INFO]   Relevance: 0.00
2025-11-07 13:27:37 [INFO] [INFO]   Method: fallback
2025-11-07 13:27:37 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 13:27:37 [INFO] Fallback Mapping Test: 4/4 passed
2025-11-07 13:27:37 [INFO] 
======================================================================
2025-11-07 13:27:37 [INFO] TEST: D3: Dynamic Subject Mapping with DeepSeek
2025-11-07 13:27:37 [INFO] ======================================================================
2025-11-07 13:27:37 [WARNING] [WARN] DeepSeek API key not set - skipping dynamic mapping test
2025-11-07 13:27:37 [INFO] 
======================================================================
2025-11-07 13:27:37 [INFO] TEST: D4: Subject Mapping Cache
2025-11-07 13:27:37 [INFO] ======================================================================
2025-11-07 13:27:37 [INFO] [INFO] Testing cache behavior...
2025-11-07 13:27:40 [INFO] [INFO]   First call: dynamic (2889.3ms)
2025-11-07 13:27:40 [INFO] [INFO]   Second call: cached (0.0ms)
2025-11-07 13:27:40 [INFO] [PASS]   Cache working correctly
2025-11-07 13:27:40 [INFO] [PASS]   Cache faster (0.0ms vs 2889.3ms)
2025-11-07 13:27:40 [INFO] [PASS]   Cache returns identical results
2025-11-07 13:27:40 [INFO] 
======================================================================
2025-11-07 13:27:40 [INFO] TEST: D5: Subject Mapping Metrics
2025-11-07 13:27:40 [INFO] ======================================================================
2025-11-07 13:27:50 [INFO] [INFO] Metrics collected:
2025-11-07 13:27:50 [INFO] [PASS]   Metric 'total_calls' present
2025-11-07 13:27:50 [INFO] [PASS]   Metric 'cache_hit_rate' present
2025-11-07 13:27:50 [INFO] [PASS]   Metric 'dynamic_success_rate' present
2025-11-07 13:27:50 [INFO] [PASS]   Metric 'fallback_rate' present
2025-11-07 13:27:50 [INFO] Mapping metrics test passed
2025-11-07 13:27:50 [INFO] ======================================================================
2025-11-07 13:27:50 [INFO] TEST SUMMARY
2025-11-07 13:27:50 [INFO] ======================================================================
2025-11-07 13:27:50 [INFO] 
Section A: Query Effectiveness:
2025-11-07 13:27:50 [INFO] [PASS] A1: Query Generation
2025-11-07 13:27:50 [INFO] [PASS] A2: Book Fetching
2025-11-07 13:27:50 [INFO] 
Section B: API Integration:
2025-11-07 13:27:50 [INFO] [PASS] B1: Server Health
2025-11-07 13:27:50 [INFO] 
Section C: Open Library Integration:
2025-11-07 13:27:50 [INFO] [PASS] C1: OL API Connection
2025-11-07 13:27:50 [INFO] [PASS] C2: OL Enhanced Fetching
2025-11-07 13:27:50 [INFO] [PASS] C3: OL Subject Parsing
2025-11-07 13:27:50 [INFO] [PASS] C4: OL Fallback
2025-11-07 13:27:50 [INFO] 
Section D: Subject Mapping:
2025-11-07 13:27:50 [INFO] [PASS] D1: Mapper Initialization
2025-11-07 13:27:50 [INFO] [PASS] D2: Fallback Mapping
2025-11-07 13:27:50 [WARNING] [SKIP] D3: Dynamic Mapping
2025-11-07 13:27:50 [INFO] [PASS] D4: Mapping Cache
2025-11-07 13:27:50 [INFO] [PASS] D5: Mapping Metrics
2025-11-07 13:27:50 [INFO] 
Overall Results: 11 passed, 0 failed, 1 skipped out of 12 tests
2025-11-07 13:27:50 [INFO] [SUCCESS] All tests passed (11/12)
2025-11-07 13:27:50 [INFO] ======================================================================
2025-11-07 13:27:50 [INFO] QUICK TIPS
2025-11-07 13:27:50 [INFO] ======================================================================
2025-11-07 13:27:50 [INFO] Section A (Query Effectiveness):
2025-11-07 13:27:50 [INFO]   - Tests core query generation and book fetching logic
2025-11-07 13:27:50 [INFO]   - Requires Google Books API key to be set
2025-11-07 13:27:50 [INFO]   - Can run independently of Flask server
2025-11-07 13:27:50 [INFO] Section B (API Integration):
2025-11-07 13:27:50 [INFO]   - Tests full end-to-end recommendation flow
2025-11-07 13:27:50 [INFO]   - Requires Flask server running: python app.py
2025-11-07 13:27:50 [INFO] Section C (Open Library Integration):
2025-11-07 13:27:50 [INFO]   - Tests Open Library API connection and fetching
2025-11-07 13:27:50 [INFO]   - Tests subject parsing and mapping integration
2025-11-07 13:27:50 [INFO]   - Tests fallback behavior for obscure queries
2025-11-07 13:27:50 [INFO]   - No API key required (public API)
2025-11-07 13:27:50 [INFO] Section D (Subject Mapping):
2025-11-07 13:27:50 [INFO]   - Tests both dynamic (DeepSeek) and fallback mapping
2025-11-07 13:27:50 [INFO]   - Tests caching and performance metrics
2025-11-07 13:27:50 [INFO]   - Dynamic tests require DEEPSEEK_API_KEY
2025-11-07 13:27:50 [INFO]   - Fallback tests work without API key
2025-11-07 13:27:50 [INFO] Environment Variables:
2025-11-07 13:27:50 [INFO]   - GOOGLE_BOOKS_API_KEY: For Google Books API (optional)
2025-11-07 13:27:50 [INFO]   - DEEPSEEK_API_KEY: For dynamic subject mapping (optional)
2025-11-07 13:27:50 [INFO]   - Without API keys, tests will use fallback methods
2025-11-07 13:27:50 [INFO] For detailed logs:
2025-11-07 13:27:50 [INFO]   - Check logs/recommendation_tests.log
2025-11-07 13:27:50 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-07 13:27:50 [INFO] Common issues:
2025-11-07 13:27:50 [INFO]   - API key not set -> Some tests will be skipped
2025-11-07 13:27:50 [INFO]   - Server not running -> Section B tests will fail
2025-11-07 13:27:50 [INFO]   - Network timeout -> Increase timeout in test config
2025-11-07 13:27:50 [INFO] ======================================================================
2025-11-07 13:27:50 [INFO] TEST SUITE COMPLETE
2025-11-07 13:27:50 [INFO] ======================================================================
2025-11-07 13:31:38 [INFO] ======================================================================
2025-11-07 13:31:38 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-07 13:31:38 [INFO] ======================================================================
2025-11-07 13:31:38 [INFO] 
----------------------------------------------------------------------
2025-11-07 13:31:38 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-07 13:31:38 [INFO] ----------------------------------------------------------------------
2025-11-07 13:31:38 [INFO] 
======================================================================
2025-11-07 13:31:38 [INFO] TEST: A1: Query Generation
2025-11-07 13:31:38 [INFO] ======================================================================
2025-11-07 13:31:38 [INFO] Testing query generation for: Fantasy with Magic
2025-11-07 13:31:38 [INFO] [INFO]   Generated 1 queries:
2025-11-07 13:31:38 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-07 13:31:38 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-07 13:31:38 [INFO] [INFO]   Generated 1 queries:
2025-11-07 13:31:38 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-07 13:31:38 [INFO] Query Generation Test: 2/2 passed
2025-11-07 13:31:38 [INFO] 
======================================================================
2025-11-07 13:31:38 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-07 13:31:38 [INFO] ======================================================================
2025-11-07 13:31:38 [INFO] [INFO]   Fetching books...
2025-11-07 13:31:39 [INFO] [PASS]   Fetched 5 books
2025-11-07 13:31:39 [INFO] [INFO]   Fetching books...
2025-11-07 13:31:39 [INFO] [PASS]   Fetched 5 books
2025-11-07 13:31:39 [INFO] 
----------------------------------------------------------------------
2025-11-07 13:31:39 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-07 13:31:39 [INFO] ----------------------------------------------------------------------
2025-11-07 13:31:39 [INFO] 
======================================================================
2025-11-07 13:31:39 [INFO] TEST: B1: Flask Server Health Check
2025-11-07 13:31:39 [INFO] ======================================================================
2025-11-07 13:31:41 [INFO] [PASS] Server status: ok
2025-11-07 13:31:41 [INFO] 
----------------------------------------------------------------------
2025-11-07 13:31:41 [INFO] SECTION: C: OPEN LIBRARY INTEGRATION TESTS
2025-11-07 13:31:41 [INFO] ----------------------------------------------------------------------
2025-11-07 13:31:41 [INFO] 
======================================================================
2025-11-07 13:31:41 [INFO] TEST: C1: Open Library API Connection
2025-11-07 13:31:41 [INFO] ======================================================================
2025-11-07 13:31:41 [INFO] [INFO] Calling Open Library API...
2025-11-07 13:31:43 [INFO] [PASS] Returned 3 books
2025-11-07 13:31:43 [INFO] Open Library API test passed
2025-11-07 13:31:43 [INFO] 
======================================================================
2025-11-07 13:31:43 [INFO] TEST: C2: Enhanced Open Library Fetching
2025-11-07 13:31:43 [INFO] ======================================================================
2025-11-07 13:31:43 [INFO] [INFO]   Query: 'fantasy young adult magic'
2025-11-07 13:32:20 [INFO] [PASS]   Fetched 10 books
2025-11-07 13:32:20 [INFO] [INFO]   Books with mapped categories: 10/10
2025-11-07 13:32:20 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-07 13:32:20 [INFO] [INFO]   Query: 'dystopian rebellion'
2025-11-07 13:32:51 [INFO] [PASS]   Fetched 10 books
2025-11-07 13:32:51 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-07 13:32:51 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-07 13:32:51 [INFO] [INFO]   Query: 'contemporary realistic fiction'
2025-11-07 13:33:22 [INFO] [PASS]   Fetched 10 books
2025-11-07 13:33:22 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-07 13:33:22 [INFO] [PASS]   Met minimum results (10 >= 2)
2025-11-07 13:33:22 [INFO] Open Library Enhanced Test: 3/3 passed
2025-11-07 13:33:22 [INFO] 
======================================================================
2025-11-07 13:33:22 [INFO] TEST: C3: Open Library Subject Parsing
2025-11-07 13:33:22 [INFO] ======================================================================
2025-11-07 13:33:23 [INFO] [INFO] Analyzing 5 books for subject parsing...
2025-11-07 13:33:23 [INFO] [PASS]   4/5 books have subjects
2025-11-07 13:33:23 [INFO] [INFO]   Average subjects per book: 47.8
2025-11-07 13:33:23 [INFO] [INFO] 
  Sample subjects from 'The Magic Finger':
2025-11-07 13:33:23 [INFO] Open Library subject parsing test passed
2025-11-07 13:33:23 [INFO] 
======================================================================
2025-11-07 13:33:23 [INFO] TEST: C4: Open Library Fallback
2025-11-07 13:33:23 [INFO] ======================================================================
2025-11-07 13:33:23 [INFO] [INFO] Testing with intentionally obscure query...
2025-11-07 13:33:24 [WARNING] [WARN]   Even fallback returned no books (acceptable)
2025-11-07 13:33:24 [INFO] 
----------------------------------------------------------------------
2025-11-07 13:33:24 [INFO] SECTION: D: SUBJECT MAPPING TESTS
2025-11-07 13:33:24 [INFO] ----------------------------------------------------------------------
2025-11-07 13:33:24 [INFO] 
======================================================================
2025-11-07 13:33:24 [INFO] TEST: D1: Subject Mapper Initialization
2025-11-07 13:33:24 [INFO] ======================================================================
2025-11-07 13:33:24 [INFO] [INFO] Dynamic mapping: ENABLED
2025-11-07 13:33:24 [INFO] [INFO] Fallback mappings: 15 categories
2025-11-07 13:33:24 [INFO] [INFO] Cache capacity: 500
2025-11-07 13:33:24 [INFO] [PASS]   DeepSeek client initialized
2025-11-07 13:33:24 [INFO] [PASS]   Fallback category 'fantasy' loaded
2025-11-07 13:33:24 [INFO] [PASS]   Fallback category 'sci-fi' loaded
2025-11-07 13:33:24 [INFO] [PASS]   Fallback category 'mystery' loaded
2025-11-07 13:33:24 [INFO] [PASS]   Fallback category 'horror' loaded
2025-11-07 13:33:24 [INFO] [PASS]   Fallback category 'romance' loaded
2025-11-07 13:33:24 [INFO] Subject mapper initialization test passed
2025-11-07 13:33:24 [INFO] 
======================================================================
2025-11-07 13:33:24 [INFO] TEST: D2: Fallback Subject Mapping
2025-11-07 13:33:24 [INFO] ======================================================================
2025-11-07 13:33:24 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-07 13:33:24 [INFO] [INFO]   Mapped to: Coming Of Age, Fantasy
2025-11-07 13:33:24 [INFO] [INFO]   Relevance: 1.00
2025-11-07 13:33:24 [INFO] [INFO]   Method: fallback
2025-11-07 13:33:24 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 13:33:24 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-07 13:33:24 [INFO] [INFO]   Mapped to: Rebellion, Coming Of Age, Sci Fi
2025-11-07 13:33:24 [INFO] [INFO]   Relevance: 0.80
2025-11-07 13:33:24 [INFO] [INFO]   Method: fallback
2025-11-07 13:33:24 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 13:33:24 [INFO] [INFO]   Subjects: Mystery, Detective, Crime...
2025-11-07 13:33:24 [INFO] [INFO]   Mapped to: Mystery
2025-11-07 13:33:24 [INFO] [INFO]   Relevance: 1.00
2025-11-07 13:33:24 [INFO] [INFO]   Method: fallback
2025-11-07 13:33:24 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 13:33:24 [INFO] [INFO]   Subjects: Obscure Topic A, Rare Subject B, Unknown Category C...
2025-11-07 13:33:24 [INFO] [INFO]   Mapped to: Rare Subject B, Unknown Category C, Obscure Topic A
2025-11-07 13:33:24 [INFO] [INFO]   Relevance: 0.00
2025-11-07 13:33:24 [INFO] [INFO]   Method: fallback
2025-11-07 13:33:24 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 13:33:24 [INFO] Fallback Mapping Test: 4/4 passed
2025-11-07 13:33:24 [INFO] 
======================================================================
2025-11-07 13:33:24 [INFO] TEST: D3: Dynamic Subject Mapping with DeepSeek
2025-11-07 13:33:24 [INFO] ======================================================================
2025-11-07 13:33:24 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-07 13:33:24 [INFO] [INFO]   Context: 'fantasy young adult magic'
2025-11-07 13:33:27 [INFO] [INFO]   Mapped to: Fantasy, Magic, Coming-of-Age
2025-11-07 13:33:27 [INFO] [INFO]   Relevance: 0.95
2025-11-07 13:33:27 [INFO] [INFO]   Method: dynamic
2025-11-07 13:33:27 [INFO] [PASS]   Used dynamic mapping
2025-11-07 13:33:27 [INFO] [PASS]   Relevance meets minimum (0.95 >= 0.6)
2025-11-07 13:33:27 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-07 13:33:27 [INFO] [INFO]   Context: 'dystopian rebellion'
2025-11-07 13:33:31 [INFO] [INFO]   Mapped to: Dystopian, Rebellion, Sci-Fi
2025-11-07 13:33:31 [INFO] [INFO]   Relevance: 0.95
2025-11-07 13:33:31 [INFO] [INFO]   Method: dynamic
2025-11-07 13:33:31 [INFO] [PASS]   Used dynamic mapping
2025-11-07 13:33:31 [INFO] [PASS]   Relevance meets minimum (0.95 >= 0.6)
2025-11-07 13:33:31 [INFO] Dynamic Mapping Test: 2/2 passed
2025-11-07 13:33:31 [INFO] 
======================================================================
2025-11-07 13:33:31 [INFO] TEST: D4: Subject Mapping Cache
2025-11-07 13:33:31 [INFO] ======================================================================
2025-11-07 13:33:31 [INFO] [INFO] Testing cache behavior...
2025-11-07 13:33:34 [INFO] [INFO]   First call: dynamic (3729.9ms)
2025-11-07 13:33:34 [INFO] [INFO]   Second call: cached (0.0ms)
2025-11-07 13:33:34 [INFO] [PASS]   Cache working correctly
2025-11-07 13:33:34 [INFO] [PASS]   Cache faster (0.0ms vs 3729.9ms)
2025-11-07 13:33:34 [INFO] [PASS]   Cache returns identical results
2025-11-07 13:33:34 [INFO] 
======================================================================
2025-11-07 13:33:34 [INFO] TEST: D5: Subject Mapping Metrics
2025-11-07 13:33:34 [INFO] ======================================================================
2025-11-07 13:33:44 [INFO] [INFO] Metrics collected:
2025-11-07 13:33:44 [INFO] [PASS]   Metric 'total_calls' present
2025-11-07 13:33:44 [INFO] [PASS]   Metric 'cache_hit_rate' present
2025-11-07 13:33:44 [INFO] [PASS]   Metric 'dynamic_success_rate' present
2025-11-07 13:33:44 [INFO] [PASS]   Metric 'fallback_rate' present
2025-11-07 13:33:44 [INFO] Mapping metrics test passed
2025-11-07 13:33:44 [INFO] ======================================================================
2025-11-07 13:33:44 [INFO] TEST SUMMARY
2025-11-07 13:33:44 [INFO] ======================================================================
2025-11-07 13:33:44 [INFO] 
Section A: Query Effectiveness:
2025-11-07 13:33:44 [INFO] [PASS] A1: Query Generation
2025-11-07 13:33:44 [INFO] [PASS] A2: Book Fetching
2025-11-07 13:33:44 [INFO] 
Section B: API Integration:
2025-11-07 13:33:44 [INFO] [PASS] B1: Server Health
2025-11-07 13:33:44 [INFO] 
Section C: Open Library Integration:
2025-11-07 13:33:44 [INFO] [PASS] C1: OL API Connection
2025-11-07 13:33:44 [INFO] [PASS] C2: OL Enhanced Fetching
2025-11-07 13:33:44 [INFO] [PASS] C3: OL Subject Parsing
2025-11-07 13:33:44 [INFO] [PASS] C4: OL Fallback
2025-11-07 13:33:44 [INFO] 
Section D: Subject Mapping:
2025-11-07 13:33:44 [INFO] [PASS] D1: Mapper Initialization
2025-11-07 13:33:44 [INFO] [PASS] D2: Fallback Mapping
2025-11-07 13:33:44 [INFO] [PASS] D3: Dynamic Mapping
2025-11-07 13:33:44 [INFO] [PASS] D4: Mapping Cache
2025-11-07 13:33:44 [INFO] [PASS] D5: Mapping Metrics
2025-11-07 13:33:44 [INFO] 
Overall Results: 12 passed, 0 failed, 0 skipped out of 12 tests
2025-11-07 13:33:44 [INFO] [SUCCESS] All tests passed (12/12)
2025-11-07 13:33:44 [INFO] ======================================================================
2025-11-07 13:33:44 [INFO] QUICK TIPS
2025-11-07 13:33:44 [INFO] ======================================================================
2025-11-07 13:33:44 [INFO] Section A (Query Effectiveness):
2025-11-07 13:33:44 [INFO]   - Tests core query generation and book fetching logic
2025-11-07 13:33:44 [INFO]   - Requires Google Books API key to be set
2025-11-07 13:33:44 [INFO]   - Can run independently of Flask server
2025-11-07 13:33:44 [INFO] Section B (API Integration):
2025-11-07 13:33:44 [INFO]   - Tests full end-to-end recommendation flow
2025-11-07 13:33:44 [INFO]   - Requires Flask server running: python app.py
2025-11-07 13:33:44 [INFO] Section C (Open Library Integration):
2025-11-07 13:33:44 [INFO]   - Tests Open Library API connection and fetching
2025-11-07 13:33:44 [INFO]   - Tests subject parsing and mapping integration
2025-11-07 13:33:44 [INFO]   - Tests fallback behavior for obscure queries
2025-11-07 13:33:44 [INFO]   - No API key required (public API)
2025-11-07 13:33:44 [INFO] Section D (Subject Mapping):
2025-11-07 13:33:44 [INFO]   - Tests both dynamic (DeepSeek) and fallback mapping
2025-11-07 13:33:44 [INFO]   - Tests caching and performance metrics
2025-11-07 13:33:44 [INFO]   - Dynamic tests require DEEPSEEK_API_KEY
2025-11-07 13:33:44 [INFO]   - Fallback tests work without API key
2025-11-07 13:33:44 [INFO] Environment Variables:
2025-11-07 13:33:44 [INFO]   - GOOGLE_BOOKS_API_KEY: For Google Books API (optional)
2025-11-07 13:33:44 [INFO]   - DEEPSEEK_API_KEY: For dynamic subject mapping (optional)
2025-11-07 13:33:44 [INFO]   - Without API keys, tests will use fallback methods
2025-11-07 13:33:44 [INFO] For detailed logs:
2025-11-07 13:33:44 [INFO]   - Check logs/recommendation_tests.log
2025-11-07 13:33:44 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-07 13:33:44 [INFO] Common issues:
2025-11-07 13:33:44 [INFO]   - API key not set -> Some tests will be skipped
2025-11-07 13:33:44 [INFO]   - Server not running -> Section B tests will fail
2025-11-07 13:33:44 [INFO]   - Network timeout -> Increase timeout in test config
2025-11-07 13:33:44 [INFO] ======================================================================
2025-11-07 13:33:44 [INFO] TEST SUITE COMPLETE
2025-11-07 13:33:44 [INFO] ======================================================================
2025-11-07 16:16:55 [INFO] ======================================================================
2025-11-07 16:16:55 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-07 16:16:55 [INFO] ======================================================================
2025-11-07 16:16:55 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:16:55 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-07 16:16:55 [INFO] ----------------------------------------------------------------------
2025-11-07 16:16:55 [INFO] 
======================================================================
2025-11-07 16:16:55 [INFO] TEST: A1: Query Generation
2025-11-07 16:16:55 [INFO] ======================================================================
2025-11-07 16:16:55 [INFO] Testing query generation for: Fantasy with Magic
2025-11-07 16:16:55 [INFO] [INFO]   Generated 1 queries:
2025-11-07 16:16:55 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-07 16:16:55 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-07 16:16:55 [INFO] [INFO]   Generated 1 queries:
2025-11-07 16:16:55 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-07 16:16:55 [INFO] Query Generation Test: 2/2 passed
2025-11-07 16:16:55 [INFO] 
======================================================================
2025-11-07 16:16:55 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-07 16:16:55 [INFO] ======================================================================
2025-11-07 16:16:55 [INFO] [INFO]   Fetching books...
2025-11-07 16:16:56 [INFO] [PASS]   Fetched 5 books
2025-11-07 16:16:56 [INFO] [INFO]   Fetching books...
2025-11-07 16:16:56 [INFO] [PASS]   Fetched 5 books
2025-11-07 16:16:56 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:16:56 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-07 16:16:56 [INFO] ----------------------------------------------------------------------
2025-11-07 16:16:56 [INFO] 
======================================================================
2025-11-07 16:16:56 [INFO] TEST: B1: Flask Server Health Check
2025-11-07 16:16:56 [INFO] ======================================================================
2025-11-07 16:16:58 [INFO] [PASS] Server status: ok
2025-11-07 16:16:58 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:16:58 [INFO] SECTION: C: OPEN LIBRARY INTEGRATION TESTS
2025-11-07 16:16:58 [INFO] ----------------------------------------------------------------------
2025-11-07 16:16:58 [INFO] 
======================================================================
2025-11-07 16:16:58 [INFO] TEST: C1: Open Library API Connection
2025-11-07 16:16:58 [INFO] ======================================================================
2025-11-07 16:16:58 [INFO] [INFO] Calling Open Library API...
2025-11-07 16:16:59 [INFO] [PASS] Returned 3 books
2025-11-07 16:16:59 [INFO] Open Library API test passed
2025-11-07 16:16:59 [INFO] 
======================================================================
2025-11-07 16:16:59 [INFO] TEST: C2: Enhanced Open Library Fetching
2025-11-07 16:16:59 [INFO] ======================================================================
2025-11-07 16:16:59 [INFO] [INFO]   Query: 'fantasy young adult magic'
2025-11-07 16:17:38 [INFO] [PASS]   Fetched 10 books
2025-11-07 16:17:38 [INFO] [INFO]   Books with mapped categories: 10/10
2025-11-07 16:17:38 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-07 16:17:38 [INFO] [INFO]   Query: 'dystopian rebellion'
2025-11-07 16:18:09 [INFO] [PASS]   Fetched 10 books
2025-11-07 16:18:09 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-07 16:18:09 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-07 16:18:09 [INFO] [INFO]   Query: 'contemporary realistic fiction'
2025-11-07 16:18:39 [INFO] [PASS]   Fetched 10 books
2025-11-07 16:18:39 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-07 16:18:39 [INFO] [PASS]   Met minimum results (10 >= 2)
2025-11-07 16:18:39 [INFO] Open Library Enhanced Test: 3/3 passed
2025-11-07 16:18:39 [INFO] 
======================================================================
2025-11-07 16:18:39 [INFO] TEST: C3: Open Library Subject Parsing
2025-11-07 16:18:39 [INFO] ======================================================================
2025-11-07 16:18:39 [INFO] [INFO] Analyzing 5 books for subject parsing...
2025-11-07 16:18:39 [INFO] [PASS]   4/5 books have subjects
2025-11-07 16:18:39 [INFO] [INFO]   Average subjects per book: 47.8
2025-11-07 16:18:39 [INFO] [INFO] 
  Sample subjects from 'The Magic Finger':
2025-11-07 16:18:39 [INFO] Open Library subject parsing test passed
2025-11-07 16:18:39 [INFO] 
======================================================================
2025-11-07 16:18:39 [INFO] TEST: C4: Open Library Fallback
2025-11-07 16:18:39 [INFO] ======================================================================
2025-11-07 16:18:39 [INFO] [INFO] Testing with intentionally obscure query...
2025-11-07 16:18:40 [WARNING] [WARN]   Even fallback returned no books (acceptable)
2025-11-07 16:18:40 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:18:40 [INFO] SECTION: D: SUBJECT MAPPING TESTS
2025-11-07 16:18:40 [INFO] ----------------------------------------------------------------------
2025-11-07 16:18:40 [INFO] 
======================================================================
2025-11-07 16:18:40 [INFO] TEST: D1: Subject Mapper Initialization
2025-11-07 16:18:40 [INFO] ======================================================================
2025-11-07 16:18:40 [INFO] [INFO] Dynamic mapping: ENABLED
2025-11-07 16:18:40 [INFO] [INFO] Fallback mappings: 15 categories
2025-11-07 16:18:40 [INFO] [INFO] Cache capacity: 500
2025-11-07 16:18:40 [INFO] [PASS]   DeepSeek client initialized
2025-11-07 16:18:40 [INFO] [PASS]   Fallback category 'fantasy' loaded
2025-11-07 16:18:40 [INFO] [PASS]   Fallback category 'sci-fi' loaded
2025-11-07 16:18:40 [INFO] [PASS]   Fallback category 'mystery' loaded
2025-11-07 16:18:40 [INFO] [PASS]   Fallback category 'horror' loaded
2025-11-07 16:18:40 [INFO] [PASS]   Fallback category 'romance' loaded
2025-11-07 16:18:40 [INFO] Subject mapper initialization test passed
2025-11-07 16:18:40 [INFO] 
======================================================================
2025-11-07 16:18:40 [INFO] TEST: D2: Fallback Subject Mapping
2025-11-07 16:18:40 [INFO] ======================================================================
2025-11-07 16:18:40 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-07 16:18:40 [INFO] [INFO]   Mapped to: Coming Of Age, Fantasy
2025-11-07 16:18:40 [INFO] [INFO]   Relevance: 1.00
2025-11-07 16:18:40 [INFO] [INFO]   Method: fallback
2025-11-07 16:18:40 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 16:18:40 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-07 16:18:40 [INFO] [INFO]   Mapped to: Coming Of Age, Rebellion, Sci Fi
2025-11-07 16:18:40 [INFO] [INFO]   Relevance: 0.80
2025-11-07 16:18:40 [INFO] [INFO]   Method: fallback
2025-11-07 16:18:40 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 16:18:40 [INFO] [INFO]   Subjects: Mystery, Detective, Crime...
2025-11-07 16:18:40 [INFO] [INFO]   Mapped to: Mystery
2025-11-07 16:18:40 [INFO] [INFO]   Relevance: 1.00
2025-11-07 16:18:40 [INFO] [INFO]   Method: fallback
2025-11-07 16:18:40 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 16:18:40 [INFO] [INFO]   Subjects: Obscure Topic A, Rare Subject B, Unknown Category C...
2025-11-07 16:18:40 [INFO] [INFO]   Mapped to: Obscure Topic A, Unknown Category C, Rare Subject B
2025-11-07 16:18:40 [INFO] [INFO]   Relevance: 0.00
2025-11-07 16:18:40 [INFO] [INFO]   Method: fallback
2025-11-07 16:18:40 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 16:18:40 [INFO] Fallback Mapping Test: 4/4 passed
2025-11-07 16:18:40 [INFO] 
======================================================================
2025-11-07 16:18:40 [INFO] TEST: D3: Dynamic Subject Mapping with DeepSeek
2025-11-07 16:18:40 [INFO] ======================================================================
2025-11-07 16:18:40 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-07 16:18:40 [INFO] [INFO]   Context: 'fantasy young adult magic'
2025-11-07 16:18:43 [INFO] [INFO]   Mapped to: Fantasy, Magic, Coming-of-Age
2025-11-07 16:18:43 [INFO] [INFO]   Relevance: 0.95
2025-11-07 16:18:43 [INFO] [INFO]   Method: dynamic
2025-11-07 16:18:43 [INFO] [PASS]   Used dynamic mapping
2025-11-07 16:18:43 [INFO] [PASS]   Relevance meets minimum (0.95 >= 0.6)
2025-11-07 16:18:43 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-07 16:18:43 [INFO] [INFO]   Context: 'dystopian rebellion'
2025-11-07 16:18:46 [INFO] [INFO]   Mapped to: Dystopian, Rebellion, Sci-Fi
2025-11-07 16:18:46 [INFO] [INFO]   Relevance: 0.90
2025-11-07 16:18:46 [INFO] [INFO]   Method: dynamic
2025-11-07 16:18:46 [INFO] [PASS]   Used dynamic mapping
2025-11-07 16:18:46 [INFO] [PASS]   Relevance meets minimum (0.90 >= 0.6)
2025-11-07 16:18:46 [INFO] Dynamic Mapping Test: 2/2 passed
2025-11-07 16:18:46 [INFO] 
======================================================================
2025-11-07 16:18:46 [INFO] TEST: D4: Subject Mapping Cache
2025-11-07 16:18:46 [INFO] ======================================================================
2025-11-07 16:18:46 [INFO] [INFO] Testing cache behavior...
2025-11-07 16:18:50 [INFO] [INFO]   First call: dynamic (3434.8ms)
2025-11-07 16:18:50 [INFO] [INFO]   Second call: cached (0.0ms)
2025-11-07 16:18:50 [INFO] [PASS]   Cache working correctly
2025-11-07 16:18:50 [INFO] [PASS]   Cache faster (0.0ms vs 3434.8ms)
2025-11-07 16:18:50 [INFO] [PASS]   Cache returns identical results
2025-11-07 16:18:50 [INFO] 
======================================================================
2025-11-07 16:18:50 [INFO] TEST: D5: Subject Mapping Metrics
2025-11-07 16:18:50 [INFO] ======================================================================
2025-11-07 16:19:01 [INFO] [INFO] Metrics collected:
2025-11-07 16:19:01 [INFO] [PASS]   Metric 'total_calls' present
2025-11-07 16:19:01 [INFO] [PASS]   Metric 'cache_hit_rate' present
2025-11-07 16:19:01 [INFO] [PASS]   Metric 'dynamic_success_rate' present
2025-11-07 16:19:01 [INFO] [PASS]   Metric 'fallback_rate' present
2025-11-07 16:19:01 [INFO] Mapping metrics test passed
2025-11-07 16:19:01 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:19:01 [INFO] SECTION: E: EXPLANATION GENERATOR TESTS
2025-11-07 16:19:01 [INFO] ----------------------------------------------------------------------
2025-11-07 16:19:01 [INFO] 
======================================================================
2025-11-07 16:19:01 [INFO] TEST: E1: Explanation Generator Initialization
2025-11-07 16:19:01 [INFO] ======================================================================
2025-11-07 16:19:01 [ERROR] [FAIL] Initialization failed: name 'openai' is not defined
2025-11-07 16:19:01 [ERROR] Explanation generator initialization failed
Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_Recommendations.py", line 762, in test_explanation_generator_initialization
    client = openai.OpenAI(api_key=DEEPSEEK_API_KEY, base_url=DEEPSEEK_URL)
             ^^^^^^
NameError: name 'openai' is not defined
2025-11-07 16:19:01 [INFO] 
======================================================================
2025-11-07 16:19:01 [INFO] TEST: E2: Explanation Generation from Conversation
2025-11-07 16:19:01 [INFO] ======================================================================
2025-11-07 16:19:01 [ERROR] [FAIL] Exception: SessionHelper.__init__() got an unexpected keyword argument 'ai_api_url'
2025-11-07 16:19:01 [ERROR] Explanation generation test failed
Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_Recommendations.py", line 790, in test_explanation_generation_with_real_conversation
    helper = SessionHelper(
             ^^^^^^^^^^^^^^
TypeError: SessionHelper.__init__() got an unexpected keyword argument 'ai_api_url'
2025-11-07 16:19:01 [INFO] 
======================================================================
2025-11-07 16:19:01 [INFO] TEST: E3: Explanation Quality Analysis
2025-11-07 16:19:01 [INFO] ======================================================================
2025-11-07 16:19:01 [ERROR] [FAIL] Exception: SessionHelper.__init__() got an unexpected keyword argument 'ai_api_url'
2025-11-07 16:19:01 [ERROR] Quality analysis test failed
Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_Recommendations.py", line 929, in test_explanation_quality_analysis
    helper = SessionHelper(
             ^^^^^^^^^^^^^^
TypeError: SessionHelper.__init__() got an unexpected keyword argument 'ai_api_url'
2025-11-07 16:19:01 [INFO] 
======================================================================
2025-11-07 16:19:01 [INFO] TEST: E4: Summary Comparison Generation
2025-11-07 16:19:01 [INFO] ======================================================================
2025-11-07 16:19:01 [ERROR] [FAIL] Exception: SessionHelper.__init__() got an unexpected keyword argument 'ai_api_url'
2025-11-07 16:19:01 [ERROR] Summary comparison test failed
Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_Recommendations.py", line 1084, in test_summary_comparison
    helper = SessionHelper(
             ^^^^^^^^^^^^^^
TypeError: SessionHelper.__init__() got an unexpected keyword argument 'ai_api_url'
2025-11-07 16:19:01 [INFO] 
======================================================================
2025-11-07 16:19:01 [INFO] TEST: E5: Fallback Explanation
2025-11-07 16:19:01 [INFO] ======================================================================
2025-11-07 16:19:01 [ERROR] [FAIL] Exception: name 'openai' is not defined
2025-11-07 16:19:01 [ERROR] Fallback test failed
Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_Recommendations.py", line 1200, in test_explanation_fallback
    client = openai.OpenAI(api_key=DEEPSEEK_API_KEY, base_url=DEEPSEEK_URL)
             ^^^^^^
NameError: name 'openai' is not defined
2025-11-07 16:19:01 [INFO] ======================================================================
2025-11-07 16:19:01 [INFO] TEST SUMMARY
2025-11-07 16:19:01 [INFO] ======================================================================
2025-11-07 16:19:01 [INFO] 
Section A: Query Effectiveness:
2025-11-07 16:19:01 [INFO] [PASS] A1: Query Generation
2025-11-07 16:19:01 [INFO] [PASS] A2: Book Fetching
2025-11-07 16:19:01 [INFO] 
Section B: API Integration:
2025-11-07 16:19:01 [INFO] [PASS] B1: Server Health
2025-11-07 16:19:01 [INFO] 
Section C: Open Library Integration:
2025-11-07 16:19:01 [INFO] [PASS] C1: OL API Connection
2025-11-07 16:19:01 [INFO] [PASS] C2: OL Enhanced Fetching
2025-11-07 16:19:01 [INFO] [PASS] C3: OL Subject Parsing
2025-11-07 16:19:01 [INFO] [PASS] C4: OL Fallback
2025-11-07 16:19:01 [INFO] 
Section D: Subject Mapping:
2025-11-07 16:19:01 [INFO] [PASS] D1: Mapper Initialization
2025-11-07 16:19:01 [INFO] [PASS] D2: Fallback Mapping
2025-11-07 16:19:01 [INFO] [PASS] D3: Dynamic Mapping
2025-11-07 16:19:01 [INFO] [PASS] D4: Mapping Cache
2025-11-07 16:19:01 [INFO] [PASS] D5: Mapping Metrics
2025-11-07 16:19:01 [INFO] 
Section E: Explanation Generator:
2025-11-07 16:19:01 [ERROR] [FAIL] E1: Generator Initialization
2025-11-07 16:19:01 [ERROR] [FAIL] E2: Explanation Generation
2025-11-07 16:19:01 [ERROR] [FAIL] E3: Quality Analysis
2025-11-07 16:19:01 [ERROR] [FAIL] E4: Summary Comparison
2025-11-07 16:19:01 [ERROR] [FAIL] E5: Fallback Mechanism
2025-11-07 16:19:01 [INFO] 
Overall Results: 12 passed, 5 failed, 0 skipped out of 17 tests
2025-11-07 16:19:01 [WARNING] [FAILURE] 5 tests failed out of 17
2025-11-07 16:19:01 [INFO] ======================================================================
2025-11-07 16:19:01 [INFO] QUICK TIPS
2025-11-07 16:19:01 [INFO] ======================================================================
2025-11-07 16:19:01 [INFO] Section A (Query Effectiveness):
2025-11-07 16:19:01 [INFO]   - Tests core query generation and book fetching logic
2025-11-07 16:19:01 [INFO]   - Requires Google Books API key to be set
2025-11-07 16:19:01 [INFO]   - Can run independently of Flask server
2025-11-07 16:19:01 [INFO] Section B (API Integration):
2025-11-07 16:19:01 [INFO]   - Tests full end-to-end recommendation flow
2025-11-07 16:19:01 [INFO]   - Requires Flask server running: python app.py
2025-11-07 16:19:01 [INFO] Section C (Open Library Integration):
2025-11-07 16:19:01 [INFO]   - Tests Open Library API connection and fetching
2025-11-07 16:19:01 [INFO]   - Tests subject parsing and mapping integration
2025-11-07 16:19:01 [INFO]   - Tests fallback behavior for obscure queries
2025-11-07 16:19:01 [INFO]   - No API key required (public API)
2025-11-07 16:19:01 [INFO] Section D (Subject Mapping):
2025-11-07 16:19:01 [INFO]   - Tests both dynamic (DeepSeek) and fallback mapping
2025-11-07 16:19:01 [INFO]   - Tests caching and performance metrics
2025-11-07 16:19:01 [INFO]   - Dynamic tests require DEEPSEEK_API_KEY
2025-11-07 16:19:01 [INFO]   - Fallback tests work without API key
2025-11-07 16:19:01 [INFO] Section E (Explanation Generator):
2025-11-07 16:19:01 [INFO]   - Tests explanation generation from real conversations
2025-11-07 16:19:01 [INFO]   - Uses SessionHelper to create test sessions
2025-11-07 16:19:01 [INFO]   - Tests quality: length, relevance, specificity, tone
2025-11-07 16:19:01 [INFO]   - Tests summary comparison generation
2025-11-07 16:19:01 [INFO]   - Tests fallback mechanism for edge cases
2025-11-07 16:19:01 [INFO]   - Requires DEEPSEEK_API_KEY and running server
2025-11-07 16:19:01 [INFO] Environment Variables:
2025-11-07 16:19:01 [INFO]   - GOOGLE_BOOKS_API_KEY: For Google Books API (optional)
2025-11-07 16:19:01 [INFO]   - DEEPSEEK_API_KEY: For dynamic subject mapping (optional)
2025-11-07 16:19:01 [INFO]   - Without API keys, tests will use fallback methods
2025-11-07 16:19:01 [INFO] For detailed logs:
2025-11-07 16:19:01 [INFO]   - Check logs/recommendation_tests.log
2025-11-07 16:19:01 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-07 16:19:01 [INFO] Common issues:
2025-11-07 16:19:01 [INFO]   - API key not set -> Some tests will be skipped
2025-11-07 16:19:01 [INFO]   - Server not running -> Section B tests will fail
2025-11-07 16:19:01 [INFO]   - Network timeout -> Increase timeout in test config
2025-11-07 16:19:01 [INFO] ======================================================================
2025-11-07 16:19:01 [INFO] TEST SUITE COMPLETE
2025-11-07 16:19:01 [INFO] ======================================================================
2025-11-07 16:26:53 [INFO] ======================================================================
2025-11-07 16:26:53 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-07 16:26:53 [INFO] ======================================================================
2025-11-07 16:26:53 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:26:53 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-07 16:26:53 [INFO] ----------------------------------------------------------------------
2025-11-07 16:26:53 [INFO] 
======================================================================
2025-11-07 16:26:53 [INFO] TEST: A1: Query Generation
2025-11-07 16:26:53 [INFO] ======================================================================
2025-11-07 16:26:53 [INFO] Testing query generation for: Fantasy with Magic
2025-11-07 16:26:53 [INFO] [INFO]   Generated 1 queries:
2025-11-07 16:26:53 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-07 16:26:53 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-07 16:26:53 [INFO] [INFO]   Generated 1 queries:
2025-11-07 16:26:53 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-07 16:26:53 [INFO] Query Generation Test: 2/2 passed
2025-11-07 16:26:53 [INFO] 
======================================================================
2025-11-07 16:26:53 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-07 16:26:53 [INFO] ======================================================================
2025-11-07 16:26:53 [INFO] [INFO]   Fetching books...
2025-11-07 16:26:55 [INFO] [PASS]   Fetched 5 books
2025-11-07 16:26:55 [INFO] [INFO]   Fetching books...
2025-11-07 16:26:56 [INFO] [PASS]   Fetched 5 books
2025-11-07 16:26:56 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:26:56 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-07 16:26:56 [INFO] ----------------------------------------------------------------------
2025-11-07 16:26:56 [INFO] 
======================================================================
2025-11-07 16:26:56 [INFO] TEST: B1: Flask Server Health Check
2025-11-07 16:26:56 [INFO] ======================================================================
2025-11-07 16:26:58 [INFO] [PASS] Server status: ok
2025-11-07 16:26:58 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:26:58 [INFO] SECTION: C: OPEN LIBRARY INTEGRATION TESTS
2025-11-07 16:26:58 [INFO] ----------------------------------------------------------------------
2025-11-07 16:26:58 [INFO] 
======================================================================
2025-11-07 16:26:58 [INFO] TEST: C1: Open Library API Connection
2025-11-07 16:26:58 [INFO] ======================================================================
2025-11-07 16:26:58 [INFO] [INFO] Calling Open Library API...
2025-11-07 16:26:59 [INFO] [PASS] Returned 3 books
2025-11-07 16:26:59 [INFO] Open Library API test passed
2025-11-07 16:26:59 [INFO] 
======================================================================
2025-11-07 16:26:59 [INFO] TEST: C2: Enhanced Open Library Fetching
2025-11-07 16:26:59 [INFO] ======================================================================
2025-11-07 16:26:59 [INFO] [INFO]   Query: 'fantasy young adult magic'
2025-11-07 16:27:37 [INFO] [PASS]   Fetched 10 books
2025-11-07 16:27:37 [INFO] [INFO]   Books with mapped categories: 10/10
2025-11-07 16:27:37 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-07 16:27:37 [INFO] [INFO]   Query: 'dystopian rebellion'
2025-11-07 16:28:09 [INFO] [PASS]   Fetched 10 books
2025-11-07 16:28:09 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-07 16:28:09 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-07 16:28:09 [INFO] [INFO]   Query: 'contemporary realistic fiction'
2025-11-07 16:28:38 [INFO] [PASS]   Fetched 10 books
2025-11-07 16:28:38 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-07 16:28:38 [INFO] [PASS]   Met minimum results (10 >= 2)
2025-11-07 16:28:38 [INFO] Open Library Enhanced Test: 3/3 passed
2025-11-07 16:28:38 [INFO] 
======================================================================
2025-11-07 16:28:38 [INFO] TEST: C3: Open Library Subject Parsing
2025-11-07 16:28:38 [INFO] ======================================================================
2025-11-07 16:28:39 [INFO] [INFO] Analyzing 5 books for subject parsing...
2025-11-07 16:28:39 [INFO] [PASS]   4/5 books have subjects
2025-11-07 16:28:39 [INFO] [INFO]   Average subjects per book: 47.8
2025-11-07 16:28:39 [INFO] [INFO] 
  Sample subjects from 'The Magic Finger':
2025-11-07 16:28:39 [INFO] Open Library subject parsing test passed
2025-11-07 16:28:39 [INFO] 
======================================================================
2025-11-07 16:28:39 [INFO] TEST: C4: Open Library Fallback
2025-11-07 16:28:39 [INFO] ======================================================================
2025-11-07 16:28:39 [INFO] [INFO] Testing with intentionally obscure query...
2025-11-07 16:28:39 [WARNING] [WARN]   Even fallback returned no books (acceptable)
2025-11-07 16:28:39 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:28:39 [INFO] SECTION: D: SUBJECT MAPPING TESTS
2025-11-07 16:28:39 [INFO] ----------------------------------------------------------------------
2025-11-07 16:28:39 [INFO] 
======================================================================
2025-11-07 16:28:39 [INFO] TEST: D1: Subject Mapper Initialization
2025-11-07 16:28:39 [INFO] ======================================================================
2025-11-07 16:28:39 [INFO] [INFO] Dynamic mapping: ENABLED
2025-11-07 16:28:39 [INFO] [INFO] Fallback mappings: 15 categories
2025-11-07 16:28:39 [INFO] [INFO] Cache capacity: 500
2025-11-07 16:28:39 [INFO] [PASS]   DeepSeek client initialized
2025-11-07 16:28:39 [INFO] [PASS]   Fallback category 'fantasy' loaded
2025-11-07 16:28:39 [INFO] [PASS]   Fallback category 'sci-fi' loaded
2025-11-07 16:28:39 [INFO] [PASS]   Fallback category 'mystery' loaded
2025-11-07 16:28:39 [INFO] [PASS]   Fallback category 'horror' loaded
2025-11-07 16:28:39 [INFO] [PASS]   Fallback category 'romance' loaded
2025-11-07 16:28:39 [INFO] Subject mapper initialization test passed
2025-11-07 16:28:39 [INFO] 
======================================================================
2025-11-07 16:28:39 [INFO] TEST: D2: Fallback Subject Mapping
2025-11-07 16:28:39 [INFO] ======================================================================
2025-11-07 16:28:39 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-07 16:28:39 [INFO] [INFO]   Mapped to: Coming Of Age, Fantasy
2025-11-07 16:28:39 [INFO] [INFO]   Relevance: 1.00
2025-11-07 16:28:39 [INFO] [INFO]   Method: fallback
2025-11-07 16:28:39 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 16:28:39 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-07 16:28:39 [INFO] [INFO]   Mapped to: Coming Of Age, Sci Fi, Rebellion
2025-11-07 16:28:39 [INFO] [INFO]   Relevance: 0.80
2025-11-07 16:28:39 [INFO] [INFO]   Method: fallback
2025-11-07 16:28:39 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 16:28:39 [INFO] [INFO]   Subjects: Mystery, Detective, Crime...
2025-11-07 16:28:39 [INFO] [INFO]   Mapped to: Mystery
2025-11-07 16:28:39 [INFO] [INFO]   Relevance: 1.00
2025-11-07 16:28:39 [INFO] [INFO]   Method: fallback
2025-11-07 16:28:39 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 16:28:39 [INFO] [INFO]   Subjects: Obscure Topic A, Rare Subject B, Unknown Category C...
2025-11-07 16:28:39 [INFO] [INFO]   Mapped to: Obscure Topic A, Unknown Category C, Rare Subject B
2025-11-07 16:28:39 [INFO] [INFO]   Relevance: 0.00
2025-11-07 16:28:39 [INFO] [INFO]   Method: fallback
2025-11-07 16:28:39 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 16:28:39 [INFO] Fallback Mapping Test: 4/4 passed
2025-11-07 16:28:39 [INFO] 
======================================================================
2025-11-07 16:28:39 [INFO] TEST: D3: Dynamic Subject Mapping with DeepSeek
2025-11-07 16:28:39 [INFO] ======================================================================
2025-11-07 16:28:39 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-07 16:28:39 [INFO] [INFO]   Context: 'fantasy young adult magic'
2025-11-07 16:28:42 [INFO] [INFO]   Mapped to: Fantasy, Magic, Coming-of-Age
2025-11-07 16:28:42 [INFO] [INFO]   Relevance: 0.95
2025-11-07 16:28:42 [INFO] [INFO]   Method: dynamic
2025-11-07 16:28:42 [INFO] [PASS]   Used dynamic mapping
2025-11-07 16:28:42 [INFO] [PASS]   Relevance meets minimum (0.95 >= 0.6)
2025-11-07 16:28:42 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-07 16:28:42 [INFO] [INFO]   Context: 'dystopian rebellion'
2025-11-07 16:28:46 [INFO] [INFO]   Mapped to: Dystopian, Rebellion, Sci-Fi, Power
2025-11-07 16:28:46 [INFO] [INFO]   Relevance: 0.90
2025-11-07 16:28:46 [INFO] [INFO]   Method: dynamic
2025-11-07 16:28:46 [INFO] [PASS]   Used dynamic mapping
2025-11-07 16:28:46 [INFO] [PASS]   Relevance meets minimum (0.90 >= 0.6)
2025-11-07 16:28:46 [INFO] Dynamic Mapping Test: 2/2 passed
2025-11-07 16:28:46 [INFO] 
======================================================================
2025-11-07 16:28:46 [INFO] TEST: D4: Subject Mapping Cache
2025-11-07 16:28:46 [INFO] ======================================================================
2025-11-07 16:28:46 [INFO] [INFO] Testing cache behavior...
2025-11-07 16:28:49 [INFO] [INFO]   First call: dynamic (3318.2ms)
2025-11-07 16:28:49 [INFO] [INFO]   Second call: cached (0.0ms)
2025-11-07 16:28:49 [INFO] [PASS]   Cache working correctly
2025-11-07 16:28:49 [INFO] [PASS]   Cache faster (0.0ms vs 3318.2ms)
2025-11-07 16:28:49 [INFO] [PASS]   Cache returns identical results
2025-11-07 16:28:49 [INFO] 
======================================================================
2025-11-07 16:28:49 [INFO] TEST: D5: Subject Mapping Metrics
2025-11-07 16:28:49 [INFO] ======================================================================
2025-11-07 16:29:00 [INFO] [INFO] Metrics collected:
2025-11-07 16:29:00 [INFO] [PASS]   Metric 'total_calls' present
2025-11-07 16:29:00 [INFO] [PASS]   Metric 'cache_hit_rate' present
2025-11-07 16:29:00 [INFO] [PASS]   Metric 'dynamic_success_rate' present
2025-11-07 16:29:00 [INFO] [PASS]   Metric 'fallback_rate' present
2025-11-07 16:29:00 [INFO] Mapping metrics test passed
2025-11-07 16:29:00 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:29:00 [INFO] SECTION: E: EXPLANATION GENERATOR TESTS
2025-11-07 16:29:00 [INFO] ----------------------------------------------------------------------
2025-11-07 16:31:39 [INFO] ======================================================================
2025-11-07 16:31:39 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-07 16:31:39 [INFO] ======================================================================
2025-11-07 16:31:39 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:31:39 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-07 16:31:39 [INFO] ----------------------------------------------------------------------
2025-11-07 16:31:39 [INFO] 
======================================================================
2025-11-07 16:31:39 [INFO] TEST: A1: Query Generation
2025-11-07 16:31:39 [INFO] ======================================================================
2025-11-07 16:31:39 [INFO] Testing query generation for: Fantasy with Magic
2025-11-07 16:31:39 [INFO] [INFO]   Generated 1 queries:
2025-11-07 16:31:39 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-07 16:31:39 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-07 16:31:39 [INFO] [INFO]   Generated 1 queries:
2025-11-07 16:31:39 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-07 16:31:39 [INFO] Query Generation Test: 2/2 passed
2025-11-07 16:31:39 [INFO] 
======================================================================
2025-11-07 16:31:39 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-07 16:31:39 [INFO] ======================================================================
2025-11-07 16:31:39 [INFO] [INFO]   Fetching books...
2025-11-07 16:31:39 [INFO] [PASS]   Fetched 5 books
2025-11-07 16:31:39 [INFO] [INFO]   Fetching books...
2025-11-07 16:31:40 [INFO] [PASS]   Fetched 5 books
2025-11-07 16:31:40 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:31:40 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-07 16:31:40 [INFO] ----------------------------------------------------------------------
2025-11-07 16:31:40 [INFO] 
======================================================================
2025-11-07 16:31:40 [INFO] TEST: B1: Flask Server Health Check
2025-11-07 16:31:40 [INFO] ======================================================================
2025-11-07 16:31:42 [INFO] [PASS] Server status: ok
2025-11-07 16:31:42 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:31:42 [INFO] SECTION: C: OPEN LIBRARY INTEGRATION TESTS
2025-11-07 16:31:42 [INFO] ----------------------------------------------------------------------
2025-11-07 16:31:42 [INFO] 
======================================================================
2025-11-07 16:31:42 [INFO] TEST: C1: Open Library API Connection
2025-11-07 16:31:42 [INFO] ======================================================================
2025-11-07 16:31:42 [INFO] [INFO] Calling Open Library API...
2025-11-07 16:31:43 [INFO] [PASS] Returned 3 books
2025-11-07 16:31:43 [INFO] Open Library API test passed
2025-11-07 16:31:43 [INFO] 
======================================================================
2025-11-07 16:31:43 [INFO] TEST: C2: Enhanced Open Library Fetching
2025-11-07 16:31:43 [INFO] ======================================================================
2025-11-07 16:31:43 [INFO] [INFO]   Query: 'fantasy young adult magic'
2025-11-07 16:32:23 [INFO] [PASS]   Fetched 10 books
2025-11-07 16:32:23 [INFO] [INFO]   Books with mapped categories: 10/10
2025-11-07 16:32:23 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-07 16:32:23 [INFO] [INFO]   Query: 'dystopian rebellion'
2025-11-07 16:32:53 [INFO] [PASS]   Fetched 10 books
2025-11-07 16:32:53 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-07 16:32:53 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-07 16:32:53 [INFO] [INFO]   Query: 'contemporary realistic fiction'
2025-11-07 16:33:22 [INFO] [PASS]   Fetched 10 books
2025-11-07 16:33:22 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-07 16:33:22 [INFO] [PASS]   Met minimum results (10 >= 2)
2025-11-07 16:33:22 [INFO] Open Library Enhanced Test: 3/3 passed
2025-11-07 16:33:22 [INFO] 
======================================================================
2025-11-07 16:33:22 [INFO] TEST: C3: Open Library Subject Parsing
2025-11-07 16:33:22 [INFO] ======================================================================
2025-11-07 16:33:23 [INFO] [INFO] Analyzing 5 books for subject parsing...
2025-11-07 16:33:23 [INFO] [PASS]   4/5 books have subjects
2025-11-07 16:33:23 [INFO] [INFO]   Average subjects per book: 47.8
2025-11-07 16:33:23 [INFO] [INFO] 
  Sample subjects from 'The Magic Finger':
2025-11-07 16:33:23 [INFO] Open Library subject parsing test passed
2025-11-07 16:33:23 [INFO] 
======================================================================
2025-11-07 16:33:23 [INFO] TEST: C4: Open Library Fallback
2025-11-07 16:33:23 [INFO] ======================================================================
2025-11-07 16:33:23 [INFO] [INFO] Testing with intentionally obscure query...
2025-11-07 16:33:33 [WARNING] [WARN]   Even fallback returned no books (acceptable)
2025-11-07 16:33:33 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:33:33 [INFO] SECTION: D: SUBJECT MAPPING TESTS
2025-11-07 16:33:33 [INFO] ----------------------------------------------------------------------
2025-11-07 16:33:33 [INFO] 
======================================================================
2025-11-07 16:33:33 [INFO] TEST: D1: Subject Mapper Initialization
2025-11-07 16:33:33 [INFO] ======================================================================
2025-11-07 16:33:33 [INFO] [INFO] Dynamic mapping: ENABLED
2025-11-07 16:33:33 [INFO] [INFO] Fallback mappings: 15 categories
2025-11-07 16:33:33 [INFO] [INFO] Cache capacity: 500
2025-11-07 16:33:33 [INFO] [PASS]   DeepSeek client initialized
2025-11-07 16:33:33 [INFO] [PASS]   Fallback category 'fantasy' loaded
2025-11-07 16:33:33 [INFO] [PASS]   Fallback category 'sci-fi' loaded
2025-11-07 16:33:33 [INFO] [PASS]   Fallback category 'mystery' loaded
2025-11-07 16:33:33 [INFO] [PASS]   Fallback category 'horror' loaded
2025-11-07 16:33:33 [INFO] [PASS]   Fallback category 'romance' loaded
2025-11-07 16:33:33 [INFO] Subject mapper initialization test passed
2025-11-07 16:33:33 [INFO] 
======================================================================
2025-11-07 16:33:33 [INFO] TEST: D2: Fallback Subject Mapping
2025-11-07 16:33:33 [INFO] ======================================================================
2025-11-07 16:33:33 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-07 16:33:33 [INFO] [INFO]   Mapped to: Fantasy, Coming Of Age
2025-11-07 16:33:33 [INFO] [INFO]   Relevance: 1.00
2025-11-07 16:33:33 [INFO] [INFO]   Method: fallback
2025-11-07 16:33:33 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 16:33:33 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-07 16:33:33 [INFO] [INFO]   Mapped to: Rebellion, Sci Fi, Coming Of Age
2025-11-07 16:33:33 [INFO] [INFO]   Relevance: 0.80
2025-11-07 16:33:33 [INFO] [INFO]   Method: fallback
2025-11-07 16:33:33 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 16:33:33 [INFO] [INFO]   Subjects: Mystery, Detective, Crime...
2025-11-07 16:33:33 [INFO] [INFO]   Mapped to: Mystery
2025-11-07 16:33:33 [INFO] [INFO]   Relevance: 1.00
2025-11-07 16:33:33 [INFO] [INFO]   Method: fallback
2025-11-07 16:33:33 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 16:33:33 [INFO] [INFO]   Subjects: Obscure Topic A, Rare Subject B, Unknown Category C...
2025-11-07 16:33:33 [INFO] [INFO]   Mapped to: Unknown Category C, Rare Subject B, Obscure Topic A
2025-11-07 16:33:33 [INFO] [INFO]   Relevance: 0.00
2025-11-07 16:33:33 [INFO] [INFO]   Method: fallback
2025-11-07 16:33:33 [INFO] [PASS]   Used fallback mapping as expected
2025-11-07 16:33:33 [INFO] Fallback Mapping Test: 4/4 passed
2025-11-07 16:33:33 [INFO] 
======================================================================
2025-11-07 16:33:33 [INFO] TEST: D3: Dynamic Subject Mapping with DeepSeek
2025-11-07 16:33:33 [INFO] ======================================================================
2025-11-07 16:33:33 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-07 16:33:33 [INFO] [INFO]   Context: 'fantasy young adult magic'
2025-11-07 16:33:35 [INFO] [INFO]   Mapped to: Fantasy, Magic, Coming-of-Age
2025-11-07 16:33:35 [INFO] [INFO]   Relevance: 0.95
2025-11-07 16:33:35 [INFO] [INFO]   Method: dynamic
2025-11-07 16:33:35 [INFO] [PASS]   Used dynamic mapping
2025-11-07 16:33:35 [INFO] [PASS]   Relevance meets minimum (0.95 >= 0.6)
2025-11-07 16:33:35 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-07 16:33:35 [INFO] [INFO]   Context: 'dystopian rebellion'
2025-11-07 16:33:38 [INFO] [INFO]   Mapped to: Dystopian, Rebellion, Sci-Fi
2025-11-07 16:33:38 [INFO] [INFO]   Relevance: 0.90
2025-11-07 16:33:38 [INFO] [INFO]   Method: dynamic
2025-11-07 16:33:38 [INFO] [PASS]   Used dynamic mapping
2025-11-07 16:33:38 [INFO] [PASS]   Relevance meets minimum (0.90 >= 0.6)
2025-11-07 16:33:38 [INFO] Dynamic Mapping Test: 2/2 passed
2025-11-07 16:33:38 [INFO] 
======================================================================
2025-11-07 16:33:38 [INFO] TEST: D4: Subject Mapping Cache
2025-11-07 16:33:38 [INFO] ======================================================================
2025-11-07 16:33:38 [INFO] [INFO] Testing cache behavior...
2025-11-07 16:33:42 [INFO] [INFO]   First call: dynamic (3221.3ms)
2025-11-07 16:33:42 [INFO] [INFO]   Second call: cached (0.0ms)
2025-11-07 16:33:42 [INFO] [PASS]   Cache working correctly
2025-11-07 16:33:42 [INFO] [PASS]   Cache faster (0.0ms vs 3221.3ms)
2025-11-07 16:33:42 [INFO] [PASS]   Cache returns identical results
2025-11-07 16:33:42 [INFO] 
======================================================================
2025-11-07 16:33:42 [INFO] TEST: D5: Subject Mapping Metrics
2025-11-07 16:33:42 [INFO] ======================================================================
2025-11-07 16:33:52 [INFO] [INFO] Metrics collected:
2025-11-07 16:33:52 [INFO] [PASS]   Metric 'total_calls' present
2025-11-07 16:33:52 [INFO] [PASS]   Metric 'cache_hit_rate' present
2025-11-07 16:33:52 [INFO] [PASS]   Metric 'dynamic_success_rate' present
2025-11-07 16:33:52 [INFO] [PASS]   Metric 'fallback_rate' present
2025-11-07 16:33:52 [INFO] Mapping metrics test passed
2025-11-07 16:33:52 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:33:52 [INFO] SECTION: E: EXPLANATION GENERATOR TESTS
2025-11-07 16:33:52 [INFO] ----------------------------------------------------------------------
2025-11-07 16:33:52 [INFO] 
----------------------------------------------------------------------
2025-11-07 16:33:52 [INFO] SECTION: E: EXPLANATION GENERATOR API TESTS
2025-11-07 16:33:52 [INFO] ----------------------------------------------------------------------
2025-11-07 16:33:52 [INFO] 
======================================================================
2025-11-07 16:33:52 [INFO] TEST: E1: Explanation Generation via API
2025-11-07 16:33:52 [INFO] ======================================================================
2025-11-07 16:33:52 [INFO] [INFO] Setting up test conversation...
2025-11-07 16:33:52 [ERROR] [FAIL] Exception: 'SessionHelper' object has no attribute 'create_test_session'
2025-11-07 16:33:52 [ERROR] Explanation API test failed
Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_Recommendations.py", line 761, in test_explanation_api_endpoint
    session_data = helper.create_test_session(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SessionHelper' object has no attribute 'create_test_session'
2025-11-07 16:33:52 [INFO] 
======================================================================
2025-11-07 16:33:52 [INFO] TEST: E2: Explanation Quality Analysis
2025-11-07 16:33:52 [INFO] ======================================================================
2025-11-07 16:33:52 [INFO] [INFO] Setting up test conversation...
2025-11-07 16:33:52 [ERROR] [FAIL] Exception: 'SessionHelper' object has no attribute 'create_test_session'
2025-11-07 16:33:52 [ERROR] Quality analysis test failed
Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_Recommendations.py", line 887, in test_explanation_quality_from_api
    session_data = helper.create_test_session(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SessionHelper' object has no attribute 'create_test_session'
2025-11-07 16:33:52 [INFO] 
======================================================================
2025-11-07 16:33:52 [INFO] TEST: E3: Summary Comparison via API
2025-11-07 16:33:52 [INFO] ======================================================================
2025-11-07 16:33:52 [INFO] [INFO] Setting up test conversation...
2025-11-07 16:33:52 [ERROR] [FAIL] Exception: 'SessionHelper' object has no attribute 'create_test_session'
2025-11-07 16:33:52 [ERROR] Summary comparison test failed
Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_Recommendations.py", line 1025, in test_summary_comparison_from_api
    session_data = helper.create_test_session(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SessionHelper' object has no attribute 'create_test_session'
2025-11-07 16:33:52 [INFO] 
======================================================================
2025-11-07 16:33:52 [INFO] TEST: E4: Explanation Flag Control
2025-11-07 16:33:52 [INFO] ======================================================================
2025-11-07 16:33:52 [INFO] [INFO] Setting up test conversation...
2025-11-07 16:33:52 [ERROR] [FAIL] Exception: 'SessionHelper' object has no attribute 'create_test_session'
2025-11-07 16:33:52 [ERROR] Flag control test failed
Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_Recommendations.py", line 1113, in test_explanation_flag_control
    session_data = helper.create_test_session(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SessionHelper' object has no attribute 'create_test_session'
2025-11-07 16:33:52 [INFO] ======================================================================
2025-11-07 16:33:52 [INFO] TEST SUMMARY
2025-11-07 16:33:52 [INFO] ======================================================================
2025-11-07 16:33:52 [INFO] 
Section A: Query Effectiveness:
2025-11-07 16:33:52 [INFO] [PASS] A1: Query Generation
2025-11-07 16:33:52 [INFO] [PASS] A2: Book Fetching
2025-11-07 16:33:52 [INFO] 
Section B: API Integration:
2025-11-07 16:33:52 [INFO] [PASS] B1: Server Health
2025-11-07 16:33:52 [INFO] 
Section C: Open Library Integration:
2025-11-07 16:33:52 [INFO] [PASS] C1: OL API Connection
2025-11-07 16:33:52 [INFO] [PASS] C2: OL Enhanced Fetching
2025-11-07 16:33:52 [INFO] [PASS] C3: OL Subject Parsing
2025-11-07 16:33:52 [INFO] [PASS] C4: OL Fallback
2025-11-07 16:33:52 [INFO] 
Section D: Subject Mapping:
2025-11-07 16:33:52 [INFO] [PASS] D1: Mapper Initialization
2025-11-07 16:33:52 [INFO] [PASS] D2: Fallback Mapping
2025-11-07 16:33:52 [INFO] [PASS] D3: Dynamic Mapping
2025-11-07 16:33:52 [INFO] [PASS] D4: Mapping Cache
2025-11-07 16:33:52 [INFO] [PASS] D5: Mapping Metrics
2025-11-07 16:33:52 [INFO] 
Section E: Explanation Generator API:
2025-11-07 16:33:52 [ERROR] [FAIL] E1: Explanation API
2025-11-07 16:33:52 [ERROR] [FAIL] E2: Quality Analysis
2025-11-07 16:33:52 [ERROR] [FAIL] E3: Summary Comparison
2025-11-07 16:33:52 [ERROR] [FAIL] E4: Flag Control
2025-11-07 16:33:52 [INFO] 
Overall Results: 12 passed, 4 failed, 0 skipped out of 16 tests
2025-11-07 16:33:52 [WARNING] [FAILURE] 4 tests failed out of 16
2025-11-07 16:33:52 [INFO] ======================================================================
2025-11-07 16:33:52 [INFO] QUICK TIPS
2025-11-07 16:33:52 [INFO] ======================================================================
2025-11-07 16:33:52 [INFO] Section A (Query Effectiveness):
2025-11-07 16:33:52 [INFO]   - Tests core query generation and book fetching logic
2025-11-07 16:33:52 [INFO]   - Requires Google Books API key to be set
2025-11-07 16:33:52 [INFO]   - Can run independently of Flask server
2025-11-07 16:33:52 [INFO] Section B (API Integration):
2025-11-07 16:33:52 [INFO]   - Tests full end-to-end recommendation flow
2025-11-07 16:33:52 [INFO]   - Requires Flask server running: python app.py
2025-11-07 16:33:52 [INFO] Section C (Open Library Integration):
2025-11-07 16:33:52 [INFO]   - Tests Open Library API connection and fetching
2025-11-07 16:33:52 [INFO]   - Tests subject parsing and mapping integration
2025-11-07 16:33:52 [INFO]   - Tests fallback behavior for obscure queries
2025-11-07 16:33:52 [INFO]   - No API key required (public API)
2025-11-07 16:33:52 [INFO] Section D (Subject Mapping):
2025-11-07 16:33:52 [INFO]   - Tests both dynamic (DeepSeek) and fallback mapping
2025-11-07 16:33:52 [INFO]   - Tests caching and performance metrics
2025-11-07 16:33:52 [INFO]   - Dynamic tests require DEEPSEEK_API_KEY
2025-11-07 16:33:52 [INFO]   - Fallback tests work without API key
2025-11-07 16:33:52 [INFO] Section E (Explanation Generator API):
2025-11-07 16:33:52 [INFO]   - Tests explanation generation via API endpoint
2025-11-07 16:33:52 [INFO]   - Tests quality of API-returned explanations
2025-11-07 16:33:52 [INFO]   - Tests summary comparison in API response
2025-11-07 16:33:52 [INFO]   - Tests generateExplanations flag control
2025-11-07 16:33:52 [INFO]   - Requires Flask server running
2025-11-07 16:33:52 [INFO]   - No direct OpenAI calls in tests (handled by server)
2025-11-07 16:33:52 [INFO] Environment Variables:
2025-11-07 16:33:52 [INFO]   - GOOGLE_BOOKS_API_KEY: For Google Books API (optional)
2025-11-07 16:33:52 [INFO]   - DEEPSEEK_API_KEY: For dynamic subject mapping (optional)
2025-11-07 16:33:52 [INFO]   - Without API keys, tests will use fallback methods
2025-11-07 16:33:52 [INFO] For detailed logs:
2025-11-07 16:33:52 [INFO]   - Check logs/recommendation_tests.log
2025-11-07 16:33:52 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-07 16:33:52 [INFO] Common issues:
2025-11-07 16:33:52 [INFO]   - API key not set -> Some tests will be skipped
2025-11-07 16:33:52 [INFO]   - Server not running -> Section B tests will fail
2025-11-07 16:33:52 [INFO]   - Network timeout -> Increase timeout in test config
2025-11-07 16:33:52 [INFO] ======================================================================
2025-11-07 16:33:52 [INFO] TEST SUITE COMPLETE
2025-11-07 16:33:52 [INFO] ======================================================================
2025-11-10 15:31:32 [INFO] ======================================================================
2025-11-10 15:31:32 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-10 15:31:32 [INFO] ======================================================================
2025-11-10 15:31:32 [INFO] 
----------------------------------------------------------------------
2025-11-10 15:31:32 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-10 15:31:32 [INFO] ----------------------------------------------------------------------
2025-11-10 15:31:32 [INFO] 
======================================================================
2025-11-10 15:31:32 [INFO] TEST: A1: Query Generation
2025-11-10 15:31:32 [INFO] ======================================================================
2025-11-10 15:31:32 [INFO] Testing query generation for: Fantasy with Magic
2025-11-10 15:31:32 [INFO] [INFO]   Generated 1 queries:
2025-11-10 15:31:32 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-10 15:31:32 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-10 15:31:32 [INFO] [INFO]   Generated 1 queries:
2025-11-10 15:31:32 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-10 15:31:32 [INFO] Query Generation Test: 2/2 passed
2025-11-10 15:31:32 [INFO] 
======================================================================
2025-11-10 15:31:32 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-10 15:31:32 [INFO] ======================================================================
2025-11-10 15:31:32 [INFO] [INFO]   Fetching books...
2025-11-10 15:31:33 [INFO] [PASS]   Fetched 5 books
2025-11-10 15:31:33 [INFO] [INFO]   Fetching books...
2025-11-10 15:31:34 [INFO] [PASS]   Fetched 5 books
2025-11-10 15:31:34 [INFO] 
----------------------------------------------------------------------
2025-11-10 15:31:34 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-10 15:31:34 [INFO] ----------------------------------------------------------------------
2025-11-10 15:31:34 [INFO] 
======================================================================
2025-11-10 15:31:34 [INFO] TEST: B1: Flask Server Health Check
2025-11-10 15:31:34 [INFO] ======================================================================
2025-11-10 15:31:36 [INFO] [PASS] Server status: ok
2025-11-10 15:31:36 [INFO] 
----------------------------------------------------------------------
2025-11-10 15:31:36 [INFO] SECTION: C: OPEN LIBRARY INTEGRATION TESTS
2025-11-10 15:31:36 [INFO] ----------------------------------------------------------------------
2025-11-10 15:31:36 [INFO] 
======================================================================
2025-11-10 15:31:36 [INFO] TEST: C1: Open Library API Connection
2025-11-10 15:31:36 [INFO] ======================================================================
2025-11-10 15:31:36 [INFO] [INFO] Calling Open Library API...
2025-11-10 15:31:37 [INFO] [PASS] Returned 3 books
2025-11-10 15:31:37 [INFO] Open Library API test passed
2025-11-10 15:31:37 [INFO] 
======================================================================
2025-11-10 15:31:37 [INFO] TEST: C2: Enhanced Open Library Fetching
2025-11-10 15:31:37 [INFO] ======================================================================
2025-11-10 15:31:37 [INFO] [INFO]   Query: 'fantasy young adult magic'
2025-11-10 15:32:19 [INFO] [PASS]   Fetched 10 books
2025-11-10 15:32:19 [INFO] [INFO]   Books with mapped categories: 10/10
2025-11-10 15:32:19 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-10 15:32:19 [INFO] [INFO]   Query: 'dystopian rebellion'
2025-11-10 15:32:52 [INFO] [PASS]   Fetched 10 books
2025-11-10 15:32:52 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-10 15:32:52 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-10 15:32:52 [INFO] [INFO]   Query: 'contemporary realistic fiction'
2025-11-10 15:33:22 [INFO] [PASS]   Fetched 10 books
2025-11-10 15:33:22 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-10 15:33:22 [INFO] [PASS]   Met minimum results (10 >= 2)
2025-11-10 15:33:22 [INFO] Open Library Enhanced Test: 3/3 passed
2025-11-10 15:33:22 [INFO] 
======================================================================
2025-11-10 15:33:22 [INFO] TEST: C3: Open Library Subject Parsing
2025-11-10 15:33:22 [INFO] ======================================================================
2025-11-10 15:33:23 [INFO] [INFO] Analyzing 5 books for subject parsing...
2025-11-10 15:33:23 [INFO] [PASS]   4/5 books have subjects
2025-11-10 15:33:23 [INFO] [INFO]   Average subjects per book: 47.8
2025-11-10 15:33:23 [INFO] [INFO] 
  Sample subjects from 'The Magic Finger':
2025-11-10 15:33:23 [INFO] Open Library subject parsing test passed
2025-11-10 15:33:23 [INFO] 
======================================================================
2025-11-10 15:33:23 [INFO] TEST: C4: Open Library Fallback
2025-11-10 15:33:23 [INFO] ======================================================================
2025-11-10 15:33:23 [INFO] [INFO] Testing with intentionally obscure query...
2025-11-10 15:33:23 [WARNING] [WARN]   Even fallback returned no books (acceptable)
2025-11-10 15:33:23 [INFO] 
----------------------------------------------------------------------
2025-11-10 15:33:23 [INFO] SECTION: D: SUBJECT MAPPING TESTS
2025-11-10 15:33:23 [INFO] ----------------------------------------------------------------------
2025-11-10 15:33:23 [INFO] 
======================================================================
2025-11-10 15:33:23 [INFO] TEST: D1: Subject Mapper Initialization
2025-11-10 15:33:23 [INFO] ======================================================================
2025-11-10 15:33:23 [INFO] [INFO] Dynamic mapping: ENABLED
2025-11-10 15:33:23 [INFO] [INFO] Fallback mappings: 15 categories
2025-11-10 15:33:23 [INFO] [INFO] Cache capacity: 500
2025-11-10 15:33:23 [INFO] [PASS]   DeepSeek client initialized
2025-11-10 15:33:23 [INFO] [PASS]   Fallback category 'fantasy' loaded
2025-11-10 15:33:23 [INFO] [PASS]   Fallback category 'sci-fi' loaded
2025-11-10 15:33:23 [INFO] [PASS]   Fallback category 'mystery' loaded
2025-11-10 15:33:23 [INFO] [PASS]   Fallback category 'horror' loaded
2025-11-10 15:33:23 [INFO] [PASS]   Fallback category 'romance' loaded
2025-11-10 15:33:23 [INFO] Subject mapper initialization test passed
2025-11-10 15:33:23 [INFO] 
======================================================================
2025-11-10 15:33:23 [INFO] TEST: D2: Fallback Subject Mapping
2025-11-10 15:33:23 [INFO] ======================================================================
2025-11-10 15:33:23 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-10 15:33:23 [INFO] [INFO]   Mapped to: Fantasy, Coming Of Age
2025-11-10 15:33:23 [INFO] [INFO]   Relevance: 1.00
2025-11-10 15:33:23 [INFO] [INFO]   Method: fallback
2025-11-10 15:33:23 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 15:33:23 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-10 15:33:23 [INFO] [INFO]   Mapped to: Rebellion, Sci Fi, Coming Of Age
2025-11-10 15:33:23 [INFO] [INFO]   Relevance: 0.80
2025-11-10 15:33:23 [INFO] [INFO]   Method: fallback
2025-11-10 15:33:23 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 15:33:23 [INFO] [INFO]   Subjects: Mystery, Detective, Crime...
2025-11-10 15:33:23 [INFO] [INFO]   Mapped to: Mystery
2025-11-10 15:33:23 [INFO] [INFO]   Relevance: 1.00
2025-11-10 15:33:23 [INFO] [INFO]   Method: fallback
2025-11-10 15:33:23 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 15:33:23 [INFO] [INFO]   Subjects: Obscure Topic A, Rare Subject B, Unknown Category C...
2025-11-10 15:33:23 [INFO] [INFO]   Mapped to: Rare Subject B, Obscure Topic A, Unknown Category C
2025-11-10 15:33:23 [INFO] [INFO]   Relevance: 0.00
2025-11-10 15:33:23 [INFO] [INFO]   Method: fallback
2025-11-10 15:33:23 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 15:33:23 [INFO] Fallback Mapping Test: 4/4 passed
2025-11-10 15:33:23 [INFO] 
======================================================================
2025-11-10 15:33:23 [INFO] TEST: D3: Dynamic Subject Mapping with DeepSeek
2025-11-10 15:33:23 [INFO] ======================================================================
2025-11-10 15:33:23 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-10 15:33:23 [INFO] [INFO]   Context: 'fantasy young adult magic'
2025-11-10 15:33:27 [INFO] [INFO]   Mapped to: Fantasy, Magic, Coming-of-Age
2025-11-10 15:33:27 [INFO] [INFO]   Relevance: 0.95
2025-11-10 15:33:27 [INFO] [INFO]   Method: dynamic
2025-11-10 15:33:27 [INFO] [PASS]   Used dynamic mapping
2025-11-10 15:33:27 [INFO] [PASS]   Relevance meets minimum (0.95 >= 0.6)
2025-11-10 15:33:27 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-10 15:33:27 [INFO] [INFO]   Context: 'dystopian rebellion'
2025-11-10 15:33:30 [INFO] [INFO]   Mapped to: Dystopian, Rebellion, Sci-Fi
2025-11-10 15:33:30 [INFO] [INFO]   Relevance: 0.95
2025-11-10 15:33:30 [INFO] [INFO]   Method: dynamic
2025-11-10 15:33:30 [INFO] [PASS]   Used dynamic mapping
2025-11-10 15:33:30 [INFO] [PASS]   Relevance meets minimum (0.95 >= 0.6)
2025-11-10 15:33:30 [INFO] Dynamic Mapping Test: 2/2 passed
2025-11-10 15:33:30 [INFO] 
======================================================================
2025-11-10 15:33:30 [INFO] TEST: D4: Subject Mapping Cache
2025-11-10 15:33:30 [INFO] ======================================================================
2025-11-10 15:33:30 [INFO] [INFO] Testing cache behavior...
2025-11-10 15:33:34 [INFO] [INFO]   First call: dynamic (3553.0ms)
2025-11-10 15:33:34 [INFO] [INFO]   Second call: cached (0.0ms)
2025-11-10 15:33:34 [INFO] [PASS]   Cache working correctly
2025-11-10 15:33:34 [INFO] [PASS]   Cache faster (0.0ms vs 3553.0ms)
2025-11-10 15:33:34 [INFO] [PASS]   Cache returns identical results
2025-11-10 15:33:34 [INFO] 
======================================================================
2025-11-10 15:33:34 [INFO] TEST: D5: Subject Mapping Metrics
2025-11-10 15:33:34 [INFO] ======================================================================
2025-11-10 15:33:45 [INFO] [INFO] Metrics collected:
2025-11-10 15:33:45 [INFO] [PASS]   Metric 'total_calls' present
2025-11-10 15:33:45 [INFO] [PASS]   Metric 'cache_hit_rate' present
2025-11-10 15:33:45 [INFO] [PASS]   Metric 'dynamic_success_rate' present
2025-11-10 15:33:45 [INFO] [PASS]   Metric 'fallback_rate' present
2025-11-10 15:33:45 [INFO] Mapping metrics test passed
2025-11-10 15:33:45 [INFO] 
----------------------------------------------------------------------
2025-11-10 15:33:45 [INFO] SECTION: E: EXPLANATION GENERATOR TESTS
2025-11-10 15:33:45 [INFO] ----------------------------------------------------------------------
2025-11-10 15:33:45 [INFO] 
----------------------------------------------------------------------
2025-11-10 15:33:45 [INFO] SECTION: E: EXPLANATION GENERATOR API TESTS
2025-11-10 15:33:45 [INFO] ----------------------------------------------------------------------
2025-11-10 15:33:45 [INFO] 
======================================================================
2025-11-10 15:33:45 [INFO] TEST: E1: Explanation Generation via API
2025-11-10 15:33:45 [INFO] ======================================================================
2025-11-10 15:33:45 [INFO] [INFO] Setting up test conversation...
2025-11-10 15:33:47 [INFO] [INFO]   Session ID: -Odgfqj22hx9POdKIMNy...
2025-11-10 15:33:53 [INFO] [INFO]   Added 5 messages
2025-11-10 15:33:54 [INFO] [INFO] Calling /api/book-recommendations endpoint...
2025-11-10 15:35:26 [ERROR] [FAIL] Exception: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 15:35:26 [ERROR] Explanation API test failed
Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 449, in _make_request
    six.raise_from(e, None)
  File "<string>", line 3, in raise_from
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 444, in _make_request
    httplib_response = conn.getresponse()
                       ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 1374, in getresponse
    response.begin()
  File "C:\Python311\Lib\http\client.py", line 318, in begin
    version, status, reason = self._read_status()
                              ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 279, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\socket.py", line 705, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 489, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\util\retry.py", line 550, in increment
    raise six.reraise(type(error), error, _stacktrace)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\packages\six.py", line 770, in reraise
    raise value
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
                       ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 451, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=read_timeout)
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 340, in _raise_timeout
    raise ReadTimeoutError(
urllib3.exceptions.ReadTimeoutError: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_REcommendations.py", line 786, in test_explanation_api_endpoint
    response = requests.post(
               ^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 587, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 701, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 578, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 15:35:26 [INFO] 
======================================================================
2025-11-10 15:35:26 [INFO] TEST: E2: Explanation Quality Analysis
2025-11-10 15:35:26 [INFO] ======================================================================
2025-11-10 15:35:26 [INFO] [INFO] Setting up test conversation...
2025-11-10 15:35:33 [INFO] [INFO]   Added 5 messages
2025-11-10 15:35:34 [INFO] [INFO] Calling recommendations API...
2025-11-10 15:37:06 [ERROR] [FAIL] Exception: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 15:37:06 [ERROR] Quality analysis test failed
Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 449, in _make_request
    six.raise_from(e, None)
  File "<string>", line 3, in raise_from
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 444, in _make_request
    httplib_response = conn.getresponse()
                       ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 1374, in getresponse
    response.begin()
  File "C:\Python311\Lib\http\client.py", line 318, in begin
    version, status, reason = self._read_status()
                              ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 279, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\socket.py", line 705, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 489, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\util\retry.py", line 550, in increment
    raise six.reraise(type(error), error, _stacktrace)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\packages\six.py", line 770, in reraise
    raise value
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
                       ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 451, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=read_timeout)
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 340, in _raise_timeout
    raise ReadTimeoutError(
urllib3.exceptions.ReadTimeoutError: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_REcommendations.py", line 907, in test_explanation_quality_from_api
    response = requests.post(
               ^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 587, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 701, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 578, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 15:37:06 [INFO] 
======================================================================
2025-11-10 15:37:06 [INFO] TEST: E3: Summary Comparison via API
2025-11-10 15:37:06 [INFO] ======================================================================
2025-11-10 15:37:06 [INFO] [INFO] Setting up test conversation...
2025-11-10 15:37:14 [INFO] [INFO]   Added 5 messages
2025-11-10 15:37:15 [INFO] [INFO] Calling recommendations API...
2025-11-10 15:38:47 [ERROR] [FAIL] Exception: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 15:38:47 [ERROR] Summary comparison test failed
Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 449, in _make_request
    six.raise_from(e, None)
  File "<string>", line 3, in raise_from
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 444, in _make_request
    httplib_response = conn.getresponse()
                       ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 1374, in getresponse
    response.begin()
  File "C:\Python311\Lib\http\client.py", line 318, in begin
    version, status, reason = self._read_status()
                              ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 279, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\socket.py", line 705, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 489, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\util\retry.py", line 550, in increment
    raise six.reraise(type(error), error, _stacktrace)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\packages\six.py", line 770, in reraise
    raise value
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
                       ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 451, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=read_timeout)
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 340, in _raise_timeout
    raise ReadTimeoutError(
urllib3.exceptions.ReadTimeoutError: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_REcommendations.py", line 1044, in test_summary_comparison_from_api
    response = requests.post(
               ^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 587, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 701, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 578, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 15:38:47 [INFO] 
======================================================================
2025-11-10 15:38:47 [INFO] TEST: E4: Explanation Flag Control
2025-11-10 15:38:47 [INFO] ======================================================================
2025-11-10 15:38:47 [INFO] [INFO] Setting up test conversation...
2025-11-10 15:38:53 [INFO] [INFO]   Added 5 messages
2025-11-10 15:38:54 [INFO] [INFO] Testing with generateExplanations=True...
2025-11-10 15:40:22 [INFO] [INFO] Testing with generateExplanations=False...
2025-11-10 15:40:57 [INFO] [PASS]   WITH flag: 3/3 have explanations
2025-11-10 15:40:57 [INFO] [PASS]   WITHOUT flag: No explanations (as expected)
2025-11-10 15:40:57 [INFO] Explanation flag control test: 2/2 checks passed
2025-11-10 15:40:57 [INFO] ======================================================================
2025-11-10 15:40:57 [INFO] TEST SUMMARY
2025-11-10 15:40:57 [INFO] ======================================================================
2025-11-10 15:40:57 [INFO] 
Section A: Query Effectiveness:
2025-11-10 15:40:57 [INFO] [PASS] A1: Query Generation
2025-11-10 15:40:57 [INFO] [PASS] A2: Book Fetching
2025-11-10 15:40:57 [INFO] 
Section B: API Integration:
2025-11-10 15:40:57 [INFO] [PASS] B1: Server Health
2025-11-10 15:40:57 [INFO] 
Section C: Open Library Integration:
2025-11-10 15:40:57 [INFO] [PASS] C1: OL API Connection
2025-11-10 15:40:57 [INFO] [PASS] C2: OL Enhanced Fetching
2025-11-10 15:40:57 [INFO] [PASS] C3: OL Subject Parsing
2025-11-10 15:40:57 [INFO] [PASS] C4: OL Fallback
2025-11-10 15:40:57 [INFO] 
Section D: Subject Mapping:
2025-11-10 15:40:57 [INFO] [PASS] D1: Mapper Initialization
2025-11-10 15:40:57 [INFO] [PASS] D2: Fallback Mapping
2025-11-10 15:40:57 [INFO] [PASS] D3: Dynamic Mapping
2025-11-10 15:40:57 [INFO] [PASS] D4: Mapping Cache
2025-11-10 15:40:57 [INFO] [PASS] D5: Mapping Metrics
2025-11-10 15:40:57 [INFO] 
Section E: Explanation Generator API:
2025-11-10 15:40:57 [ERROR] [FAIL] E1: Explanation API
2025-11-10 15:40:57 [ERROR] [FAIL] E2: Quality Analysis
2025-11-10 15:40:57 [ERROR] [FAIL] E3: Summary Comparison
2025-11-10 15:40:57 [INFO] [PASS] E4: Flag Control
2025-11-10 15:40:57 [INFO] 
Overall Results: 13 passed, 3 failed, 0 skipped out of 16 tests
2025-11-10 15:40:57 [WARNING] [FAILURE] 3 tests failed out of 16
2025-11-10 15:40:57 [INFO] ======================================================================
2025-11-10 15:40:57 [INFO] QUICK TIPS
2025-11-10 15:40:57 [INFO] ======================================================================
2025-11-10 15:40:57 [INFO] Section A (Query Effectiveness):
2025-11-10 15:40:57 [INFO]   - Tests core query generation and book fetching logic
2025-11-10 15:40:57 [INFO]   - Requires Google Books API key to be set
2025-11-10 15:40:57 [INFO]   - Can run independently of Flask server
2025-11-10 15:40:57 [INFO] Section B (API Integration):
2025-11-10 15:40:57 [INFO]   - Tests full end-to-end recommendation flow
2025-11-10 15:40:57 [INFO]   - Requires Flask server running: python app.py
2025-11-10 15:40:57 [INFO] Section C (Open Library Integration):
2025-11-10 15:40:57 [INFO]   - Tests Open Library API connection and fetching
2025-11-10 15:40:57 [INFO]   - Tests subject parsing and mapping integration
2025-11-10 15:40:57 [INFO]   - Tests fallback behavior for obscure queries
2025-11-10 15:40:57 [INFO]   - No API key required (public API)
2025-11-10 15:40:57 [INFO] Section D (Subject Mapping):
2025-11-10 15:40:57 [INFO]   - Tests both dynamic (DeepSeek) and fallback mapping
2025-11-10 15:40:57 [INFO]   - Tests caching and performance metrics
2025-11-10 15:40:57 [INFO]   - Dynamic tests require DEEPSEEK_API_KEY
2025-11-10 15:40:57 [INFO]   - Fallback tests work without API key
2025-11-10 15:40:57 [INFO] Section E (Explanation Generator API):
2025-11-10 15:40:57 [INFO]   - Tests explanation generation via API endpoint
2025-11-10 15:40:57 [INFO]   - Tests quality of API-returned explanations
2025-11-10 15:40:57 [INFO]   - Tests summary comparison in API response
2025-11-10 15:40:57 [INFO]   - Tests generateExplanations flag control
2025-11-10 15:40:57 [INFO]   - Requires Flask server running
2025-11-10 15:40:57 [INFO]   - No direct OpenAI calls in tests (handled by server)
2025-11-10 15:40:57 [INFO] Environment Variables:
2025-11-10 15:40:57 [INFO]   - GOOGLE_BOOKS_API_KEY: For Google Books API (optional)
2025-11-10 15:40:57 [INFO]   - DEEPSEEK_API_KEY: For dynamic subject mapping (optional)
2025-11-10 15:40:57 [INFO]   - Without API keys, tests will use fallback methods
2025-11-10 15:40:57 [INFO] For detailed logs:
2025-11-10 15:40:57 [INFO]   - Check logs/recommendation_tests.log
2025-11-10 15:40:57 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-10 15:40:57 [INFO] Common issues:
2025-11-10 15:40:57 [INFO]   - API key not set -> Some tests will be skipped
2025-11-10 15:40:57 [INFO]   - Server not running -> Section B tests will fail
2025-11-10 15:40:57 [INFO]   - Network timeout -> Increase timeout in test config
2025-11-10 15:40:57 [INFO] ======================================================================
2025-11-10 15:40:57 [INFO] TEST SUITE COMPLETE
2025-11-10 15:40:57 [INFO] ======================================================================
2025-11-10 16:12:38 [INFO] ======================================================================
2025-11-10 16:12:38 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-10 16:12:38 [INFO] ======================================================================
2025-11-10 16:12:38 [INFO] 
----------------------------------------------------------------------
2025-11-10 16:12:38 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-10 16:12:38 [INFO] ----------------------------------------------------------------------
2025-11-10 16:12:38 [INFO] 
======================================================================
2025-11-10 16:12:38 [INFO] TEST: A1: Query Generation
2025-11-10 16:12:38 [INFO] ======================================================================
2025-11-10 16:12:38 [INFO] Testing query generation for: Fantasy with Magic
2025-11-10 16:12:38 [INFO] [INFO]   Generated 1 queries:
2025-11-10 16:12:38 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-10 16:12:38 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-10 16:12:38 [INFO] [INFO]   Generated 1 queries:
2025-11-10 16:12:38 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-10 16:12:38 [INFO] Query Generation Test: 2/2 passed
2025-11-10 16:12:38 [INFO] 
======================================================================
2025-11-10 16:12:38 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-10 16:12:38 [INFO] ======================================================================
2025-11-10 16:12:38 [INFO] [INFO]   Fetching books...
2025-11-10 16:12:40 [INFO] [PASS]   Fetched 5 books
2025-11-10 16:12:40 [INFO] [INFO]   Fetching books...
2025-11-10 16:12:41 [INFO] [PASS]   Fetched 5 books
2025-11-10 16:12:41 [INFO] 
----------------------------------------------------------------------
2025-11-10 16:12:41 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-10 16:12:41 [INFO] ----------------------------------------------------------------------
2025-11-10 16:12:41 [INFO] 
======================================================================
2025-11-10 16:12:41 [INFO] TEST: B1: Flask Server Health Check
2025-11-10 16:12:41 [INFO] ======================================================================
2025-11-10 16:12:43 [INFO] [PASS] Server status: ok
2025-11-10 16:12:43 [INFO] 
----------------------------------------------------------------------
2025-11-10 16:12:43 [INFO] SECTION: C: OPEN LIBRARY INTEGRATION TESTS
2025-11-10 16:12:43 [INFO] ----------------------------------------------------------------------
2025-11-10 16:12:43 [INFO] 
======================================================================
2025-11-10 16:12:43 [INFO] TEST: C1: Open Library API Connection
2025-11-10 16:12:43 [INFO] ======================================================================
2025-11-10 16:12:43 [INFO] [INFO] Calling Open Library API...
2025-11-10 16:12:44 [INFO] [PASS] Returned 3 books
2025-11-10 16:12:44 [INFO] Open Library API test passed
2025-11-10 16:12:44 [INFO] 
======================================================================
2025-11-10 16:12:44 [INFO] TEST: C2: Enhanced Open Library Fetching
2025-11-10 16:12:44 [INFO] ======================================================================
2025-11-10 16:12:44 [INFO] [INFO]   Query: 'fantasy young adult magic'
2025-11-10 16:13:24 [INFO] [PASS]   Fetched 10 books
2025-11-10 16:13:24 [INFO] [INFO]   Books with mapped categories: 10/10
2025-11-10 16:13:24 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-10 16:13:24 [INFO] [INFO]   Query: 'dystopian rebellion'
2025-11-10 16:13:56 [INFO] [PASS]   Fetched 10 books
2025-11-10 16:13:56 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-10 16:13:56 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-10 16:13:56 [INFO] [INFO]   Query: 'contemporary realistic fiction'
2025-11-10 16:14:27 [INFO] [PASS]   Fetched 10 books
2025-11-10 16:14:27 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-10 16:14:27 [INFO] [PASS]   Met minimum results (10 >= 2)
2025-11-10 16:14:27 [INFO] Open Library Enhanced Test: 3/3 passed
2025-11-10 16:14:27 [INFO] 
======================================================================
2025-11-10 16:14:27 [INFO] TEST: C3: Open Library Subject Parsing
2025-11-10 16:14:27 [INFO] ======================================================================
2025-11-10 16:14:28 [INFO] [INFO] Analyzing 5 books for subject parsing...
2025-11-10 16:14:28 [INFO] [PASS]   4/5 books have subjects
2025-11-10 16:14:28 [INFO] [INFO]   Average subjects per book: 47.8
2025-11-10 16:14:28 [INFO] [INFO] 
  Sample subjects from 'The Magic Finger':
2025-11-10 16:14:28 [INFO] Open Library subject parsing test passed
2025-11-10 16:14:28 [INFO] 
======================================================================
2025-11-10 16:14:28 [INFO] TEST: C4: Open Library Fallback
2025-11-10 16:14:28 [INFO] ======================================================================
2025-11-10 16:14:28 [INFO] [INFO] Testing with intentionally obscure query...
2025-11-10 16:14:28 [WARNING] [WARN]   Even fallback returned no books (acceptable)
2025-11-10 16:14:28 [INFO] 
----------------------------------------------------------------------
2025-11-10 16:14:28 [INFO] SECTION: D: SUBJECT MAPPING TESTS
2025-11-10 16:14:28 [INFO] ----------------------------------------------------------------------
2025-11-10 16:14:29 [INFO] 
======================================================================
2025-11-10 16:14:29 [INFO] TEST: D1: Subject Mapper Initialization
2025-11-10 16:14:29 [INFO] ======================================================================
2025-11-10 16:14:29 [INFO] [INFO] Dynamic mapping: ENABLED
2025-11-10 16:14:29 [INFO] [INFO] Fallback mappings: 15 categories
2025-11-10 16:14:29 [INFO] [INFO] Cache capacity: 500
2025-11-10 16:14:29 [INFO] [PASS]   DeepSeek client initialized
2025-11-10 16:14:29 [INFO] [PASS]   Fallback category 'fantasy' loaded
2025-11-10 16:14:29 [INFO] [PASS]   Fallback category 'sci-fi' loaded
2025-11-10 16:14:29 [INFO] [PASS]   Fallback category 'mystery' loaded
2025-11-10 16:14:29 [INFO] [PASS]   Fallback category 'horror' loaded
2025-11-10 16:14:29 [INFO] [PASS]   Fallback category 'romance' loaded
2025-11-10 16:14:29 [INFO] Subject mapper initialization test passed
2025-11-10 16:14:29 [INFO] 
======================================================================
2025-11-10 16:14:29 [INFO] TEST: D2: Fallback Subject Mapping
2025-11-10 16:14:29 [INFO] ======================================================================
2025-11-10 16:14:29 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-10 16:14:29 [INFO] [INFO]   Mapped to: Fantasy, Coming Of Age
2025-11-10 16:14:29 [INFO] [INFO]   Relevance: 1.00
2025-11-10 16:14:29 [INFO] [INFO]   Method: fallback
2025-11-10 16:14:29 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 16:14:29 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-10 16:14:29 [INFO] [INFO]   Mapped to: Coming Of Age, Rebellion, Sci Fi
2025-11-10 16:14:29 [INFO] [INFO]   Relevance: 0.80
2025-11-10 16:14:29 [INFO] [INFO]   Method: fallback
2025-11-10 16:14:29 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 16:14:29 [INFO] [INFO]   Subjects: Mystery, Detective, Crime...
2025-11-10 16:14:29 [INFO] [INFO]   Mapped to: Mystery
2025-11-10 16:14:29 [INFO] [INFO]   Relevance: 1.00
2025-11-10 16:14:29 [INFO] [INFO]   Method: fallback
2025-11-10 16:14:29 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 16:14:29 [INFO] [INFO]   Subjects: Obscure Topic A, Rare Subject B, Unknown Category C...
2025-11-10 16:14:29 [INFO] [INFO]   Mapped to: Obscure Topic A, Unknown Category C, Rare Subject B
2025-11-10 16:14:29 [INFO] [INFO]   Relevance: 0.00
2025-11-10 16:14:29 [INFO] [INFO]   Method: fallback
2025-11-10 16:14:29 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 16:14:29 [INFO] Fallback Mapping Test: 4/4 passed
2025-11-10 16:14:29 [INFO] 
======================================================================
2025-11-10 16:14:29 [INFO] TEST: D3: Dynamic Subject Mapping with DeepSeek
2025-11-10 16:14:29 [INFO] ======================================================================
2025-11-10 16:14:29 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-10 16:14:29 [INFO] [INFO]   Context: 'fantasy young adult magic'
2025-11-10 16:14:32 [INFO] [INFO]   Mapped to: Fantasy, Magic, Coming-of-Age
2025-11-10 16:14:32 [INFO] [INFO]   Relevance: 0.95
2025-11-10 16:14:32 [INFO] [INFO]   Method: dynamic
2025-11-10 16:14:32 [INFO] [PASS]   Used dynamic mapping
2025-11-10 16:14:32 [INFO] [PASS]   Relevance meets minimum (0.95 >= 0.6)
2025-11-10 16:14:32 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-10 16:14:32 [INFO] [INFO]   Context: 'dystopian rebellion'
2025-11-10 16:14:36 [INFO] [INFO]   Mapped to: Dystopian, Rebellion, Sci-Fi
2025-11-10 16:14:36 [INFO] [INFO]   Relevance: 0.90
2025-11-10 16:14:36 [INFO] [INFO]   Method: dynamic
2025-11-10 16:14:36 [INFO] [PASS]   Used dynamic mapping
2025-11-10 16:14:36 [INFO] [PASS]   Relevance meets minimum (0.90 >= 0.6)
2025-11-10 16:14:36 [INFO] Dynamic Mapping Test: 2/2 passed
2025-11-10 16:14:36 [INFO] 
======================================================================
2025-11-10 16:14:36 [INFO] TEST: D4: Subject Mapping Cache
2025-11-10 16:14:36 [INFO] ======================================================================
2025-11-10 16:14:36 [INFO] [INFO] Testing cache behavior...
2025-11-10 16:14:40 [INFO] [INFO]   First call: dynamic (4128.5ms)
2025-11-10 16:14:40 [INFO] [INFO]   Second call: cached (0.0ms)
2025-11-10 16:14:40 [INFO] [PASS]   Cache working correctly
2025-11-10 16:14:40 [INFO] [PASS]   Cache faster (0.0ms vs 4128.5ms)
2025-11-10 16:14:40 [INFO] [PASS]   Cache returns identical results
2025-11-10 16:14:40 [INFO] 
======================================================================
2025-11-10 16:14:40 [INFO] TEST: D5: Subject Mapping Metrics
2025-11-10 16:14:40 [INFO] ======================================================================
2025-11-10 16:14:52 [INFO] [INFO] Metrics collected:
2025-11-10 16:14:52 [INFO] [PASS]   Metric 'total_calls' present
2025-11-10 16:14:52 [INFO] [PASS]   Metric 'cache_hit_rate' present
2025-11-10 16:14:52 [INFO] [PASS]   Metric 'dynamic_success_rate' present
2025-11-10 16:14:52 [INFO] [PASS]   Metric 'fallback_rate' present
2025-11-10 16:14:52 [INFO] Mapping metrics test passed
2025-11-10 16:14:52 [INFO] 
----------------------------------------------------------------------
2025-11-10 16:14:52 [INFO] SECTION: E: EXPLANATION GENERATOR TESTS
2025-11-10 16:14:52 [INFO] ----------------------------------------------------------------------
2025-11-10 16:14:52 [INFO] 
----------------------------------------------------------------------
2025-11-10 16:14:52 [INFO] SECTION: E: EXPLANATION GENERATOR API TESTS
2025-11-10 16:14:52 [INFO] ----------------------------------------------------------------------
2025-11-10 16:14:52 [INFO] 
======================================================================
2025-11-10 16:14:52 [INFO] TEST: E1: Explanation Generation via API
2025-11-10 16:14:52 [INFO] ======================================================================
2025-11-10 16:14:52 [INFO] [INFO] Setting up test conversation...
2025-11-10 16:14:54 [INFO] [INFO]   Session ID: -OdgpFtmplonoifGC-7O...
2025-11-10 16:14:59 [INFO] [INFO]   Added 5 messages
2025-11-10 16:15:00 [INFO] [INFO] Calling /api/book-recommendations endpoint...
2025-11-10 16:16:32 [ERROR] [FAIL] Exception: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 16:16:32 [ERROR] Explanation API test failed
Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 449, in _make_request
    six.raise_from(e, None)
  File "<string>", line 3, in raise_from
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 444, in _make_request
    httplib_response = conn.getresponse()
                       ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 1374, in getresponse
    response.begin()
  File "C:\Python311\Lib\http\client.py", line 318, in begin
    version, status, reason = self._read_status()
                              ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 279, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\socket.py", line 705, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 489, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\util\retry.py", line 550, in increment
    raise six.reraise(type(error), error, _stacktrace)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\packages\six.py", line 770, in reraise
    raise value
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
                       ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 451, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=read_timeout)
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 340, in _raise_timeout
    raise ReadTimeoutError(
urllib3.exceptions.ReadTimeoutError: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_REcommendations.py", line 786, in test_explanation_api_endpoint
    response = requests.post(
               ^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 587, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 701, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 578, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 16:16:32 [INFO] 
======================================================================
2025-11-10 16:16:32 [INFO] TEST: E2: Explanation Quality Analysis
2025-11-10 16:16:32 [INFO] ======================================================================
2025-11-10 16:16:32 [INFO] [INFO] Setting up test conversation...
2025-11-10 16:16:43 [INFO] [INFO]   Added 5 messages
2025-11-10 16:16:44 [INFO] [INFO] Calling recommendations API...
2025-11-10 16:17:19 [ERROR] [FAIL] API returned status 500
2025-11-10 16:17:19 [INFO] 
======================================================================
2025-11-10 16:17:19 [INFO] TEST: E3: Summary Comparison via API
2025-11-10 16:17:19 [INFO] ======================================================================
2025-11-10 16:17:19 [INFO] [INFO] Setting up test conversation...
2025-11-10 16:17:29 [INFO] [INFO]   Added 5 messages
2025-11-10 16:17:30 [INFO] [INFO] Calling recommendations API...
2025-11-10 16:19:02 [ERROR] [FAIL] Exception: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 16:19:02 [ERROR] Summary comparison test failed
Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 449, in _make_request
    six.raise_from(e, None)
  File "<string>", line 3, in raise_from
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 444, in _make_request
    httplib_response = conn.getresponse()
                       ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 1374, in getresponse
    response.begin()
  File "C:\Python311\Lib\http\client.py", line 318, in begin
    version, status, reason = self._read_status()
                              ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 279, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\socket.py", line 705, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 489, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\util\retry.py", line 550, in increment
    raise six.reraise(type(error), error, _stacktrace)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\packages\six.py", line 770, in reraise
    raise value
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
                       ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 451, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=read_timeout)
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 340, in _raise_timeout
    raise ReadTimeoutError(
urllib3.exceptions.ReadTimeoutError: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_REcommendations.py", line 1044, in test_summary_comparison_from_api
    response = requests.post(
               ^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 587, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 701, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 578, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 16:19:02 [INFO] 
======================================================================
2025-11-10 16:19:02 [INFO] TEST: E4: Explanation Flag Control
2025-11-10 16:19:02 [INFO] ======================================================================
2025-11-10 16:19:02 [INFO] [INFO] Setting up test conversation...
2025-11-10 16:19:02 [ERROR] [FAIL] Exception: HTTPSConnectionPool(host='guidedcreativeplanning-session.onrender.com', port=443): Max retries exceeded with url: /session/create (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x0000029BC168EDD0>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed'))
2025-11-10 16:19:02 [ERROR] Flag control test failed
Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\urllib3\connection.py", line 174, in _new_conn
    conn = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\util\connection.py", line 72, in create_connection
    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\socket.py", line 961, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
socket.gaierror: [Errno 11001] getaddrinfo failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
                       ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 386, in _make_request
    self._validate_conn(conn)
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 1042, in _validate_conn
    conn.connect()
  File "C:\Python311\Lib\site-packages\urllib3\connection.py", line 358, in connect
    self.sock = conn = self._new_conn()
                       ^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connection.py", line 186, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPSConnection object at 0x0000029BC168EDD0>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 489, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\util\retry.py", line 592, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='guidedcreativeplanning-session.onrender.com', port=443): Max retries exceeded with url: /session/create (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x0000029BC168EDD0>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_REcommendations.py", line 1118, in test_explanation_flag_control
    session_id = helper.create_session(user_id, mode='brainstorming')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\session_helper.py", line 64, in create_session
    response = requests.post(
               ^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 587, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 701, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 565, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPSConnectionPool(host='guidedcreativeplanning-session.onrender.com', port=443): Max retries exceeded with url: /session/create (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x0000029BC168EDD0>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed'))
2025-11-10 16:19:02 [INFO] ======================================================================
2025-11-10 16:19:02 [INFO] TEST SUMMARY
2025-11-10 16:19:02 [INFO] ======================================================================
2025-11-10 16:19:02 [INFO] 
Section A: Query Effectiveness:
2025-11-10 16:19:02 [INFO] [PASS] A1: Query Generation
2025-11-10 16:19:02 [INFO] [PASS] A2: Book Fetching
2025-11-10 16:19:02 [INFO] 
Section B: API Integration:
2025-11-10 16:19:02 [INFO] [PASS] B1: Server Health
2025-11-10 16:19:02 [INFO] 
Section C: Open Library Integration:
2025-11-10 16:19:02 [INFO] [PASS] C1: OL API Connection
2025-11-10 16:19:02 [INFO] [PASS] C2: OL Enhanced Fetching
2025-11-10 16:19:02 [INFO] [PASS] C3: OL Subject Parsing
2025-11-10 16:19:02 [INFO] [PASS] C4: OL Fallback
2025-11-10 16:19:02 [INFO] 
Section D: Subject Mapping:
2025-11-10 16:19:02 [INFO] [PASS] D1: Mapper Initialization
2025-11-10 16:19:02 [INFO] [PASS] D2: Fallback Mapping
2025-11-10 16:19:02 [INFO] [PASS] D3: Dynamic Mapping
2025-11-10 16:19:02 [INFO] [PASS] D4: Mapping Cache
2025-11-10 16:19:02 [INFO] [PASS] D5: Mapping Metrics
2025-11-10 16:19:02 [INFO] 
Section E: Explanation Generator API:
2025-11-10 16:19:02 [ERROR] [FAIL] E1: Explanation API
2025-11-10 16:19:02 [ERROR] [FAIL] E2: Quality Analysis
2025-11-10 16:19:02 [ERROR] [FAIL] E3: Summary Comparison
2025-11-10 16:19:02 [ERROR] [FAIL] E4: Flag Control
2025-11-10 16:19:02 [INFO] 
Overall Results: 12 passed, 4 failed, 0 skipped out of 16 tests
2025-11-10 16:19:02 [WARNING] [FAILURE] 4 tests failed out of 16
2025-11-10 16:19:02 [INFO] ======================================================================
2025-11-10 16:19:02 [INFO] QUICK TIPS
2025-11-10 16:19:02 [INFO] ======================================================================
2025-11-10 16:19:02 [INFO] Section A (Query Effectiveness):
2025-11-10 16:19:02 [INFO]   - Tests core query generation and book fetching logic
2025-11-10 16:19:02 [INFO]   - Requires Google Books API key to be set
2025-11-10 16:19:02 [INFO]   - Can run independently of Flask server
2025-11-10 16:19:02 [INFO] Section B (API Integration):
2025-11-10 16:19:02 [INFO]   - Tests full end-to-end recommendation flow
2025-11-10 16:19:02 [INFO]   - Requires Flask server running: python app.py
2025-11-10 16:19:02 [INFO] Section C (Open Library Integration):
2025-11-10 16:19:02 [INFO]   - Tests Open Library API connection and fetching
2025-11-10 16:19:02 [INFO]   - Tests subject parsing and mapping integration
2025-11-10 16:19:02 [INFO]   - Tests fallback behavior for obscure queries
2025-11-10 16:19:02 [INFO]   - No API key required (public API)
2025-11-10 16:19:02 [INFO] Section D (Subject Mapping):
2025-11-10 16:19:02 [INFO]   - Tests both dynamic (DeepSeek) and fallback mapping
2025-11-10 16:19:02 [INFO]   - Tests caching and performance metrics
2025-11-10 16:19:02 [INFO]   - Dynamic tests require DEEPSEEK_API_KEY
2025-11-10 16:19:02 [INFO]   - Fallback tests work without API key
2025-11-10 16:19:02 [INFO] Section E (Explanation Generator API):
2025-11-10 16:19:02 [INFO]   - Tests explanation generation via API endpoint
2025-11-10 16:19:02 [INFO]   - Tests quality of API-returned explanations
2025-11-10 16:19:02 [INFO]   - Tests summary comparison in API response
2025-11-10 16:19:02 [INFO]   - Tests generateExplanations flag control
2025-11-10 16:19:02 [INFO]   - Requires Flask server running
2025-11-10 16:19:02 [INFO]   - No direct OpenAI calls in tests (handled by server)
2025-11-10 16:19:02 [INFO] Environment Variables:
2025-11-10 16:19:02 [INFO]   - GOOGLE_BOOKS_API_KEY: For Google Books API (optional)
2025-11-10 16:19:02 [INFO]   - DEEPSEEK_API_KEY: For dynamic subject mapping (optional)
2025-11-10 16:19:02 [INFO]   - Without API keys, tests will use fallback methods
2025-11-10 16:19:02 [INFO] For detailed logs:
2025-11-10 16:19:02 [INFO]   - Check logs/recommendation_tests.log
2025-11-10 16:19:02 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-10 16:19:02 [INFO] Common issues:
2025-11-10 16:19:02 [INFO]   - API key not set -> Some tests will be skipped
2025-11-10 16:19:02 [INFO]   - Server not running -> Section B tests will fail
2025-11-10 16:19:02 [INFO]   - Network timeout -> Increase timeout in test config
2025-11-10 16:19:02 [INFO] ======================================================================
2025-11-10 16:19:02 [INFO] TEST SUITE COMPLETE
2025-11-10 16:19:02 [INFO] ======================================================================
2025-11-10 16:48:37 [INFO] ======================================================================
2025-11-10 16:48:37 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-10 16:48:37 [INFO] ======================================================================
2025-11-10 16:48:37 [INFO] 
----------------------------------------------------------------------
2025-11-10 16:48:37 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-10 16:48:37 [INFO] ----------------------------------------------------------------------
2025-11-10 16:48:37 [INFO] 
======================================================================
2025-11-10 16:48:37 [INFO] TEST: A1: Query Generation
2025-11-10 16:48:37 [INFO] ======================================================================
2025-11-10 16:48:37 [INFO] Testing query generation for: Fantasy with Magic
2025-11-10 16:48:37 [INFO] [INFO]   Generated 1 queries:
2025-11-10 16:48:37 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-10 16:48:37 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-10 16:48:37 [INFO] [INFO]   Generated 1 queries:
2025-11-10 16:48:37 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-10 16:48:37 [INFO] Query Generation Test: 2/2 passed
2025-11-10 16:48:37 [INFO] 
======================================================================
2025-11-10 16:48:37 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-10 16:48:37 [INFO] ======================================================================
2025-11-10 16:48:37 [INFO] [INFO]   Fetching books...
2025-11-10 16:48:38 [INFO] [PASS]   Fetched 5 books
2025-11-10 16:48:38 [INFO] [INFO]   Fetching books...
2025-11-10 16:48:40 [INFO] [PASS]   Fetched 5 books
2025-11-10 16:48:40 [INFO] 
----------------------------------------------------------------------
2025-11-10 16:48:40 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-10 16:48:40 [INFO] ----------------------------------------------------------------------
2025-11-10 16:48:40 [INFO] 
======================================================================
2025-11-10 16:48:40 [INFO] TEST: B1: Flask Server Health Check
2025-11-10 16:48:40 [INFO] ======================================================================
2025-11-10 16:48:42 [INFO] [PASS] Server status: ok
2025-11-10 16:48:42 [INFO] 
----------------------------------------------------------------------
2025-11-10 16:48:42 [INFO] SECTION: C: OPEN LIBRARY INTEGRATION TESTS
2025-11-10 16:48:42 [INFO] ----------------------------------------------------------------------
2025-11-10 16:48:42 [INFO] 
======================================================================
2025-11-10 16:48:42 [INFO] TEST: C1: Open Library API Connection
2025-11-10 16:48:42 [INFO] ======================================================================
2025-11-10 16:48:42 [INFO] [INFO] Calling Open Library API...
2025-11-10 16:48:43 [INFO] [PASS] Returned 3 books
2025-11-10 16:48:43 [INFO] Open Library API test passed
2025-11-10 16:48:43 [INFO] 
======================================================================
2025-11-10 16:48:43 [INFO] TEST: C2: Enhanced Open Library Fetching
2025-11-10 16:48:43 [INFO] ======================================================================
2025-11-10 16:48:43 [INFO] [INFO]   Query: 'fantasy young adult magic'
2025-11-10 16:49:22 [INFO] [PASS]   Fetched 10 books
2025-11-10 16:49:22 [INFO] [INFO]   Books with mapped categories: 10/10
2025-11-10 16:49:22 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-10 16:49:22 [INFO] [INFO]   Query: 'dystopian rebellion'
2025-11-10 16:49:54 [INFO] [PASS]   Fetched 10 books
2025-11-10 16:49:54 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-10 16:49:54 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-10 16:49:54 [INFO] [INFO]   Query: 'contemporary realistic fiction'
2025-11-10 16:50:24 [INFO] [PASS]   Fetched 10 books
2025-11-10 16:50:24 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-10 16:50:24 [INFO] [PASS]   Met minimum results (10 >= 2)
2025-11-10 16:50:24 [INFO] Open Library Enhanced Test: 3/3 passed
2025-11-10 16:50:24 [INFO] 
======================================================================
2025-11-10 16:50:24 [INFO] TEST: C3: Open Library Subject Parsing
2025-11-10 16:50:24 [INFO] ======================================================================
2025-11-10 16:50:24 [INFO] [INFO] Analyzing 5 books for subject parsing...
2025-11-10 16:50:24 [INFO] [PASS]   4/5 books have subjects
2025-11-10 16:50:24 [INFO] [INFO]   Average subjects per book: 47.8
2025-11-10 16:50:24 [INFO] [INFO] 
  Sample subjects from 'The Magic Finger':
2025-11-10 16:50:24 [INFO] Open Library subject parsing test passed
2025-11-10 16:50:24 [INFO] 
======================================================================
2025-11-10 16:50:24 [INFO] TEST: C4: Open Library Fallback
2025-11-10 16:50:24 [INFO] ======================================================================
2025-11-10 16:50:24 [INFO] [INFO] Testing with intentionally obscure query...
2025-11-10 16:50:25 [WARNING] [WARN]   Even fallback returned no books (acceptable)
2025-11-10 16:50:25 [INFO] 
----------------------------------------------------------------------
2025-11-10 16:50:25 [INFO] SECTION: D: SUBJECT MAPPING TESTS
2025-11-10 16:50:25 [INFO] ----------------------------------------------------------------------
2025-11-10 16:50:25 [INFO] 
======================================================================
2025-11-10 16:50:25 [INFO] TEST: D1: Subject Mapper Initialization
2025-11-10 16:50:25 [INFO] ======================================================================
2025-11-10 16:50:25 [INFO] [INFO] Dynamic mapping: ENABLED
2025-11-10 16:50:25 [INFO] [INFO] Fallback mappings: 15 categories
2025-11-10 16:50:25 [INFO] [INFO] Cache capacity: 500
2025-11-10 16:50:25 [INFO] [PASS]   DeepSeek client initialized
2025-11-10 16:50:25 [INFO] [PASS]   Fallback category 'fantasy' loaded
2025-11-10 16:50:25 [INFO] [PASS]   Fallback category 'sci-fi' loaded
2025-11-10 16:50:25 [INFO] [PASS]   Fallback category 'mystery' loaded
2025-11-10 16:50:25 [INFO] [PASS]   Fallback category 'horror' loaded
2025-11-10 16:50:25 [INFO] [PASS]   Fallback category 'romance' loaded
2025-11-10 16:50:25 [INFO] Subject mapper initialization test passed
2025-11-10 16:50:25 [INFO] 
======================================================================
2025-11-10 16:50:25 [INFO] TEST: D2: Fallback Subject Mapping
2025-11-10 16:50:25 [INFO] ======================================================================
2025-11-10 16:50:25 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-10 16:50:25 [INFO] [INFO]   Mapped to: Fantasy, Coming Of Age
2025-11-10 16:50:25 [INFO] [INFO]   Relevance: 1.00
2025-11-10 16:50:25 [INFO] [INFO]   Method: fallback
2025-11-10 16:50:25 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 16:50:25 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-10 16:50:25 [INFO] [INFO]   Mapped to: Sci Fi, Rebellion, Coming Of Age
2025-11-10 16:50:25 [INFO] [INFO]   Relevance: 0.80
2025-11-10 16:50:25 [INFO] [INFO]   Method: fallback
2025-11-10 16:50:25 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 16:50:25 [INFO] [INFO]   Subjects: Mystery, Detective, Crime...
2025-11-10 16:50:25 [INFO] [INFO]   Mapped to: Mystery
2025-11-10 16:50:25 [INFO] [INFO]   Relevance: 1.00
2025-11-10 16:50:25 [INFO] [INFO]   Method: fallback
2025-11-10 16:50:25 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 16:50:25 [INFO] [INFO]   Subjects: Obscure Topic A, Rare Subject B, Unknown Category C...
2025-11-10 16:50:25 [INFO] [INFO]   Mapped to: Unknown Category C, Rare Subject B, Obscure Topic A
2025-11-10 16:50:25 [INFO] [INFO]   Relevance: 0.00
2025-11-10 16:50:25 [INFO] [INFO]   Method: fallback
2025-11-10 16:50:25 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 16:50:25 [INFO] Fallback Mapping Test: 4/4 passed
2025-11-10 16:50:25 [INFO] 
======================================================================
2025-11-10 16:50:25 [INFO] TEST: D3: Dynamic Subject Mapping with DeepSeek
2025-11-10 16:50:25 [INFO] ======================================================================
2025-11-10 16:50:25 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-10 16:50:25 [INFO] [INFO]   Context: 'fantasy young adult magic'
2025-11-10 16:50:28 [INFO] [INFO]   Mapped to: Fantasy, Magic, Coming-of-Age
2025-11-10 16:50:28 [INFO] [INFO]   Relevance: 0.95
2025-11-10 16:50:28 [INFO] [INFO]   Method: dynamic
2025-11-10 16:50:28 [INFO] [PASS]   Used dynamic mapping
2025-11-10 16:50:28 [INFO] [PASS]   Relevance meets minimum (0.95 >= 0.6)
2025-11-10 16:50:28 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-10 16:50:28 [INFO] [INFO]   Context: 'dystopian rebellion'
2025-11-10 16:50:31 [INFO] [INFO]   Mapped to: Dystopian, Rebellion, Sci-Fi
2025-11-10 16:50:31 [INFO] [INFO]   Relevance: 0.90
2025-11-10 16:50:31 [INFO] [INFO]   Method: dynamic
2025-11-10 16:50:31 [INFO] [PASS]   Used dynamic mapping
2025-11-10 16:50:31 [INFO] [PASS]   Relevance meets minimum (0.90 >= 0.6)
2025-11-10 16:50:31 [INFO] Dynamic Mapping Test: 2/2 passed
2025-11-10 16:50:31 [INFO] 
======================================================================
2025-11-10 16:50:31 [INFO] TEST: D4: Subject Mapping Cache
2025-11-10 16:50:31 [INFO] ======================================================================
2025-11-10 16:50:31 [INFO] [INFO] Testing cache behavior...
2025-11-10 16:50:35 [INFO] [INFO]   First call: dynamic (3582.8ms)
2025-11-10 16:50:35 [INFO] [INFO]   Second call: cached (0.0ms)
2025-11-10 16:50:35 [INFO] [PASS]   Cache working correctly
2025-11-10 16:50:35 [INFO] [PASS]   Cache faster (0.0ms vs 3582.8ms)
2025-11-10 16:50:35 [INFO] [PASS]   Cache returns identical results
2025-11-10 16:50:35 [INFO] 
======================================================================
2025-11-10 16:50:35 [INFO] TEST: D5: Subject Mapping Metrics
2025-11-10 16:50:35 [INFO] ======================================================================
2025-11-10 16:50:45 [INFO] [INFO] Metrics collected:
2025-11-10 16:50:45 [INFO] [PASS]   Metric 'total_calls' present
2025-11-10 16:50:45 [INFO] [PASS]   Metric 'cache_hit_rate' present
2025-11-10 16:50:45 [INFO] [PASS]   Metric 'dynamic_success_rate' present
2025-11-10 16:50:45 [INFO] [PASS]   Metric 'fallback_rate' present
2025-11-10 16:50:45 [INFO] Mapping metrics test passed
2025-11-10 16:50:45 [INFO] 
----------------------------------------------------------------------
2025-11-10 16:50:45 [INFO] SECTION: E: EXPLANATION GENERATOR TESTS
2025-11-10 16:50:45 [INFO] ----------------------------------------------------------------------
2025-11-10 16:50:45 [INFO] 
----------------------------------------------------------------------
2025-11-10 16:50:45 [INFO] SECTION: E: EXPLANATION GENERATOR API TESTS
2025-11-10 16:50:45 [INFO] ----------------------------------------------------------------------
2025-11-10 16:50:45 [INFO] 
======================================================================
2025-11-10 16:50:45 [INFO] TEST: E1: Explanation Generation via API
2025-11-10 16:50:45 [INFO] ======================================================================
2025-11-10 16:50:45 [INFO] [INFO] Setting up test conversation...
2025-11-10 16:50:47 [INFO] [INFO]   Session ID: -OdgxTb3QI9YC42vXLAu...
2025-11-10 16:50:51 [INFO] [INFO]   Added 5 messages
2025-11-10 16:50:52 [INFO] [INFO] Calling /api/book-recommendations endpoint...
2025-11-10 16:52:24 [ERROR] [FAIL] Exception: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 16:52:24 [ERROR] Explanation API test failed
Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 449, in _make_request
    six.raise_from(e, None)
  File "<string>", line 3, in raise_from
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 444, in _make_request
    httplib_response = conn.getresponse()
                       ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 1374, in getresponse
    response.begin()
  File "C:\Python311\Lib\http\client.py", line 318, in begin
    version, status, reason = self._read_status()
                              ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 279, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\socket.py", line 705, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 489, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\util\retry.py", line 550, in increment
    raise six.reraise(type(error), error, _stacktrace)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\packages\six.py", line 770, in reraise
    raise value
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
                       ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 451, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=read_timeout)
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 340, in _raise_timeout
    raise ReadTimeoutError(
urllib3.exceptions.ReadTimeoutError: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_REcommendations.py", line 786, in test_explanation_api_endpoint
    response = requests.post(
               ^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 587, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 701, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 578, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 16:52:24 [INFO] 
======================================================================
2025-11-10 16:52:24 [INFO] TEST: E2: Explanation Quality Analysis
2025-11-10 16:52:24 [INFO] ======================================================================
2025-11-10 16:52:24 [INFO] [INFO] Setting up test conversation...
2025-11-10 16:52:30 [INFO] [INFO]   Added 5 messages
2025-11-10 16:52:31 [INFO] [INFO] Calling recommendations API...
2025-11-10 16:54:00 [INFO] [PASS] Analyzing 4 book explanations...
2025-11-10 16:54:00 [INFO] [INFO]   Story genre: sci-fi
2025-11-10 16:54:00 [INFO] [INFO]   Story themes: freedom, identity, power
2025-11-10 16:54:00 [INFO] [PASS] High quality explanations
2025-11-10 16:54:00 [INFO] Explanation quality test passed: 90.0%
2025-11-10 16:54:00 [INFO] 
======================================================================
2025-11-10 16:54:00 [INFO] TEST: E3: Summary Comparison via API
2025-11-10 16:54:00 [INFO] ======================================================================
2025-11-10 16:54:00 [INFO] [INFO] Setting up test conversation...
2025-11-10 16:54:06 [INFO] [INFO]   Added 5 messages
2025-11-10 16:54:07 [INFO] [INFO] Calling recommendations API...
2025-11-10 16:55:39 [ERROR] [FAIL] Exception: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 16:55:39 [ERROR] Summary comparison test failed
Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 449, in _make_request
    six.raise_from(e, None)
  File "<string>", line 3, in raise_from
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 444, in _make_request
    httplib_response = conn.getresponse()
                       ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 1374, in getresponse
    response.begin()
  File "C:\Python311\Lib\http\client.py", line 318, in begin
    version, status, reason = self._read_status()
                              ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\http\client.py", line 279, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\socket.py", line 705, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 489, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\util\retry.py", line 550, in increment
    raise six.reraise(type(error), error, _stacktrace)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\packages\six.py", line 770, in reraise
    raise value
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
                       ^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 451, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=read_timeout)
  File "C:\Python311\Lib\site-packages\urllib3\connectionpool.py", line 340, in _raise_timeout
    raise ReadTimeoutError(
urllib3.exceptions.ReadTimeoutError: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\soren\OneDrive\Documents\GitHub\GuidedCreativePlanning\backend\servers\utils\test_REcommendations.py", line 1044, in test_summary_comparison_from_api
    response = requests.post(
               ^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 587, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\sessions.py", line 701, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python311\Lib\site-packages\requests\adapters.py", line 578, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: HTTPConnectionPool(host='localhost', port=5000): Read timed out. (read timeout=90)
2025-11-10 16:55:39 [INFO] 
======================================================================
2025-11-10 16:55:39 [INFO] TEST: E4: Explanation Flag Control
2025-11-10 16:55:39 [INFO] ======================================================================
2025-11-10 16:55:39 [INFO] [INFO] Setting up test conversation...
2025-11-10 16:55:45 [INFO] [INFO]   Added 5 messages
2025-11-10 16:55:46 [INFO] [INFO] Testing with generateExplanations=True...
2025-11-10 16:56:59 [INFO] [INFO] Testing with generateExplanations=False...
2025-11-10 16:57:30 [INFO] [PASS]   WITH flag: 3/3 have explanations
2025-11-10 16:57:30 [INFO] [PASS]   WITHOUT flag: No explanations (as expected)
2025-11-10 16:57:30 [INFO] Explanation flag control test: 2/2 checks passed
2025-11-10 16:57:30 [INFO] ======================================================================
2025-11-10 16:57:30 [INFO] TEST SUMMARY
2025-11-10 16:57:30 [INFO] ======================================================================
2025-11-10 16:57:30 [INFO] 
Section A: Query Effectiveness:
2025-11-10 16:57:30 [INFO] [PASS] A1: Query Generation
2025-11-10 16:57:30 [INFO] [PASS] A2: Book Fetching
2025-11-10 16:57:30 [INFO] 
Section B: API Integration:
2025-11-10 16:57:30 [INFO] [PASS] B1: Server Health
2025-11-10 16:57:30 [INFO] 
Section C: Open Library Integration:
2025-11-10 16:57:30 [INFO] [PASS] C1: OL API Connection
2025-11-10 16:57:30 [INFO] [PASS] C2: OL Enhanced Fetching
2025-11-10 16:57:30 [INFO] [PASS] C3: OL Subject Parsing
2025-11-10 16:57:30 [INFO] [PASS] C4: OL Fallback
2025-11-10 16:57:30 [INFO] 
Section D: Subject Mapping:
2025-11-10 16:57:30 [INFO] [PASS] D1: Mapper Initialization
2025-11-10 16:57:30 [INFO] [PASS] D2: Fallback Mapping
2025-11-10 16:57:30 [INFO] [PASS] D3: Dynamic Mapping
2025-11-10 16:57:30 [INFO] [PASS] D4: Mapping Cache
2025-11-10 16:57:30 [INFO] [PASS] D5: Mapping Metrics
2025-11-10 16:57:30 [INFO] 
Section E: Explanation Generator API:
2025-11-10 16:57:30 [ERROR] [FAIL] E1: Explanation API
2025-11-10 16:57:30 [INFO] [PASS] E2: Quality Analysis
2025-11-10 16:57:30 [ERROR] [FAIL] E3: Summary Comparison
2025-11-10 16:57:30 [INFO] [PASS] E4: Flag Control
2025-11-10 16:57:30 [INFO] 
Overall Results: 14 passed, 2 failed, 0 skipped out of 16 tests
2025-11-10 16:57:30 [WARNING] [FAILURE] 2 tests failed out of 16
2025-11-10 16:57:30 [INFO] ======================================================================
2025-11-10 16:57:30 [INFO] QUICK TIPS
2025-11-10 16:57:30 [INFO] ======================================================================
2025-11-10 16:57:30 [INFO] Section A (Query Effectiveness):
2025-11-10 16:57:30 [INFO]   - Tests core query generation and book fetching logic
2025-11-10 16:57:30 [INFO]   - Requires Google Books API key to be set
2025-11-10 16:57:30 [INFO]   - Can run independently of Flask server
2025-11-10 16:57:30 [INFO] Section B (API Integration):
2025-11-10 16:57:30 [INFO]   - Tests full end-to-end recommendation flow
2025-11-10 16:57:30 [INFO]   - Requires Flask server running: python app.py
2025-11-10 16:57:30 [INFO] Section C (Open Library Integration):
2025-11-10 16:57:30 [INFO]   - Tests Open Library API connection and fetching
2025-11-10 16:57:30 [INFO]   - Tests subject parsing and mapping integration
2025-11-10 16:57:30 [INFO]   - Tests fallback behavior for obscure queries
2025-11-10 16:57:30 [INFO]   - No API key required (public API)
2025-11-10 16:57:30 [INFO] Section D (Subject Mapping):
2025-11-10 16:57:30 [INFO]   - Tests both dynamic (DeepSeek) and fallback mapping
2025-11-10 16:57:30 [INFO]   - Tests caching and performance metrics
2025-11-10 16:57:30 [INFO]   - Dynamic tests require DEEPSEEK_API_KEY
2025-11-10 16:57:30 [INFO]   - Fallback tests work without API key
2025-11-10 16:57:30 [INFO] Section E (Explanation Generator API):
2025-11-10 16:57:30 [INFO]   - Tests explanation generation via API endpoint
2025-11-10 16:57:30 [INFO]   - Tests quality of API-returned explanations
2025-11-10 16:57:30 [INFO]   - Tests summary comparison in API response
2025-11-10 16:57:30 [INFO]   - Tests generateExplanations flag control
2025-11-10 16:57:30 [INFO]   - Requires Flask server running
2025-11-10 16:57:30 [INFO]   - No direct OpenAI calls in tests (handled by server)
2025-11-10 16:57:30 [INFO] Environment Variables:
2025-11-10 16:57:30 [INFO]   - GOOGLE_BOOKS_API_KEY: For Google Books API (optional)
2025-11-10 16:57:30 [INFO]   - DEEPSEEK_API_KEY: For dynamic subject mapping (optional)
2025-11-10 16:57:30 [INFO]   - Without API keys, tests will use fallback methods
2025-11-10 16:57:30 [INFO] For detailed logs:
2025-11-10 16:57:30 [INFO]   - Check logs/recommendation_tests.log
2025-11-10 16:57:30 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-10 16:57:30 [INFO] Common issues:
2025-11-10 16:57:30 [INFO]   - API key not set -> Some tests will be skipped
2025-11-10 16:57:30 [INFO]   - Server not running -> Section B tests will fail
2025-11-10 16:57:30 [INFO]   - Network timeout -> Increase timeout in test config
2025-11-10 16:57:30 [INFO] ======================================================================
2025-11-10 16:57:30 [INFO] TEST SUITE COMPLETE
2025-11-10 16:57:30 [INFO] ======================================================================
2025-11-10 17:02:48 [INFO] ======================================================================
2025-11-10 17:02:48 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-10 17:02:48 [INFO] ======================================================================
2025-11-10 17:02:48 [INFO] 
----------------------------------------------------------------------
2025-11-10 17:02:48 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-10 17:02:48 [INFO] ----------------------------------------------------------------------
2025-11-10 17:02:48 [INFO] 
======================================================================
2025-11-10 17:02:48 [INFO] TEST: A1: Query Generation
2025-11-10 17:02:48 [INFO] ======================================================================
2025-11-10 17:02:48 [INFO] Testing query generation for: Fantasy with Magic
2025-11-10 17:02:48 [INFO] [INFO]   Generated 1 queries:
2025-11-10 17:02:48 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-10 17:02:48 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-10 17:02:48 [INFO] [INFO]   Generated 1 queries:
2025-11-10 17:02:48 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-10 17:02:48 [INFO] Query Generation Test: 2/2 passed
2025-11-10 17:02:48 [INFO] 
======================================================================
2025-11-10 17:02:48 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-10 17:02:48 [INFO] ======================================================================
2025-11-10 17:02:48 [INFO] [INFO]   Fetching books...
2025-11-10 17:02:49 [INFO] [PASS]   Fetched 5 books
2025-11-10 17:02:49 [INFO] [INFO]   Fetching books...
2025-11-10 17:02:51 [INFO] [PASS]   Fetched 5 books
2025-11-10 17:02:51 [INFO] 
----------------------------------------------------------------------
2025-11-10 17:02:51 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-10 17:02:51 [INFO] ----------------------------------------------------------------------
2025-11-10 17:02:51 [INFO] 
======================================================================
2025-11-10 17:02:51 [INFO] TEST: B1: Flask Server Health Check
2025-11-10 17:02:51 [INFO] ======================================================================
2025-11-10 17:02:53 [INFO] [PASS] Server status: ok
2025-11-10 17:02:53 [INFO] 
----------------------------------------------------------------------
2025-11-10 17:02:53 [INFO] SECTION: C: OPEN LIBRARY INTEGRATION TESTS
2025-11-10 17:02:53 [INFO] ----------------------------------------------------------------------
2025-11-10 17:02:53 [INFO] 
======================================================================
2025-11-10 17:02:53 [INFO] TEST: C1: Open Library API Connection
2025-11-10 17:02:53 [INFO] ======================================================================
2025-11-10 17:02:53 [INFO] [INFO] Calling Open Library API...
2025-11-10 17:02:54 [INFO] [PASS] Returned 3 books
2025-11-10 17:02:54 [INFO] Open Library API test passed
2025-11-10 17:02:54 [INFO] 
======================================================================
2025-11-10 17:02:54 [INFO] TEST: C2: Enhanced Open Library Fetching
2025-11-10 17:02:54 [INFO] ======================================================================
2025-11-10 17:02:54 [INFO] [INFO]   Query: 'fantasy young adult magic'
2025-11-10 17:03:32 [INFO] [PASS]   Fetched 10 books
2025-11-10 17:03:32 [INFO] [INFO]   Books with mapped categories: 10/10
2025-11-10 17:03:32 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-10 17:03:32 [INFO] [INFO]   Query: 'dystopian rebellion'
2025-11-10 17:04:02 [INFO] [PASS]   Fetched 10 books
2025-11-10 17:04:02 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-10 17:04:02 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-10 17:04:02 [INFO] [INFO]   Query: 'contemporary realistic fiction'
2025-11-10 17:04:32 [INFO] [PASS]   Fetched 10 books
2025-11-10 17:04:32 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-10 17:04:32 [INFO] [PASS]   Met minimum results (10 >= 2)
2025-11-10 17:04:32 [INFO] Open Library Enhanced Test: 3/3 passed
2025-11-10 17:04:32 [INFO] 
======================================================================
2025-11-10 17:04:32 [INFO] TEST: C3: Open Library Subject Parsing
2025-11-10 17:04:32 [INFO] ======================================================================
2025-11-10 17:04:33 [INFO] [INFO] Analyzing 5 books for subject parsing...
2025-11-10 17:04:33 [INFO] [PASS]   4/5 books have subjects
2025-11-10 17:04:33 [INFO] [INFO]   Average subjects per book: 47.8
2025-11-10 17:04:33 [INFO] [INFO] 
  Sample subjects from 'The Magic Finger':
2025-11-10 17:04:33 [INFO] Open Library subject parsing test passed
2025-11-10 17:04:33 [INFO] 
======================================================================
2025-11-10 17:04:33 [INFO] TEST: C4: Open Library Fallback
2025-11-10 17:04:33 [INFO] ======================================================================
2025-11-10 17:04:33 [INFO] [INFO] Testing with intentionally obscure query...
2025-11-10 17:04:34 [WARNING] [WARN]   Even fallback returned no books (acceptable)
2025-11-10 17:04:34 [INFO] 
----------------------------------------------------------------------
2025-11-10 17:04:34 [INFO] SECTION: D: SUBJECT MAPPING TESTS
2025-11-10 17:04:34 [INFO] ----------------------------------------------------------------------
2025-11-10 17:04:34 [INFO] 
======================================================================
2025-11-10 17:04:34 [INFO] TEST: D1: Subject Mapper Initialization
2025-11-10 17:04:34 [INFO] ======================================================================
2025-11-10 17:04:34 [INFO] [INFO] Dynamic mapping: ENABLED
2025-11-10 17:04:34 [INFO] [INFO] Fallback mappings: 15 categories
2025-11-10 17:04:34 [INFO] [INFO] Cache capacity: 500
2025-11-10 17:04:34 [INFO] [PASS]   DeepSeek client initialized
2025-11-10 17:04:34 [INFO] [PASS]   Fallback category 'fantasy' loaded
2025-11-10 17:04:34 [INFO] [PASS]   Fallback category 'sci-fi' loaded
2025-11-10 17:04:34 [INFO] [PASS]   Fallback category 'mystery' loaded
2025-11-10 17:04:34 [INFO] [PASS]   Fallback category 'horror' loaded
2025-11-10 17:04:34 [INFO] [PASS]   Fallback category 'romance' loaded
2025-11-10 17:04:34 [INFO] Subject mapper initialization test passed
2025-11-10 17:04:34 [INFO] 
======================================================================
2025-11-10 17:04:34 [INFO] TEST: D2: Fallback Subject Mapping
2025-11-10 17:04:34 [INFO] ======================================================================
2025-11-10 17:04:34 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-10 17:04:34 [INFO] [INFO]   Mapped to: Coming Of Age, Fantasy
2025-11-10 17:04:34 [INFO] [INFO]   Relevance: 1.00
2025-11-10 17:04:34 [INFO] [INFO]   Method: fallback
2025-11-10 17:04:34 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 17:04:34 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-10 17:04:34 [INFO] [INFO]   Mapped to: Rebellion, Sci Fi, Coming Of Age
2025-11-10 17:04:34 [INFO] [INFO]   Relevance: 0.80
2025-11-10 17:04:34 [INFO] [INFO]   Method: fallback
2025-11-10 17:04:34 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 17:04:34 [INFO] [INFO]   Subjects: Mystery, Detective, Crime...
2025-11-10 17:04:34 [INFO] [INFO]   Mapped to: Mystery
2025-11-10 17:04:34 [INFO] [INFO]   Relevance: 1.00
2025-11-10 17:04:34 [INFO] [INFO]   Method: fallback
2025-11-10 17:04:34 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 17:04:34 [INFO] [INFO]   Subjects: Obscure Topic A, Rare Subject B, Unknown Category C...
2025-11-10 17:04:34 [INFO] [INFO]   Mapped to: Unknown Category C, Rare Subject B, Obscure Topic A
2025-11-10 17:04:34 [INFO] [INFO]   Relevance: 0.00
2025-11-10 17:04:34 [INFO] [INFO]   Method: fallback
2025-11-10 17:04:34 [INFO] [PASS]   Used fallback mapping as expected
2025-11-10 17:04:34 [INFO] Fallback Mapping Test: 4/4 passed
2025-11-10 17:04:34 [INFO] 
======================================================================
2025-11-10 17:04:34 [INFO] TEST: D3: Dynamic Subject Mapping with DeepSeek
2025-11-10 17:04:34 [INFO] ======================================================================
2025-11-10 17:04:34 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-10 17:04:34 [INFO] [INFO]   Context: 'fantasy young adult magic'
2025-11-10 17:04:37 [INFO] [INFO]   Mapped to: Fantasy, Magic, Coming-of-Age
2025-11-10 17:04:37 [INFO] [INFO]   Relevance: 0.95
2025-11-10 17:04:37 [INFO] [INFO]   Method: dynamic
2025-11-10 17:04:37 [INFO] [PASS]   Used dynamic mapping
2025-11-10 17:04:37 [INFO] [PASS]   Relevance meets minimum (0.95 >= 0.6)
2025-11-10 17:04:37 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-10 17:04:37 [INFO] [INFO]   Context: 'dystopian rebellion'
2025-11-10 17:04:40 [INFO] [INFO]   Mapped to: Dystopian, Rebellion, Sci-Fi
2025-11-10 17:04:40 [INFO] [INFO]   Relevance: 0.90
2025-11-10 17:04:40 [INFO] [INFO]   Method: dynamic
2025-11-10 17:04:40 [INFO] [PASS]   Used dynamic mapping
2025-11-10 17:04:40 [INFO] [PASS]   Relevance meets minimum (0.90 >= 0.6)
2025-11-10 17:04:40 [INFO] Dynamic Mapping Test: 2/2 passed
2025-11-10 17:04:40 [INFO] 
======================================================================
2025-11-10 17:04:40 [INFO] TEST: D4: Subject Mapping Cache
2025-11-10 17:04:40 [INFO] ======================================================================
2025-11-10 17:04:40 [INFO] [INFO] Testing cache behavior...
2025-11-10 17:04:43 [INFO] [INFO]   First call: dynamic (3574.3ms)
2025-11-10 17:04:43 [INFO] [INFO]   Second call: cached (0.0ms)
2025-11-10 17:04:43 [INFO] [PASS]   Cache working correctly
2025-11-10 17:04:43 [INFO] [PASS]   Cache faster (0.0ms vs 3574.3ms)
2025-11-10 17:04:43 [INFO] [PASS]   Cache returns identical results
2025-11-10 17:04:43 [INFO] 
======================================================================
2025-11-10 17:04:43 [INFO] TEST: D5: Subject Mapping Metrics
2025-11-10 17:04:43 [INFO] ======================================================================
2025-11-10 17:04:53 [INFO] [INFO] Metrics collected:
2025-11-10 17:04:53 [INFO] [PASS]   Metric 'total_calls' present
2025-11-10 17:04:53 [INFO] [PASS]   Metric 'cache_hit_rate' present
2025-11-10 17:04:53 [INFO] [PASS]   Metric 'dynamic_success_rate' present
2025-11-10 17:04:53 [INFO] [PASS]   Metric 'fallback_rate' present
2025-11-10 17:04:53 [INFO] Mapping metrics test passed
2025-11-10 17:04:53 [INFO] 
----------------------------------------------------------------------
2025-11-10 17:04:53 [INFO] SECTION: E: EXPLANATION GENERATOR TESTS
2025-11-10 17:04:53 [INFO] ----------------------------------------------------------------------
2025-11-10 17:04:53 [INFO] 
----------------------------------------------------------------------
2025-11-10 17:04:53 [INFO] SECTION: E: EXPLANATION GENERATOR API TESTS
2025-11-10 17:04:53 [INFO] ----------------------------------------------------------------------
2025-11-10 17:04:53 [INFO] 
======================================================================
2025-11-10 17:04:53 [INFO] TEST: E1: Explanation Generation via API
2025-11-10 17:04:53 [INFO] ======================================================================
2025-11-10 17:04:53 [INFO] [INFO] Setting up test conversation...
2025-11-10 17:04:54 [INFO] [INFO]   Session ID: -Odh-hWqE6SokdZJGyM4...
2025-11-10 17:04:59 [INFO] [INFO]   Added 5 messages
2025-11-10 17:05:00 [INFO] [INFO] Calling /api/book-recommendations endpoint...
2025-11-10 17:06:09 [INFO] [INFO]   API response time: 68.98s
2025-11-10 17:06:09 [INFO] [PASS]   Returned 5 book recommendations
2025-11-10 17:06:09 [INFO] [PASS]   All 5 books have explanations
2025-11-10 17:06:09 [INFO] [INFO]   Books with highlights: 5/5
2025-11-10 17:06:09 [INFO] [INFO]   Books with comparison notes: 5/5
2025-11-10 17:06:09 [INFO] [PASS]   At least half have match highlights
2025-11-10 17:06:09 [INFO] [PASS]   Has summary comparison
2025-11-10 17:06:09 [INFO] [PASS]   Has 3 exploration tips
2025-11-10 17:06:09 [INFO] Explanation API test: 5/5 checks passed
2025-11-10 17:06:09 [INFO] 
======================================================================
2025-11-10 17:06:09 [INFO] TEST: E2: Explanation Quality Analysis
2025-11-10 17:06:09 [INFO] ======================================================================
2025-11-10 17:06:09 [INFO] [INFO] Setting up test conversation...
2025-11-10 17:06:14 [INFO] [INFO]   Added 5 messages
2025-11-10 17:06:15 [INFO] [INFO] Calling recommendations API...
2025-11-10 17:07:16 [INFO] [PASS] Analyzing 4 book explanations...
2025-11-10 17:07:16 [INFO] [INFO]   Story genre: sci-fi
2025-11-10 17:07:16 [INFO] [INFO]   Story themes: freedom, identity, power
2025-11-10 17:07:16 [INFO] [PASS] High quality explanations
2025-11-10 17:07:16 [INFO] Explanation quality test passed: 90.0%
2025-11-10 17:07:16 [INFO] 
======================================================================
2025-11-10 17:07:16 [INFO] TEST: E3: Summary Comparison via API
2025-11-10 17:07:16 [INFO] ======================================================================
2025-11-10 17:07:16 [INFO] [INFO] Setting up test conversation...
2025-11-10 17:07:21 [INFO] [INFO]   Added 5 messages
2025-11-10 17:07:22 [INFO] [INFO] Calling recommendations API...
2025-11-10 17:08:30 [INFO] [PASS]   Has summary field
2025-11-10 17:08:30 [INFO] [PASS]   Summary is substantial (>50 chars)
2025-11-10 17:08:30 [INFO] [PASS]   Has 3 exploration tips
2025-11-10 17:08:30 [INFO] [PASS]   Sufficient tips (>=2)
2025-11-10 17:08:30 [INFO] Summary comparison test: 3/3 checks passed
2025-11-10 17:08:30 [INFO] 
======================================================================
2025-11-10 17:08:30 [INFO] TEST: E4: Explanation Flag Control
2025-11-10 17:08:30 [INFO] ======================================================================
2025-11-10 17:08:30 [INFO] [INFO] Setting up test conversation...
2025-11-10 17:08:36 [INFO] [INFO]   Added 5 messages
2025-11-10 17:08:37 [INFO] [INFO] Testing with generateExplanations=True...
2025-11-10 17:09:35 [INFO] [INFO] Testing with generateExplanations=False...
2025-11-10 17:10:04 [INFO] [PASS]   WITH flag: 3/3 have explanations
2025-11-10 17:10:04 [INFO] [PASS]   WITHOUT flag: No explanations (as expected)
2025-11-10 17:10:04 [INFO] Explanation flag control test: 2/2 checks passed
2025-11-10 17:10:04 [INFO] ======================================================================
2025-11-10 17:10:04 [INFO] TEST SUMMARY
2025-11-10 17:10:04 [INFO] ======================================================================
2025-11-10 17:10:04 [INFO] 
Section A: Query Effectiveness:
2025-11-10 17:10:04 [INFO] [PASS] A1: Query Generation
2025-11-10 17:10:04 [INFO] [PASS] A2: Book Fetching
2025-11-10 17:10:04 [INFO] 
Section B: API Integration:
2025-11-10 17:10:04 [INFO] [PASS] B1: Server Health
2025-11-10 17:10:04 [INFO] 
Section C: Open Library Integration:
2025-11-10 17:10:04 [INFO] [PASS] C1: OL API Connection
2025-11-10 17:10:04 [INFO] [PASS] C2: OL Enhanced Fetching
2025-11-10 17:10:04 [INFO] [PASS] C3: OL Subject Parsing
2025-11-10 17:10:04 [INFO] [PASS] C4: OL Fallback
2025-11-10 17:10:04 [INFO] 
Section D: Subject Mapping:
2025-11-10 17:10:04 [INFO] [PASS] D1: Mapper Initialization
2025-11-10 17:10:04 [INFO] [PASS] D2: Fallback Mapping
2025-11-10 17:10:04 [INFO] [PASS] D3: Dynamic Mapping
2025-11-10 17:10:04 [INFO] [PASS] D4: Mapping Cache
2025-11-10 17:10:04 [INFO] [PASS] D5: Mapping Metrics
2025-11-10 17:10:04 [INFO] 
Section E: Explanation Generator API:
2025-11-10 17:10:04 [INFO] [PASS] E1: Explanation API
2025-11-10 17:10:04 [INFO] [PASS] E2: Quality Analysis
2025-11-10 17:10:04 [INFO] [PASS] E3: Summary Comparison
2025-11-10 17:10:04 [INFO] [PASS] E4: Flag Control
2025-11-10 17:10:04 [INFO] 
Overall Results: 16 passed, 0 failed, 0 skipped out of 16 tests
2025-11-10 17:10:04 [INFO] [SUCCESS] All tests passed (16/16)
2025-11-10 17:10:04 [INFO] ======================================================================
2025-11-10 17:10:04 [INFO] QUICK TIPS
2025-11-10 17:10:04 [INFO] ======================================================================
2025-11-10 17:10:04 [INFO] Section A (Query Effectiveness):
2025-11-10 17:10:04 [INFO]   - Tests core query generation and book fetching logic
2025-11-10 17:10:04 [INFO]   - Requires Google Books API key to be set
2025-11-10 17:10:04 [INFO]   - Can run independently of Flask server
2025-11-10 17:10:04 [INFO] Section B (API Integration):
2025-11-10 17:10:04 [INFO]   - Tests full end-to-end recommendation flow
2025-11-10 17:10:04 [INFO]   - Requires Flask server running: python app.py
2025-11-10 17:10:04 [INFO] Section C (Open Library Integration):
2025-11-10 17:10:04 [INFO]   - Tests Open Library API connection and fetching
2025-11-10 17:10:04 [INFO]   - Tests subject parsing and mapping integration
2025-11-10 17:10:04 [INFO]   - Tests fallback behavior for obscure queries
2025-11-10 17:10:04 [INFO]   - No API key required (public API)
2025-11-10 17:10:04 [INFO] Section D (Subject Mapping):
2025-11-10 17:10:04 [INFO]   - Tests both dynamic (DeepSeek) and fallback mapping
2025-11-10 17:10:04 [INFO]   - Tests caching and performance metrics
2025-11-10 17:10:04 [INFO]   - Dynamic tests require DEEPSEEK_API_KEY
2025-11-10 17:10:04 [INFO]   - Fallback tests work without API key
2025-11-10 17:10:04 [INFO] Section E (Explanation Generator API):
2025-11-10 17:10:04 [INFO]   - Tests explanation generation via API endpoint
2025-11-10 17:10:04 [INFO]   - Tests quality of API-returned explanations
2025-11-10 17:10:04 [INFO]   - Tests summary comparison in API response
2025-11-10 17:10:04 [INFO]   - Tests generateExplanations flag control
2025-11-10 17:10:04 [INFO]   - Requires Flask server running
2025-11-10 17:10:04 [INFO]   - No direct OpenAI calls in tests (handled by server)
2025-11-10 17:10:04 [INFO] Environment Variables:
2025-11-10 17:10:04 [INFO]   - GOOGLE_BOOKS_API_KEY: For Google Books API (optional)
2025-11-10 17:10:04 [INFO]   - DEEPSEEK_API_KEY: For dynamic subject mapping (optional)
2025-11-10 17:10:04 [INFO]   - Without API keys, tests will use fallback methods
2025-11-10 17:10:04 [INFO] For detailed logs:
2025-11-10 17:10:04 [INFO]   - Check logs/recommendation_tests.log
2025-11-10 17:10:04 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-10 17:10:04 [INFO] Common issues:
2025-11-10 17:10:04 [INFO]   - API key not set -> Some tests will be skipped
2025-11-10 17:10:04 [INFO]   - Server not running -> Section B tests will fail
2025-11-10 17:10:04 [INFO]   - Network timeout -> Increase timeout in test config
2025-11-10 17:10:04 [INFO] ======================================================================
2025-11-10 17:10:04 [INFO] TEST SUITE COMPLETE
2025-11-10 17:10:04 [INFO] ======================================================================
2025-11-11 11:33:34 [INFO] ======================================================================
2025-11-11 11:33:34 [INFO] STARTING COMPREHENSIVE TEST SUITE
2025-11-11 11:33:34 [INFO] ======================================================================
2025-11-11 11:33:34 [INFO] 
----------------------------------------------------------------------
2025-11-11 11:33:34 [INFO] SECTION: A: QUERY EFFECTIVENESS TESTS
2025-11-11 11:33:34 [INFO] ----------------------------------------------------------------------
2025-11-11 11:33:34 [INFO] 
======================================================================
2025-11-11 11:33:34 [INFO] TEST: A1: Query Generation
2025-11-11 11:33:34 [INFO] ======================================================================
2025-11-11 11:33:34 [INFO] Testing query generation for: Fantasy with Magic
2025-11-11 11:33:34 [INFO] [INFO]   Generated 1 queries:
2025-11-11 11:33:34 [INFO] [PASS]   Queries include genre 'fantasy'
2025-11-11 11:33:34 [INFO] Testing query generation for: Dystopian with Rebellion
2025-11-11 11:33:34 [INFO] [INFO]   Generated 1 queries:
2025-11-11 11:33:34 [INFO] [PASS]   Queries include genre 'dystopian'
2025-11-11 11:33:34 [INFO] Query Generation Test: 2/2 passed
2025-11-11 11:33:34 [INFO] 
======================================================================
2025-11-11 11:33:34 [INFO] TEST: A2: Book Fetching with Generated Queries
2025-11-11 11:33:34 [INFO] ======================================================================
2025-11-11 11:33:34 [INFO] [INFO]   Fetching books...
2025-11-11 11:33:35 [INFO] [PASS]   Fetched 5 books
2025-11-11 11:33:35 [INFO] [INFO]   Fetching books...
2025-11-11 11:33:36 [INFO] [PASS]   Fetched 5 books
2025-11-11 11:33:37 [INFO] 
----------------------------------------------------------------------
2025-11-11 11:33:37 [INFO] SECTION: B: API INTEGRATION TESTS
2025-11-11 11:33:37 [INFO] ----------------------------------------------------------------------
2025-11-11 11:33:37 [INFO] 
======================================================================
2025-11-11 11:33:37 [INFO] TEST: B1: Flask Server Health Check
2025-11-11 11:33:37 [INFO] ======================================================================
2025-11-11 11:33:40 [INFO] [PASS] Server status: ok
2025-11-11 11:33:40 [INFO] 
----------------------------------------------------------------------
2025-11-11 11:33:40 [INFO] SECTION: C: OPEN LIBRARY INTEGRATION TESTS
2025-11-11 11:33:40 [INFO] ----------------------------------------------------------------------
2025-11-11 11:33:40 [INFO] 
======================================================================
2025-11-11 11:33:40 [INFO] TEST: C1: Open Library API Connection
2025-11-11 11:33:40 [INFO] ======================================================================
2025-11-11 11:33:40 [INFO] [INFO] Calling Open Library API...
2025-11-11 11:33:41 [INFO] [PASS] Returned 3 books
2025-11-11 11:33:41 [INFO] Open Library API test passed
2025-11-11 11:33:41 [INFO] 
======================================================================
2025-11-11 11:33:41 [INFO] TEST: C2: Enhanced Open Library Fetching
2025-11-11 11:33:41 [INFO] ======================================================================
2025-11-11 11:33:41 [INFO] [INFO]   Query: 'fantasy young adult magic'
2025-11-11 11:34:11 [INFO] [PASS]   Fetched 10 books
2025-11-11 11:34:11 [INFO] [INFO]   Books with mapped categories: 10/10
2025-11-11 11:34:11 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-11 11:34:11 [INFO] [INFO]   Query: 'dystopian rebellion'
2025-11-11 11:34:35 [INFO] [PASS]   Fetched 10 books
2025-11-11 11:34:35 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-11 11:34:35 [INFO] [PASS]   Met minimum results (10 >= 3)
2025-11-11 11:34:35 [INFO] [INFO]   Query: 'contemporary realistic fiction'
2025-11-11 11:35:02 [INFO] [PASS]   Fetched 10 books
2025-11-11 11:35:02 [INFO] [INFO]   Books with mapped categories: 8/10
2025-11-11 11:35:02 [INFO] [PASS]   Met minimum results (10 >= 2)
2025-11-11 11:35:02 [INFO] Open Library Enhanced Test: 3/3 passed
2025-11-11 11:35:02 [INFO] 
======================================================================
2025-11-11 11:35:02 [INFO] TEST: C3: Open Library Subject Parsing
2025-11-11 11:35:02 [INFO] ======================================================================
2025-11-11 11:35:03 [INFO] [INFO] Analyzing 5 books for subject parsing...
2025-11-11 11:35:03 [INFO] [PASS]   4/5 books have subjects
2025-11-11 11:35:03 [INFO] [INFO]   Average subjects per book: 47.8
2025-11-11 11:35:03 [INFO] [INFO] 
  Sample subjects from 'The Magic Finger':
2025-11-11 11:35:03 [INFO] Open Library subject parsing test passed
2025-11-11 11:35:03 [INFO] 
======================================================================
2025-11-11 11:35:03 [INFO] TEST: C4: Open Library Fallback
2025-11-11 11:35:03 [INFO] ======================================================================
2025-11-11 11:35:03 [INFO] [INFO] Testing with intentionally obscure query...
2025-11-11 11:35:04 [WARNING] [WARN]   Even fallback returned no books (acceptable)
2025-11-11 11:35:04 [INFO] 
----------------------------------------------------------------------
2025-11-11 11:35:04 [INFO] SECTION: D: SUBJECT MAPPING TESTS
2025-11-11 11:35:04 [INFO] ----------------------------------------------------------------------
2025-11-11 11:35:04 [INFO] 
======================================================================
2025-11-11 11:35:04 [INFO] TEST: D1: Subject Mapper Initialization
2025-11-11 11:35:04 [INFO] ======================================================================
2025-11-11 11:35:04 [INFO] [INFO] Dynamic mapping: ENABLED
2025-11-11 11:35:04 [INFO] [INFO] Fallback mappings: 15 categories
2025-11-11 11:35:04 [INFO] [INFO] Cache capacity: 500
2025-11-11 11:35:04 [INFO] [PASS]   DeepSeek client initialized
2025-11-11 11:35:04 [INFO] [PASS]   Fallback category 'fantasy' loaded
2025-11-11 11:35:04 [INFO] [PASS]   Fallback category 'sci-fi' loaded
2025-11-11 11:35:04 [INFO] [PASS]   Fallback category 'mystery' loaded
2025-11-11 11:35:04 [INFO] [PASS]   Fallback category 'horror' loaded
2025-11-11 11:35:04 [INFO] [PASS]   Fallback category 'romance' loaded
2025-11-11 11:35:04 [INFO] Subject mapper initialization test passed
2025-11-11 11:35:04 [INFO] 
======================================================================
2025-11-11 11:35:04 [INFO] TEST: D2: Fallback Subject Mapping
2025-11-11 11:35:04 [INFO] ======================================================================
2025-11-11 11:35:04 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-11 11:35:04 [INFO] [INFO]   Mapped to: Coming Of Age, Fantasy
2025-11-11 11:35:04 [INFO] [INFO]   Relevance: 1.00
2025-11-11 11:35:04 [INFO] [INFO]   Method: fallback
2025-11-11 11:35:04 [INFO] [PASS]   Used fallback mapping as expected
2025-11-11 11:35:04 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-11 11:35:04 [INFO] [INFO]   Mapped to: Sci Fi, Coming Of Age, Rebellion
2025-11-11 11:35:04 [INFO] [INFO]   Relevance: 0.80
2025-11-11 11:35:04 [INFO] [INFO]   Method: fallback
2025-11-11 11:35:04 [INFO] [PASS]   Used fallback mapping as expected
2025-11-11 11:35:04 [INFO] [INFO]   Subjects: Mystery, Detective, Crime...
2025-11-11 11:35:04 [INFO] [INFO]   Mapped to: Mystery
2025-11-11 11:35:04 [INFO] [INFO]   Relevance: 1.00
2025-11-11 11:35:04 [INFO] [INFO]   Method: fallback
2025-11-11 11:35:04 [INFO] [PASS]   Used fallback mapping as expected
2025-11-11 11:35:04 [INFO] [INFO]   Subjects: Obscure Topic A, Rare Subject B, Unknown Category C...
2025-11-11 11:35:04 [INFO] [INFO]   Mapped to: Unknown Category C, Rare Subject B, Obscure Topic A
2025-11-11 11:35:04 [INFO] [INFO]   Relevance: 0.00
2025-11-11 11:35:04 [INFO] [INFO]   Method: fallback
2025-11-11 11:35:04 [INFO] [PASS]   Used fallback mapping as expected
2025-11-11 11:35:04 [INFO] Fallback Mapping Test: 4/4 passed
2025-11-11 11:35:04 [INFO] 
======================================================================
2025-11-11 11:35:04 [INFO] TEST: D3: Dynamic Subject Mapping with DeepSeek
2025-11-11 11:35:04 [INFO] ======================================================================
2025-11-11 11:35:04 [INFO] [INFO]   Subjects: Fantasy, Magic, Young Adult...
2025-11-11 11:35:04 [INFO] [INFO]   Context: 'fantasy young adult magic'
2025-11-11 11:35:07 [INFO] [INFO]   Mapped to: Fantasy, Magic, Coming-of-Age
2025-11-11 11:35:07 [INFO] [INFO]   Relevance: 0.95
2025-11-11 11:35:07 [INFO] [INFO]   Method: dynamic
2025-11-11 11:35:07 [INFO] [PASS]   Used dynamic mapping
2025-11-11 11:35:07 [INFO] [PASS]   Relevance meets minimum (0.95 >= 0.6)
2025-11-11 11:35:07 [INFO] [INFO]   Subjects: Science Fiction, Dystopia, Rebellion...
2025-11-11 11:35:07 [INFO] [INFO]   Context: 'dystopian rebellion'
2025-11-11 11:35:10 [INFO] [INFO]   Mapped to: Dystopian, Rebellion, Sci-Fi, Power
2025-11-11 11:35:10 [INFO] [INFO]   Relevance: 0.90
2025-11-11 11:35:10 [INFO] [INFO]   Method: dynamic
2025-11-11 11:35:10 [INFO] [PASS]   Used dynamic mapping
2025-11-11 11:35:10 [INFO] [PASS]   Relevance meets minimum (0.90 >= 0.6)
2025-11-11 11:35:10 [INFO] Dynamic Mapping Test: 2/2 passed
2025-11-11 11:35:10 [INFO] 
======================================================================
2025-11-11 11:35:10 [INFO] TEST: D4: Subject Mapping Cache
2025-11-11 11:35:10 [INFO] ======================================================================
2025-11-11 11:35:10 [INFO] [INFO] Testing cache behavior...
2025-11-11 11:35:13 [INFO] [INFO]   First call: dynamic (2738.2ms)
2025-11-11 11:35:13 [INFO] [INFO]   Second call: cached (0.0ms)
2025-11-11 11:35:13 [INFO] [PASS]   Cache working correctly
2025-11-11 11:35:13 [INFO] [PASS]   Cache faster (0.0ms vs 2738.2ms)
2025-11-11 11:35:13 [INFO] [PASS]   Cache returns identical results
2025-11-11 11:35:13 [INFO] 
======================================================================
2025-11-11 11:35:13 [INFO] TEST: D5: Subject Mapping Metrics
2025-11-11 11:35:13 [INFO] ======================================================================
2025-11-11 11:35:23 [INFO] [INFO] Metrics collected:
2025-11-11 11:35:23 [INFO] [PASS]   Metric 'total_calls' present
2025-11-11 11:35:23 [INFO] [PASS]   Metric 'cache_hit_rate' present
2025-11-11 11:35:23 [INFO] [PASS]   Metric 'dynamic_success_rate' present
2025-11-11 11:35:23 [INFO] [PASS]   Metric 'fallback_rate' present
2025-11-11 11:35:23 [INFO] Mapping metrics test passed
2025-11-11 11:35:23 [INFO] 
----------------------------------------------------------------------
2025-11-11 11:35:23 [INFO] SECTION: E: EXPLANATION GENERATOR TESTS
2025-11-11 11:35:23 [INFO] ----------------------------------------------------------------------
2025-11-11 11:35:23 [INFO] 
----------------------------------------------------------------------
2025-11-11 11:35:23 [INFO] SECTION: E: EXPLANATION GENERATOR API TESTS
2025-11-11 11:35:23 [INFO] ----------------------------------------------------------------------
2025-11-11 11:35:23 [INFO] 
======================================================================
2025-11-11 11:35:23 [INFO] TEST: E1: Explanation Generation via API
2025-11-11 11:35:23 [INFO] ======================================================================
2025-11-11 11:35:23 [INFO] [INFO] Setting up test conversation...
2025-11-11 11:35:24 [INFO] [INFO]   Session ID: -OdkysDLg0Ohw67556cR...
2025-11-11 11:35:28 [INFO] [INFO]   Added 5 messages
2025-11-11 11:35:29 [INFO] [INFO] Calling /api/book-recommendations endpoint...
2025-11-11 11:37:14 [INFO] [INFO]   API response time: 105.34s
2025-11-11 11:37:14 [INFO] [PASS]   Returned 5 book recommendations
2025-11-11 11:37:14 [INFO] [PASS]   All 5 books have explanations
2025-11-11 11:37:14 [INFO] [INFO]   Books with highlights: 5/5
2025-11-11 11:37:14 [INFO] [INFO]   Books with comparison notes: 5/5
2025-11-11 11:37:14 [INFO] [PASS]   At least half have match highlights
2025-11-11 11:37:14 [INFO] [PASS]   Has summary comparison
2025-11-11 11:37:14 [INFO] [PASS]   Has 3 exploration tips
2025-11-11 11:37:14 [INFO] Explanation API test: 5/5 checks passed
2025-11-11 11:37:14 [INFO] 
======================================================================
2025-11-11 11:37:14 [INFO] TEST: E2: Explanation Quality Analysis
2025-11-11 11:37:14 [INFO] ======================================================================
2025-11-11 11:37:14 [INFO] [INFO] Setting up test conversation...
2025-11-11 11:37:19 [INFO] [INFO]   Added 5 messages
2025-11-11 11:37:20 [INFO] [INFO] Calling recommendations API...
2025-11-11 11:38:41 [INFO] [PASS] Analyzing 4 book explanations...
2025-11-11 11:38:41 [INFO] [INFO]   Story genre: sci-fi
2025-11-11 11:38:41 [INFO] [INFO]   Story themes: freedom, identity, power
2025-11-11 11:38:41 [INFO] [PASS] High quality explanations
2025-11-11 11:38:41 [INFO] Explanation quality test passed: 95.0%
2025-11-11 11:38:41 [INFO] 
======================================================================
2025-11-11 11:38:41 [INFO] TEST: E3: Summary Comparison via API
2025-11-11 11:38:41 [INFO] ======================================================================
2025-11-11 11:38:41 [INFO] [INFO] Setting up test conversation...
2025-11-11 11:38:46 [INFO] [INFO]   Added 5 messages
2025-11-11 11:38:47 [INFO] [INFO] Calling recommendations API...
2025-11-11 11:40:25 [INFO] [PASS]   Has summary field
2025-11-11 11:40:25 [INFO] [PASS]   Summary is substantial (>50 chars)
2025-11-11 11:40:25 [INFO] [PASS]   Has 3 exploration tips
2025-11-11 11:40:25 [INFO] [PASS]   Sufficient tips (>=2)
2025-11-11 11:40:25 [INFO] Summary comparison test: 3/3 checks passed
2025-11-11 11:40:25 [INFO] 
======================================================================
2025-11-11 11:40:25 [INFO] TEST: E4: Explanation Flag Control
2025-11-11 11:40:25 [INFO] ======================================================================
2025-11-11 11:40:25 [INFO] [INFO] Setting up test conversation...
2025-11-11 11:40:31 [INFO] [INFO]   Added 5 messages
2025-11-11 11:40:32 [INFO] [INFO] Testing with generateExplanations=True...
2025-11-11 11:41:43 [INFO] [INFO] Testing with generateExplanations=False...
2025-11-11 11:42:12 [INFO] [PASS]   WITH flag: 3/3 have explanations
2025-11-11 11:42:12 [INFO] [PASS]   WITHOUT flag: No explanations (as expected)
2025-11-11 11:42:12 [INFO] Explanation flag control test: 2/2 checks passed
2025-11-11 11:42:12 [INFO] 
----------------------------------------------------------------------
2025-11-11 11:42:12 [INFO] SECTION: F: EDGE CASE TESTS VIA API
2025-11-11 11:42:12 [INFO] ----------------------------------------------------------------------
2025-11-11 11:42:12 [INFO] 
======================================================================
2025-11-11 11:42:12 [INFO] TEST: F1: Sparse Conversation via API
2025-11-11 11:42:12 [INFO] ======================================================================
2025-11-11 11:42:12 [INFO] [INFO] Setting up sparse conversation...
2025-11-11 11:42:15 [INFO] [INFO]   Added 3 sparse messages
2025-11-11 11:42:16 [INFO] [INFO] Calling API with sparse data...
2025-11-11 11:42:19 [ERROR] [FAIL]   Unexpected status: 400
2025-11-11 11:42:19 [INFO] 
======================================================================
2025-11-11 11:42:19 [INFO] TEST: F2: Unusual Genre via API
2025-11-11 11:42:19 [INFO] ======================================================================
2025-11-11 11:42:19 [INFO] [INFO] Setting up unusual genre conversation...
2025-11-11 11:42:24 [INFO] [INFO]   Added 5 messages
2025-11-11 11:42:25 [INFO] [INFO] Calling API with unusual genre (underwater civilizations)...
2025-11-11 11:44:10 [INFO] [PASS]   API returned 5 books
2025-11-11 11:44:10 [INFO] [INFO]   Extracted genre: fantasy
2025-11-11 11:44:10 [INFO] [PASS]   5/5 have explanations
2025-11-11 11:44:10 [INFO] Unusual genre test passed
2025-11-11 11:44:10 [INFO] 
======================================================================
2025-11-11 11:44:10 [INFO] TEST: F3: Neutral Tone via API
2025-11-11 11:44:10 [INFO] ======================================================================
2025-11-11 11:44:10 [INFO] [INFO] Setting up test conversation...
2025-11-11 11:44:15 [INFO] [INFO]   Added 5 messages
2025-11-11 11:44:16 [INFO] [INFO] Calling API and analyzing tone...
2025-11-11 11:45:47 [INFO] [PASS]   No imperatives found in any explanation
2025-11-11 11:45:47 [INFO] [PASS]   Found 1 neutral descriptors
2025-11-11 11:45:47 [INFO] Neutral tone test passed
2025-11-11 11:45:47 [INFO] 
======================================================================
2025-11-11 11:45:47 [INFO] TEST: F4: Source Diversity via API
2025-11-11 11:45:47 [INFO] ======================================================================
2025-11-11 11:45:47 [INFO] [INFO] Setting up test conversation...
2025-11-11 11:45:51 [INFO] [INFO]   Added 5 messages
2025-11-11 11:45:52 [INFO] [INFO] Calling API to get books from multiple sources...
2025-11-11 11:47:00 [INFO] [PASS]   Books from 1 sources:
2025-11-11 11:47:00 [INFO] [PASS]   All open_library books have explanations (5/5)
2025-11-11 11:47:00 [INFO] Source diversity test passed
2025-11-11 11:47:00 [INFO] 
======================================================================
2025-11-11 11:47:00 [INFO] TEST: F5: Performance Without Explanations via API
2025-11-11 11:47:00 [INFO] ======================================================================
2025-11-11 11:47:00 [INFO] [INFO] Setting up test conversation...
2025-11-11 11:47:05 [INFO] [INFO]   Added 5 messages
2025-11-11 11:47:06 [INFO] [INFO] Calling API without explanation generation...
2025-11-11 11:47:40 [INFO] [INFO]   Response time: 34.47s
2025-11-11 11:47:40 [INFO] [INFO]   Returned 5 books
2025-11-11 11:47:40 [INFO] [PASS]   No explanations generated (as expected)
2025-11-11 11:47:40 [INFO] [PASS]   Fast response without explanations (34.5s)
2025-11-11 11:47:40 [INFO] [PASS]   All books have relevance scores
2025-11-11 11:47:40 [INFO] Performance without explanations test passed
2025-11-11 11:47:40 [INFO] ======================================================================
2025-11-11 11:47:40 [INFO] TEST SUMMARY
2025-11-11 11:47:40 [INFO] ======================================================================
2025-11-11 11:47:40 [INFO] 
Section A: Query Effectiveness:
2025-11-11 11:47:40 [INFO] [PASS] A1: Query Generation
2025-11-11 11:47:40 [INFO] [PASS] A2: Book Fetching
2025-11-11 11:47:40 [INFO] 
Section B: API Integration:
2025-11-11 11:47:40 [INFO] [PASS] B1: Server Health
2025-11-11 11:47:40 [INFO] 
Section C: Open Library Integration:
2025-11-11 11:47:40 [INFO] [PASS] C1: OL API Connection
2025-11-11 11:47:40 [INFO] [PASS] C2: OL Enhanced Fetching
2025-11-11 11:47:40 [INFO] [PASS] C3: OL Subject Parsing
2025-11-11 11:47:40 [INFO] [PASS] C4: OL Fallback
2025-11-11 11:47:40 [INFO] 
Section D: Subject Mapping:
2025-11-11 11:47:40 [INFO] [PASS] D1: Mapper Initialization
2025-11-11 11:47:40 [INFO] [PASS] D2: Fallback Mapping
2025-11-11 11:47:40 [INFO] [PASS] D3: Dynamic Mapping
2025-11-11 11:47:40 [INFO] [PASS] D4: Mapping Cache
2025-11-11 11:47:40 [INFO] [PASS] D5: Mapping Metrics
2025-11-11 11:47:40 [INFO] 
Section E: Explanation Generator API:
2025-11-11 11:47:40 [INFO] [PASS] E1: Explanation API
2025-11-11 11:47:40 [INFO] [PASS] E2: Quality Analysis
2025-11-11 11:47:40 [INFO] [PASS] E3: Summary Comparison
2025-11-11 11:47:40 [INFO] [PASS] E4: Flag Control
2025-11-11 11:47:40 [INFO] 
Section F: Edge Cases & Failures:
2025-11-11 11:47:40 [ERROR] [FAIL] F1: Sparse Conversation
2025-11-11 11:47:40 [INFO] [PASS] F2: Unusual Genre
2025-11-11 11:47:40 [INFO] [PASS] F3: Neutral Tone
2025-11-11 11:47:40 [INFO] [PASS] F4: Source Diversity
2025-11-11 11:47:40 [INFO] [PASS] F5: Performance Test
2025-11-11 11:47:40 [INFO] 
Overall Results: 20 passed, 1 failed, 0 skipped out of 21 tests
2025-11-11 11:47:40 [WARNING] [FAILURE] 1 tests failed out of 21
2025-11-11 11:47:40 [INFO] ======================================================================
2025-11-11 11:47:40 [INFO] QUICK TIPS
2025-11-11 11:47:40 [INFO] ======================================================================
2025-11-11 11:47:40 [INFO] Section A (Query Effectiveness):
2025-11-11 11:47:40 [INFO]   - Tests core query generation and book fetching logic
2025-11-11 11:47:40 [INFO]   - Requires Google Books API key to be set
2025-11-11 11:47:40 [INFO]   - Can run independently of Flask server
2025-11-11 11:47:40 [INFO] Section B (API Integration):
2025-11-11 11:47:40 [INFO]   - Tests full end-to-end recommendation flow
2025-11-11 11:47:40 [INFO]   - Requires Flask server running: python app.py
2025-11-11 11:47:40 [INFO] Section C (Open Library Integration):
2025-11-11 11:47:40 [INFO]   - Tests Open Library API connection and fetching
2025-11-11 11:47:40 [INFO]   - Tests subject parsing and mapping integration
2025-11-11 11:47:40 [INFO]   - Tests fallback behavior for obscure queries
2025-11-11 11:47:40 [INFO]   - No API key required (public API)
2025-11-11 11:47:40 [INFO] Section D (Subject Mapping):
2025-11-11 11:47:40 [INFO]   - Tests both dynamic (DeepSeek) and fallback mapping
2025-11-11 11:47:40 [INFO]   - Tests caching and performance metrics
2025-11-11 11:47:40 [INFO]   - Dynamic tests require DEEPSEEK_API_KEY
2025-11-11 11:47:40 [INFO]   - Fallback tests work without API key
2025-11-11 11:47:40 [INFO] Section E (Explanation Generator API):
2025-11-11 11:47:40 [INFO]   - Tests explanation generation via API endpoint
2025-11-11 11:47:40 [INFO]   - Tests quality of API-returned explanations
2025-11-11 11:47:40 [INFO]   - Tests summary comparison in API response
2025-11-11 11:47:40 [INFO]   - Tests generateExplanations flag control
2025-11-11 11:47:40 [INFO]   - Requires Flask server running
2025-11-11 11:47:40 [INFO]   - No direct OpenAI calls in tests (handled by server)
2025-11-11 11:47:40 [INFO] Environment Variables:
2025-11-11 11:47:40 [INFO]   - GOOGLE_BOOKS_API_KEY: For Google Books API (optional)
2025-11-11 11:47:40 [INFO]   - DEEPSEEK_API_KEY: For dynamic subject mapping (optional)
2025-11-11 11:47:40 [INFO]   - Without API keys, tests will use fallback methods
2025-11-11 11:47:40 [INFO] For detailed logs:
2025-11-11 11:47:40 [INFO]   - Check logs/recommendation_tests.log
2025-11-11 11:47:40 [INFO]   - Check logs/recommendations.log (Flask server)
2025-11-11 11:47:40 [INFO] Common issues:
2025-11-11 11:47:40 [INFO]   - API key not set -> Some tests will be skipped
2025-11-11 11:47:40 [INFO]   - Server not running -> Section B tests will fail
2025-11-11 11:47:40 [INFO]   - Network timeout -> Increase timeout in test config
2025-11-11 11:47:40 [INFO] ======================================================================
2025-11-11 11:47:40 [INFO] TEST SUITE COMPLETE
2025-11-11 11:47:40 [INFO] ======================================================================
